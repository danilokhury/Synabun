  /* ═══════════════════════════════════════════
     RESET & BASE
     ═══════════════════════════════════════════ */
  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    /* ── Text ── */
    --t-faint: rgba(255,255,255,0.2);
    --t-muted: rgba(255,255,255,0.3);
    --t-secondary: rgba(255,255,255,0.5);
    --t-primary: rgba(255,255,255,0.7);
    --t-bright: rgba(255,255,255,0.9);
    /* ── Surfaces ── */
    --s-transparent: transparent;
    --s-subtle: rgba(255,255,255,0.04);
    --s-light: rgba(255,255,255,0.06);
    --s-medium: rgba(255,255,255,0.10);
    --s-hover: rgba(255,255,255,0.08);
    --s-active: rgba(255,255,255,0.14);
    --s-panel: rgba(28,28,30,0.85);
    /* ── Borders ── */
    --b-subtle: rgba(255,255,255,0.06);
    --b-light: rgba(255,255,255,0.10);
    --b-hover: rgba(255,255,255,0.16);
    --b-visible: rgba(255,255,255,0.22);
    /* ── Accents ── */
    --accent-blue: hsl(var(--accent-hue, 199), var(--accent-saturation, 92%), var(--accent-lightness, 64%));
    --accent-blue-bg: hsla(var(--accent-hue, 199), var(--accent-saturation, 92%), var(--accent-lightness, 64%), 0.10);
    --accent-blue-border: hsla(var(--accent-hue, 199), var(--accent-saturation, 92%), var(--accent-lightness, 64%), 0.25);
    --accent-gold: rgba(255,215,0,0.85);
    --accent-gold-bg: rgba(255,215,0,0.10);
    --accent-gold-border: rgba(255,215,0,0.22);
    --accent-red: #FF5252;
    --accent-red-bg: rgba(255,82,82,0.15);
    --accent-red-hover: rgba(255,82,82,0.30);
    --accent-orange: #FFB74D;
    --accent-orange-bg: rgba(255,183,77,0.10);
    /* ── Radii ── */
    --r-pill: 20px;
    --r-button: 10px;
    --r-card: 8px;
    --r-circle: 50%;
    --r-small: 6px;
    /* ── Font sizes ── */
    --fs-xs: calc(12px * var(--font-scale, 1));
    --fs-sm: calc(13px * var(--font-scale, 1));
    --fs-md: calc(14px * var(--font-scale, 1));
    --fs-base: calc(15px * var(--font-scale, 1));
    --fs-lg: calc(16px * var(--font-scale, 1));
    /* ── Transitions ── */
    --ease: 0.2s ease;
    /* ── UI Scale ── */
    --ui-scale: 1;
    /* ── Interface Customization ── */
    --glass-opacity: 0.72;
    --glass-blur: 40;
    --glass-saturate: 1.4;
    --glass-border-opacity: 0.06;
    --glass-shadow-opacity: 0.4;
    --glass-shadow-spread: 20;
    --glass-radius: 14;
    --font-scale: 1;
    --accent-hue: 199;
    --accent-saturation: 92%;
    --accent-lightness: 64%;
    /* ── Explorer sidebar (set via JS when open) ── */
    --explorer-width: 0px;
    --terminal-height: 0px;
  }

  body {
    background: #050505;
    color: #e0e0e0;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    overflow: hidden;
    height: 100vh;
    width: 100vw;
  }

  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: rgba(255,255,255,0.03); }
  ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); border-radius: 3px; }

  /* ═══════════════════════════════════════════
     GLASSMORPHISM BASE
     ═══════════════════════════════════════════ */
  .glass {
    background: rgba(28, 28, 30, var(--glass-opacity));
    backdrop-filter: blur(calc(var(--glass-blur) * 1px)) saturate(var(--glass-saturate));
    -webkit-backdrop-filter: blur(calc(var(--glass-blur) * 1px)) saturate(var(--glass-saturate));
    border: 1px solid rgba(255, 255, 255, var(--glass-border-opacity));
    border-radius: calc(var(--glass-radius) * 1px);
    box-shadow: 0 2px calc(var(--glass-shadow-spread) * 1px) rgba(0,0,0, var(--glass-shadow-opacity)),
                inset 0 0.5px 0 rgba(255,255,255,0.05);
  }

  /* When explorer is open, containers match its solid look */
  body.explorer-open .glass {
    background: rgb(18, 18, 20);
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
    border-color: transparent;
  }

  /* UI scale — applied to all glass overlay panels */
  #category-sidebar,
  .detail-card,
  #stats-bar,
  .settings-panel {
    transform: scale(var(--ui-scale, 1));
    transform-origin: top left;
  }
  /* Detail cards default transform origin */
  .detail-card { transform-origin: top left; }

  /* Resizable panels now use JavaScript-based viewport clamping */
  .resizable {
    overflow-y: auto;
    box-sizing: border-box;
  }

  /* ═══════════════════════════════════════════
     GRAPH CONTAINER
     ═══════════════════════════════════════════ */
  #graph-container {
    position: fixed;
    top: 0;
    left: var(--explorer-width, 0px);
    width: calc(100vw - var(--explorer-width, 0px));
    height: calc(100vh - var(--terminal-height, 0px));
    z-index: 1;
    opacity: 1;
    transition: left 0.3s cubic-bezier(0.22, 1, 0.36, 1),
                width 0.3s cubic-bezier(0.22, 1, 0.36, 1),
                height 0.3s cubic-bezier(0.22, 1, 0.36, 1),
                opacity 0.45s ease;
  }
  #graph-container.viz-hidden,
  #controls-panel.viz-hidden,
  #stats-bar.viz-hidden {
    opacity: 0 !important;
    pointer-events: none !important;
    transition: opacity 0.45s ease;
  }

  /* ═══════════════════════════════════════════
     STATIC BACKGROUND (visualization disabled)
     ═══════════════════════════════════════════ */
  #static-bg {
    position: fixed;
    top: 0;
    left: var(--explorer-width, 0px);
    width: calc(100vw - var(--explorer-width, 0px));
    height: calc(100vh - var(--terminal-height, 0px));
    z-index: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    background: radial-gradient(ellipse at center, #0e1218 0%, #070709 70%);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.45s ease,
                left 0.3s cubic-bezier(0.22, 1, 0.36, 1),
                width 0.3s cubic-bezier(0.22, 1, 0.36, 1),
                height 0.3s cubic-bezier(0.22, 1, 0.36, 1);
  }
  #static-bg.visible {
    opacity: 1;
    pointer-events: auto;
  }
  .static-bg-logo {
    height: 80px;
    width: auto;
    opacity: 0.18;
    filter: grayscale(0.3);
    user-select: none;
    pointer-events: none;
  }

  /* ═══════════════════════════════════════════
     TOP MENU BAR (full-width unified)
     ═══════════════════════════════════════════ */
  #title-bar {
    position: fixed;
    top: 0;
    left: var(--explorer-width, 0px);
    right: 0;
    transition: left 0.3s cubic-bezier(0.22, 1, 0.36, 1);
    z-index: 300;
    padding: 10px 18px;
    display: flex;
    align-items: center;
    gap: 12px;
    background: rgba(18, 18, 20, 0.65);
    backdrop-filter: blur(40px) saturate(1.4);
    -webkit-backdrop-filter: blur(40px) saturate(1.4);
    border-bottom: 1px solid rgba(255, 255, 255, 0.04);
    border-radius: 0;
    box-shadow: 0 1px 12px rgba(0, 0, 0, 0.3);
  }

  /* When explorer is open — span full width, opaque, seamless with sidebar */
  #title-bar.explorer-active {
    left: 0;
    background: rgb(18, 18, 20);
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
    border-bottom-color: transparent;
    box-shadow: none;
    z-index: 310;
  }

  #title-bar .bar-left {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-shrink: 0;
  }

  #title-bar .bar-center {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 8px;
    min-width: 0;
  }

  #title-bar .bar-right {
    display: flex;
    align-items: center;
    gap: 6px;
    flex-shrink: 0;
  }

  /* Thin separator between sections */
  #title-bar .bar-sep {
    width: 1px;
    height: 20px;
    background: rgba(255, 255, 255, 0.06);
    flex-shrink: 0;
  }

  /* ═══════════════════════════════════════════
     OS-STYLE MENUBAR
     ═══════════════════════════════════════════ */

  .menubar {
    display: flex;
    align-items: center;
    gap: 0;
    height: 100%;
  }

  .menubar-item {
    position: relative;
  }

  .menubar-label {
    background: transparent;
    border: none;
    color: var(--t-muted);
    font-size: 13px;
    font-weight: 500;
    font-family: inherit;
    cursor: pointer;
    padding: 4px 10px;
    border-radius: 4px;
    transition: background 0.12s, color 0.12s;
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 5px;
  }

  .menubar-label:hover {
    background: var(--s-hover);
    color: var(--t-primary);
  }

  .menubar-item.open .menubar-label {
    background: var(--s-active);
    color: var(--t-bright);
  }

  .menubar-label .count-badge {
    position: relative;
    top: -1px;
  }

  /* Standalone action buttons in menubar (no dropdown) */
  .menubar-action {
    color: var(--t-secondary);
  }

  .menubar-dropdown {
    position: absolute;
    top: calc(100% + 4px);
    left: 0;
    min-width: 200px;
    padding: 5px;
    display: none;
    animation: menuDropIn 0.12s ease-out;
    z-index: 101;
    border: 1px solid rgba(255,255,255,0.06);
    border-radius: 8px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.45), 0 0 0 1px rgba(255,255,255,0.03);
  }

  .menubar-item.open .menubar-dropdown {
    display: block;
  }

  .menubar-dropdown--wide {
    min-width: 300px;
  }

  @keyframes menuDropIn {
    from { opacity: 0; transform: translateY(-6px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  /* ── Menu items ── */
  .menu-item {
    display: flex;
    align-items: center;
    padding: 6px 10px 6px 8px;
    margin: 1px 0;
    border-radius: 5px;
    cursor: pointer;
    color: var(--t-secondary);
    font-size: 12.5px;
    transition: background 0.1s, color 0.1s;
    gap: 0;
  }

  .menu-item:hover,
  .menu-item.focused {
    background: rgba(255,255,255,0.06);
    color: var(--t-bright);
  }

  .menu-check {
    width: 18px;
    text-align: center;
    font-size: 10px;
    color: var(--accent-blue);
    flex-shrink: 0;
    opacity: 0;
  }

  .menu-item.active .menu-check {
    opacity: 1;
  }

  .menu-text {
    flex: 1;
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .menu-icon { display: inline-flex; align-items: center; width: 14px; height: 14px; flex-shrink: 0; }
  .menu-icon svg { width: 100%; height: 100%; }

  .menu-shortcut {
    color: var(--t-faint);
    font-size: 10px;
    font-family: var(--ff-mono);
    margin-left: 20px;
    flex-shrink: 0;
    padding: 1px 5px;
    border-radius: 3px;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.06);
  }

  .menu-sep {
    height: 1px;
    background: rgba(255,255,255,0.06);
    margin: 4px 6px;
  }

  .menu-group-label {
    font-size: 9px;
    font-weight: 600;
    letter-spacing: 0.6px;
    text-transform: uppercase;
    color: var(--t-faint);
    padding: 8px 10px 4px 26px;
    pointer-events: none;
  }

  .menu-item.disabled {
    opacity: 0.3;
    pointer-events: none;
  }

  .pin-btn {
    background: var(--s-subtle);
    border: 1px solid var(--b-subtle);
    color: var(--t-muted);
    cursor: pointer;
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--r-circle);
    transition: all 0.2s;
    padding: 0;
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 11;
    opacity: 0;
  }
  .pin-btn svg {
    width: 14px;
    height: 14px;
    stroke: rgba(255,255,255,0.35);
    fill: none;
    stroke-width: 2;
    transition: all 0.2s;
    transform: rotate(45deg);
  }
  .resizable:hover .pin-btn { opacity: 1; }
  .pin-btn:hover {
    background: var(--s-hover);
    color: var(--t-primary);
    border-color: var(--b-light);
  }
  .pin-btn:hover svg { stroke: rgba(255,255,255,0.6); }
  .pin-btn.pinned {
    opacity: 1;
    background: var(--s-medium);
    border-color: var(--b-hover);
  }
  .pin-btn.pinned svg {
    stroke: rgba(255,255,255,0.7);
    fill: rgba(255,255,255,0.15);
    transform: rotate(0deg);
  }

  .detail-header .pin-btn {
    position: relative !important;
    top: auto !important;
    right: auto !important;
    opacity: 1 !important;
    width: 22px;
    height: 22px;
  }

  #title-bar h1 {
    font-size: 14px;
    font-weight: 600;
    letter-spacing: 0.3em;
    text-transform: uppercase;
    color: rgba(255, 255, 255, 0.65);
  }

  /* ── Pill buttons (links, type, reset) ── */
  .bar-pill {
    background: transparent;
    border: 1px solid rgba(255, 255, 255, 0.06);
    color: var(--t-muted);
    font-size: 12px;
    font-weight: 500;
    font-family: inherit;
    letter-spacing: 0.04em;
    padding: 5px 12px;
    border-radius: var(--r-pill);
    cursor: pointer;
    transition: all var(--ease);
    white-space: nowrap;
  }
  .bar-pill:hover {
    background: rgba(255, 255, 255, 0.06);
    color: var(--t-primary);
    border-color: rgba(255, 255, 255, 0.1);
  }
  .bar-pill:active {
    background: var(--s-active);
    transform: scale(0.96);
  }
  .bar-pill.active {
    background: rgba(255, 255, 255, 0.08);
    color: var(--t-primary);
    border-color: rgba(255, 255, 255, 0.1);
  }

  /* ── View toggle (2D/3D) ── */
  .view-toggle {
    display: flex;
    align-items: center;
    gap: 2px;
  }
  .view-toggle a {
    padding: 3px 8px;
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.04em;
    color: var(--t-dimmed);
    text-decoration: none;
    transition: color var(--ease);
    border-radius: 4px;
    position: relative;
  }
  .view-toggle a:hover { color: var(--t-primary); }
  .view-toggle a.active {
    color: var(--t-primary);
  }
  .view-toggle a.active::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 25%;
    right: 25%;
    height: 1.5px;
    background: var(--accent-blue);
    border-radius: 1px;
  }

  /* ── Icon-only buttons in top bar ── */
  .bar-icon {
    background: transparent;
    border: 1px solid transparent;
    color: var(--t-muted);
    width: 28px;
    height: 28px;
    border-radius: var(--r-circle);
    cursor: pointer;
    transition: all 0.15s;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    flex-shrink: 0;
    position: relative;
  }
  .bar-icon:hover {
    background: rgba(255, 255, 255, 0.06);
    color: var(--t-primary);
  }
  .bar-icon svg {
    width: 14px;
    height: 14px;
    stroke: currentColor;
    stroke-width: 2;
    fill: none;
  }
  .bar-icon.active {
    color: var(--accent-blue);
  }
  .bar-icon.active:hover {
    color: var(--accent-blue);
    background: rgba(255, 255, 255, 0.06);
  }
  .bar-icon .count-badge {
    position: absolute;
    top: -3px;
    right: -3px;
    font-size: 8px;
    min-width: 12px;
    height: 12px;
    padding: 0 3px;
    line-height: 12px;
  }

  /* Titlebar clock */
  .titlebar-clock {
    font-size: 11px;
    font-family: 'SF Mono', 'Cascadia Code', monospace;
    color: var(--t-muted);
    letter-spacing: 0.5px;
    white-space: nowrap;
    user-select: none;
    min-width: 52px;
    text-align: center;
  }

  /* ═══════════════════════════════════════════
     HELP BUTTON + MODAL
     (help, settings, trash now use .bar-icon class)
     ═══════════════════════════════════════════ */
  #help-btn {
    font-size: 12px;
    font-weight: 600;
  }

  #help-overlay {
    position: fixed;
    inset: 0;
    z-index: 500;
    background: rgba(0, 0, 0, 0.35);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    display: none;
    align-items: center;
    justify-content: center;
    animation: helpFadeIn 0.15s ease-out;
  }
  #help-overlay.open { display: flex; }

  @keyframes helpFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  #help-modal {
    width: 480px;
    max-height: calc(100vh - 80px);
    overflow-y: auto;
    padding: 28px 30px;
    animation: helpSlideIn 0.2s ease-out;
  }

  @keyframes helpSlideIn {
    from { opacity: 0; transform: translateY(10px) scale(0.98); }
    to { opacity: 1; transform: translateY(0) scale(1); }
  }

  #help-modal h2 {
    font-size: 14px;
    font-weight: 600;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    color: rgba(255, 255, 255, 0.55);
    margin-bottom: 20px;
  }

  .help-section {
    margin-bottom: 20px;
  }

  .help-section-title {
    font-size: 12px;
    font-weight: 600;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    color: rgba(255, 255, 255, 0.3);
    margin-bottom: 10px;
    padding-bottom: 6px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.04);
  }

  .help-row {
    display: flex;
    align-items: baseline;
    justify-content: space-between;
    padding: 5px 0;
  }

  .help-keys {
    display: flex;
    gap: 4px;
    flex-shrink: 0;
  }

  .help-key {
    font-family: 'JetBrains Mono', 'JetBrains Mono', 'SF Mono', 'Consolas', monospace;
    font-size: 12px;
    font-weight: 500;
    color: rgba(255, 255, 255, 0.7);
    background: rgba(255, 255, 255, 0.06);
    border: 1px solid rgba(255, 255, 255, 0.06);
    border-radius: 5px;
    padding: 2px 8px;
    white-space: nowrap;
  }

  .help-desc {
    font-size: 13px;
    color: rgba(255, 255, 255, 0.45);
    text-align: right;
    flex: 1;
    margin-left: 16px;
  }

  #help-close {
    position: absolute;
    top: 14px;
    right: 14px;
    background: rgba(255, 255, 255, 0.06);
    border: none;
    color: rgba(255, 255, 255, 0.3);
    cursor: pointer;
    font-size: 18px;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.2s;
  }
  #help-close:hover {
    color: rgba(255, 255, 255, 0.7);
    background: rgba(255, 255, 255, 0.1);
  }

  /* ═══════════════════════════════════════════
     BOOKMARKS
     ═══════════════════════════════════════════ */
  /* ── Toolbar buttons (shared) ── */
  .toolbar-btn {
    background: transparent;
    border: 1px solid rgba(255, 255, 255, 0.06);
    color: var(--t-muted);
    font-size: 12px;
    font-weight: 500;
    font-family: inherit;
    letter-spacing: 0.02em;
    padding: 5px 12px;
    border-radius: var(--r-pill);
    cursor: pointer;
    transition: all var(--ease);
    white-space: nowrap;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    gap: 5px;
    position: relative;
  }
  .toolbar-btn:hover {
    background: rgba(255, 255, 255, 0.06);
    color: var(--t-primary);
    border-color: rgba(255, 255, 255, 0.1);
  }
  .toolbar-btn:active { transform: scale(0.97); }
  .toolbar-btn.active {
    background: rgba(255, 255, 255, 0.08);
    color: var(--t-primary);
    border-color: rgba(255, 255, 255, 0.1);
  }
  .toolbar-btn svg {
    width: 12px; height: 12px;
    fill: none;
    stroke: currentColor;
    stroke-width: 1.8;
  }
  /* ── Collections tab (settings modal) ── */
  .conn-list {
    display: flex;
    flex-direction: column;
    gap: 4px;
    margin-bottom: 12px;
  }
  .conn-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 10px;
    border-radius: var(--r-card);
    background: var(--s-subtle);
    border: 1px solid var(--b-subtle);
    transition: all var(--ease);
    cursor: pointer;
  }
  .conn-item:hover {
    background: var(--s-hover);
    border-color: var(--b-hover);
  }
  .conn-item.active {
    background: var(--s-medium);
    border-color: rgba(255,255,255,0.2);
  }
  .conn-item-dot {
    width: 8px;
    height: 8px;
    border-radius: var(--r-circle);
    background: var(--t-muted);
    flex-shrink: 0;
    transition: all var(--ease);
  }
  .conn-item.active .conn-item-dot {
    background: var(--t-bright);
  }
  .conn-item-info {
    flex: 1;
    min-width: 0;
  }
  .conn-item-name {
    font-size: var(--fs-sm);
    font-weight: 500;
    color: var(--t-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .conn-item.active .conn-item-name { color: var(--t-bright); }
  .conn-item-meta {
    font-size: var(--fs-xs);
    color: var(--t-muted);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-family: 'JetBrains Mono', monospace;
  }
  .conn-item.active .conn-item-meta { color: var(--t-secondary); }
  .conn-item-count {
    font-size: var(--fs-xs);
    color: var(--t-secondary);
    background: var(--s-medium);
    padding: 2px 8px;
    border-radius: var(--r-pill);
    flex-shrink: 0;
    font-family: 'JetBrains Mono', monospace;
    font-weight: 600;
  }
  .conn-item.active .conn-item-count {
    background: rgba(255,255,255,0.12);
    color: var(--t-bright);
  }
  .conn-item-delete {
    width: 22px;
    height: 22px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: none;
    border: none;
    color: var(--t-muted);
    cursor: pointer;
    border-radius: var(--r-circle);
    opacity: 0;
    transition: all var(--ease);
    flex-shrink: 0;
    padding: 0;
  }
  .conn-item:hover .conn-item-delete { opacity: 0.6; }
  .conn-item-delete:hover { opacity: 1 !important; color: var(--accent-red); background: rgba(255,82,82,0.1); }
  .conn-item-delete svg { width: 12px; height: 12px; fill: none; stroke: currentColor; stroke-width: 2; }
  .conn-item-action {
    width: 22px; height: 22px;
    display: flex; align-items: center; justify-content: center;
    background: none; border: none; color: var(--t-muted);
    cursor: pointer; border-radius: var(--r-circle);
    opacity: 0.5; transition: all var(--ease);
    flex-shrink: 0; padding: 0;
  }
  .conn-item:hover .conn-item-action { opacity: 0.8; }
  .conn-item-action:hover { opacity: 1 !important; color: var(--accent-blue); background: rgba(79,195,247,0.1); }
  .conn-item-action svg { width: 12px; height: 12px; fill: none; stroke: currentColor; stroke-width: 2; }
  .conn-item-action.restoring,
  .conn-item-action.backing-up { opacity: 0.8 !important; pointer-events: none; }
  .conn-item-action.restoring svg,
  .conn-item-action.backing-up svg {
    animation: dep-spin 0.7s linear infinite;
  }
  .conn-item.unreachable {
    opacity: 0.5;
    border-style: dashed;
  }
  .conn-item.unreachable .conn-item-dot {
    background: var(--accent-red, #ef5350);
    opacity: 0.6;
  }
  .conn-item.unreachable .conn-item-name::after {
    content: ' (offline)';
    font-size: var(--fs-xs);
    color: var(--t-muted);
    font-weight: 400;
  }
  .conn-item-start {
    width: 22px; height: 22px;
    display: flex; align-items: center; justify-content: center;
    background: none; border: none; color: var(--accent-green, #66bb6a);
    cursor: pointer; border-radius: var(--r-circle);
    opacity: 0.7; transition: all var(--ease);
    flex-shrink: 0; padding: 0;
  }
  .conn-item-start:hover {
    opacity: 1;
    background: rgba(102,187,106,0.12);
  }
  .conn-item-start svg {
    width: 12px; height: 12px; fill: none; stroke: currentColor; stroke-width: 2;
  }
  .conn-item-start:disabled {
    pointer-events: none; opacity: 0.5;
  }
  .conn-add-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    width: 100%;
    padding: 8px;
    border-radius: var(--r-card);
    background: var(--s-subtle);
    border: 1px dashed var(--b-subtle);
    color: var(--t-muted);
    font-size: var(--fs-sm);
    font-family: inherit;
    cursor: pointer;
    transition: all var(--ease);
  }
  .conn-add-btn:hover {
    background: var(--s-hover);
    border-color: var(--b-hover);
    color: var(--t-primary);
  }
  .conn-add-btn svg { width: 14px; height: 14px; fill: none; stroke: currentColor; stroke-width: 2; }
  .conn-empty {
    text-align: center;
    padding: 20px;
    color: var(--t-muted);
    font-size: var(--fs-sm);
  }

  /* ── Bridge connection item variant ── */

  /* ── Add Collection Wizard ── */
  .conn-wizard-overlay {
    position: fixed; inset: 0; z-index: 10001;
    background: rgba(0,0,0,0.65);
    backdrop-filter: blur(20px) saturate(0.8);
    -webkit-backdrop-filter: blur(20px) saturate(0.8);
    display: flex; align-items: center; justify-content: center;
    animation: tagModalFadeIn 0.15s ease-out;
  }
  .conn-wizard-panel {
    width: 520px; max-height: 85vh;
    background: rgba(18,18,22,0.88);
    backdrop-filter: blur(40px) saturate(1.4);
    -webkit-backdrop-filter: blur(40px) saturate(1.4);
    border: 1px solid rgba(255,255,255,0.07);
    border-radius: 16px;
    box-shadow: 0 2px 32px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.04);
    display: flex; flex-direction: column; overflow: hidden;
    animation: tagModalScaleIn 0.18s ease-out;
  }
  .conn-wizard-viewport {
    position: relative; overflow: hidden;
    transition: height 0.38s cubic-bezier(0.4,0,0.2,1);
  }
  .conn-wizard-step {
    position: absolute; top: 0; left: 0; right: 0;
    padding: 28px 32px;
    display: flex; flex-direction: column;
    transition: transform 0.38s cubic-bezier(0.4,0,0.2,1), opacity 0.28s ease;
    overflow-y: auto;
  }
  .conn-wizard-step.active { transform: translateX(0); opacity: 1; z-index: 2; }
  .conn-wizard-step.left   { transform: translateX(-100%); opacity: 0; z-index: 1; }
  .conn-wizard-step.right  { transform: translateX(100%); opacity: 0; z-index: 1; }
  .conn-wizard-step h3 {
    font-size: 16px; font-weight: 600; color: var(--t-bright);
    margin-bottom: 5px; letter-spacing: -0.2px;
  }
  .conn-wizard-step .wiz-subtitle {
    font-size: 12px; color: var(--t-secondary);
    margin-bottom: 22px; line-height: 1.5;
  }
  .wiz-mode-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 4px; }
  .wiz-mode-card {
    padding: 16px; border: 1px solid var(--b-light);
    border-radius: var(--r-card); background: var(--s-subtle);
    cursor: pointer; transition: all 0.22s ease; text-align: center;
  }
  .wiz-mode-card:hover { background: var(--s-hover); border-color: var(--b-hover); transform: translateY(-1px); }
  .wiz-mode-card.selected {
    border-color: var(--accent-blue-border); background: var(--accent-blue-bg);
    box-shadow: 0 0 0 1px var(--accent-blue-border);
  }
  .wiz-mode-card .wmc-icon {
    width: 28px; height: 28px; margin: 0 auto 8px; stroke: var(--t-muted);
    fill: none; stroke-width: 1.5; transition: stroke 0.2s;
  }
  .wiz-mode-card.selected .wmc-icon { stroke: var(--accent-blue); }
  .wiz-mode-card .wmc-title { font-size: 13px; font-weight: 600; color: var(--t-bright); }
  .wiz-mode-card .wmc-desc { font-size: 11px; color: var(--t-muted); margin-top: 3px; line-height: 1.4; }
  .wiz-field { margin-bottom: 14px; }
  .wiz-field label {
    display: block; font-size: 11px; font-weight: 600;
    color: var(--t-secondary); margin-bottom: 6px;
    text-transform: uppercase; letter-spacing: 0.5px;
  }
  .wiz-field input[type="text"],
  .wiz-field input[type="number"],
  .wiz-field input[type="password"] {
    width: 100%; box-sizing: border-box;
    font-size: var(--fs-sm); font-family: 'JetBrains Mono', monospace;
    padding: 8px 10px; border-radius: var(--r-small);
    background: var(--s-subtle); color: var(--t-bright);
    border: 1px solid var(--b-light); outline: none;
    transition: border-color var(--ease);
  }
  .wiz-field input:focus { border-color: var(--accent-blue-border); }
  .wiz-field .wiz-hint { font-size: 11px; color: var(--t-muted); margin-top: 4px; line-height: 1.4; }
  .wiz-field .wiz-error { font-size: 11px; color: var(--accent-red); margin-top: 4px; display: none; }
  .wiz-field .wiz-error.visible { display: block; }
  .wiz-row { display: flex; gap: 8px; }
  .wiz-row .wiz-field { flex: 1; }
  .wiz-input-row { display: flex; gap: 6px; }
  .wiz-input-row input { flex: 1; }
  .wiz-generate-btn {
    padding: 8px 12px; border-radius: var(--r-small);
    border: 1px solid var(--b-light); background: var(--s-light);
    color: var(--t-primary); font-size: 11px; font-family: inherit;
    cursor: pointer; white-space: nowrap; transition: all var(--ease); flex-shrink: 0;
  }
  .wiz-generate-btn:hover { background: var(--s-medium); color: var(--t-bright); border-color: var(--b-hover); }
  .wiz-terminal {
    background: rgba(0,0,0,0.3); border: 1px solid var(--b-subtle);
    border-radius: var(--r-small); padding: 10px 12px;
    font-family: 'JetBrains Mono', monospace; font-size: 11px;
    color: var(--t-secondary); max-height: 120px;
    overflow-y: auto; white-space: pre-wrap; word-break: break-all;
    line-height: 1.5; margin: 10px 0;
  }
  .wiz-status {
    display: flex; align-items: center; gap: 8px;
    font-size: 12px; color: var(--t-primary); margin-bottom: 8px;
  }
  .wiz-status-dot {
    width: 7px; height: 7px; border-radius: 50%; flex-shrink: 0;
  }
  .wiz-status-dot.green { background: #6dd58c; box-shadow: 0 0 6px rgba(109,213,140,0.4); }
  .wiz-status-dot.red { background: var(--accent-red); }
  .wiz-status-dot.spin {
    border: 2px solid rgba(79,195,247,0.25);
    border-top-color: var(--accent-blue);
    animation: dep-spin 0.7s linear infinite;
    width: 9px; height: 9px; background: none;
  }
  .wiz-action-btn {
    padding: 10px 20px; border-radius: var(--r-small);
    border: 1px solid var(--accent-blue-border);
    background: var(--accent-blue-bg); color: var(--accent-blue);
    font-size: 12px; font-weight: 600; font-family: inherit;
    cursor: pointer; transition: all var(--ease); width: 100%;
  }
  .wiz-action-btn:hover { background: rgba(79,195,247,0.16); border-color: rgba(79,195,247,0.35); }
  .wiz-action-btn:disabled { opacity: 0.4; pointer-events: none; }
  .wiz-summary-card {
    border: 1px solid var(--b-light); border-radius: var(--r-card);
    background: var(--s-subtle); padding: 16px 18px; margin-bottom: 16px;
  }
  .wiz-summary-row {
    display: flex; justify-content: space-between; align-items: center;
    padding: 6px 0; font-size: 12px;
  }
  .wiz-summary-row + .wiz-summary-row { border-top: 1px solid var(--b-subtle); }
  .wiz-summary-row .wsr-label { color: var(--t-muted); }
  .wiz-summary-row .wsr-value { color: var(--t-bright); font-family: 'JetBrains Mono', monospace; font-size: 11px; }
  .conn-wizard-nav {
    padding: 12px 20px; display: flex; align-items: center;
    justify-content: space-between;
    border-top: 1px solid rgba(255,255,255,0.05);
    background: rgba(0,0,0,0.2); flex-shrink: 0;
  }
  .wiz-dots { display: flex; gap: 3px; }
  .wiz-dot {
    width: 14px; height: 3px; border-radius: 1px;
    background: rgba(255,255,255,0.08); transition: all 0.3s ease;
  }
  .wiz-dot.active { background: var(--accent-blue); box-shadow: 0 0 6px rgba(79,195,247,0.4); }
  .wiz-dot.done { background: rgba(79,195,247,0.25); }
  .wiz-nav-btn {
    padding: 6px 14px; border-radius: var(--r-small);
    border: 1px solid var(--b-subtle); background: var(--s-subtle);
    color: var(--t-muted); font-size: 11px; font-family: inherit;
    cursor: pointer; transition: all var(--ease); letter-spacing: 0.04em;
  }
  .wiz-nav-btn:hover { color: var(--t-bright); background: var(--s-hover); border-color: var(--b-hover); }
  .wiz-nav-btn:disabled { opacity: 0; pointer-events: none; }
  .wiz-nav-btn.primary {
    background: var(--accent-blue-bg); border-color: var(--accent-blue-border);
    color: var(--accent-blue);
  }
  .wiz-nav-btn.primary:hover { background: rgba(79,195,247,0.16); border-color: rgba(79,195,247,0.35); }
  .wiz-nav-btn.primary:disabled { opacity: 0.4; pointer-events: none; }

  /* ── Claude Code integration ── */
  .cc-integration-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    border-radius: var(--r-small);
    background: transparent;
    border: 1px solid transparent;
    transition: all var(--ease);
  }
  .cc-integration-item + .cc-integration-item { margin-top: 6px; }
  .cc-integration-item:hover { background: var(--s-subtle); }
  .cc-integration-item.enabled {
    background: rgba(255,255,255,0.06);
    border-color: rgba(255,255,255,0.12);
  }
  .cc-integration-info { flex: 1; min-width: 0; }
  .cc-integration-label {
    font-size: var(--fs-sm);
    font-weight: 500;
    color: var(--t-secondary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .cc-integration-item.enabled .cc-integration-label { color: var(--t-bright); }
  .cc-integration-path {
    font-size: 11px;
    color: var(--t-muted);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .cc-toggle {
    position: relative;
    width: 36px;
    height: 20px;
    background: rgba(255,255,255,0.06);
    border: 1px solid var(--b-subtle);
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.25s ease;
    flex-shrink: 0;
    padding: 0;
  }
  .cc-toggle::after {
    content: '';
    position: absolute;
    top: 2px;
    left: 2px;
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: var(--t-muted);
    transition: all 0.25s ease;
  }
  .cc-toggle.on {
    background: rgba(255,255,255,0.14);
    border-color: rgba(255,255,255,0.22);
  }
  .cc-toggle.on::after {
    left: 18px;
    background: rgba(255,255,255,0.85);
    box-shadow: 0 0 4px rgba(255,255,255,0.15);
  }
  .cc-skill-row {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    border-radius: var(--r-small);
    background: transparent;
    border: 1px solid transparent;
    transition: all var(--ease);
  }
  .cc-skill-row + .cc-skill-row { margin-top: 6px; }
  .cc-skill-row:hover { background: var(--s-subtle); }
  .cc-skill-row.installed {
    background: rgba(255,255,255,0.06);
    border-color: rgba(255,255,255,0.12);
  }
  .cc-skill-info { flex: 1; min-width: 0; display: flex; align-items: baseline; gap: 8px; }
  .cc-skill-name {
    font-size: var(--fs-sm);
    font-weight: 500;
    color: var(--t-secondary);
    white-space: nowrap;
  }
  .cc-skill-row.installed .cc-skill-name { color: var(--t-bright); }
  .cc-skill-desc {
    font-size: 11px;
    color: var(--t-muted);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .cc-toast {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--s-dark);
    border: 1px solid var(--s-medium);
    color: var(--text);
    padding: 10px 20px;
    border-radius: 8px;
    font-size: 13px;
    z-index: 100000;
    opacity: 0;
    transition: opacity 0.3s;
    pointer-events: none;
  }
  .cc-toast.show { opacity: 1; }
  .cc-remove-btn {
    width: 22px;
    height: 22px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: none;
    border: none;
    color: var(--t-muted);
    cursor: pointer;
    border-radius: var(--r-circle);
    opacity: 0;
    transition: all var(--ease);
    flex-shrink: 0;
    padding: 0;
  }
  .cc-integration-item:hover .cc-remove-btn { opacity: 0.6; }
  .cc-remove-btn:hover { opacity: 1 !important; color: var(--accent-red); background: rgba(255,82,82,0.1); }
  .cc-remove-btn svg { width: 12px; height: 12px; fill: none; stroke: currentColor; stroke-width: 2; }
  .cc-section-label {
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 1.2px;
    font-weight: 700;
    color: var(--t-faint);
    margin-top: 20px;
    margin-bottom: 8px;
    padding-bottom: 5px;
    border-bottom: 1px solid rgba(255,255,255,0.04);
  }
  .cc-section-label:first-child { margin-top: 0; }
  .cc-hint {
    font-size: 11px;
    color: var(--t-faint);
    margin-top: 4px;
    line-height: 1.45;
  }

  /* Collapsible connection panels */
  .cc-panel {
    border: 1px solid var(--b-light);
    border-radius: var(--r-card);
    background: rgba(255,255,255,0.02);
    overflow: hidden;
    transition: border-color 0.2s, background 0.2s;
  }
  .cc-panel + .cc-panel { margin-top: 6px; }
  .cc-panel.enabled {
    border-color: rgba(255,255,255,0.14);
    background: rgba(255,255,255,0.03);
  }
  .cc-panel-header {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 12px;
    cursor: pointer;
    user-select: none;
    transition: background 0.15s;
  }
  .cc-panel-header:hover { background: rgba(255,255,255,0.03); }
  .cc-panel-chevron {
    width: 12px;
    height: 12px;
    flex-shrink: 0;
    fill: none;
    stroke: var(--t-muted);
    stroke-width: 2;
    stroke-linecap: round;
    stroke-linejoin: round;
    transition: transform 0.2s;
  }
  .cc-panel.open .cc-panel-chevron { transform: rotate(90deg); }
  .cc-panel-title {
    flex: 1;
    min-width: 0;
    font-size: var(--fs-sm);
    font-weight: 600;
    color: var(--t-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .cc-panel.enabled .cc-panel-title { color: var(--t-bright); }
  .cc-panel-status {
    font-size: 11px;
    padding: 2px 8px;
    border-radius: var(--r-pill);
    font-weight: 600;
    letter-spacing: 0.3px;
    flex-shrink: 0;
  }
  .cc-panel-status.active {
    background: rgba(255,255,255,0.08);
    color: var(--t-bright);
  }
  .cc-panel-status.inactive {
    background: rgba(255,255,255,0.04);
    color: var(--t-muted);
  }
  .cc-panel-body {
    display: none;
    padding: 4px 14px 16px;
  }
  .cc-panel.open .cc-panel-body { display: block; }
  .cc-panel-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 6px 0;
  }
  .cc-panel-row + .cc-panel-row {
    border-top: 1px solid rgba(255,255,255,0.03);
  }
  .cc-panel-row-label {
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.6px;
    color: var(--t-muted);
    font-weight: 600;
  }
  .cc-panel-row-value {
    font-size: var(--fs-xs);
    color: var(--t-secondary);
    font-family: 'JetBrains Mono', monospace;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 60%;
    text-align: right;
  }
  .cc-panel-actions {
    display: flex;
    align-items: center;
    gap: 6px;
    padding-top: 8px;
    margin-top: 4px;
    border-top: 1px solid var(--b-subtle);
  }
  .cc-panel-actions button {
    flex: 1;
    padding: 5px 0;
    font-size: var(--fs-xs);
    font-weight: 500;
    font-family: inherit;
    border-radius: var(--r-small);
    cursor: pointer;
    transition: background 0.15s, border-color 0.15s;
  }
  .cc-panel-actions .cc-enable-btn {
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.12);
    color: var(--t-primary);
  }
  .cc-panel-actions .cc-enable-btn:hover {
    background: rgba(255,255,255,0.1);
  }
  .cc-panel-actions .cc-enable-btn.on {
    background: rgba(255,255,255,0.10);
    border-color: rgba(255,255,255,0.20);
    color: var(--t-bright);
  }
  .cc-panel-actions .cc-disable-btn {
    background: rgba(255,82,82,0.08);
    border: 1px solid rgba(255,82,82,0.2);
    color: var(--accent-red);
  }
  .cc-panel-actions .cc-disable-btn:hover {
    background: rgba(255,82,82,0.15);
  }
  .cc-panel-actions .cc-remove-panel-btn {
    background: none;
    border: 1px solid var(--b-subtle);
    color: var(--t-muted);
  }
  .cc-panel-actions .cc-remove-panel-btn:hover {
    color: var(--accent-red);
    border-color: rgba(255,82,82,0.3);
    background: rgba(255,82,82,0.08);
  }

  /* ── Greeting Config Editor ── */
  .cc-greeting-field {
    margin-bottom: 10px;
  }
  .cc-greeting-label {
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 600;
    color: var(--t-muted);
    margin-bottom: 5px;
    display: block;
  }
  .cc-greeting-textarea {
    width: 100%;
    min-height: 60px;
    max-height: 160px;
    resize: vertical;
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--b-subtle);
    border-radius: 6px;
    padding: 8px 10px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    line-height: 1.5;
    color: var(--t-primary);
    box-sizing: border-box;
    transition: border-color 0.15s;
  }
  .cc-greeting-textarea:focus {
    outline: none;
    border-color: rgba(255,255,255,0.15);
  }
  .cc-greeting-textarea::placeholder { color: var(--t-faint); }
  .cc-greeting-project-select {
    background: rgba(255,255,255,0.04);
    border: 1px solid var(--b-subtle);
    border-radius: 6px;
    padding: 5px 8px;
    font-family: inherit;
    font-size: 12px;
    color: var(--t-primary);
    cursor: pointer;
    min-width: 120px;
  }
  .cc-greeting-project-select:focus { outline: none; border-color: rgba(255,255,255,0.15); }
  .cc-greeting-project-select option { background: #1a1a1a; color: var(--t-primary); }

  /* Custom dropdown */
  .cc-dropdown {
    position: relative;
    display: inline-block;
  }
  .cc-dropdown-trigger {
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--b-subtle);
    border-radius: 5px;
    padding: 3px 7px 3px 9px;
    font-family: inherit;
    font-size: 10px;
    color: var(--t-secondary);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 5px;
    min-width: 100px;
    transition: border-color 0.15s, background 0.15s, color 0.15s;
    letter-spacing: 0.2px;
  }
  .cc-dropdown-trigger:hover {
    background: rgba(255,255,255,0.05);
    border-color: rgba(255,255,255,0.15);
    color: var(--t-primary);
  }
  .cc-dropdown.open .cc-dropdown-trigger {
    border-color: rgba(255,255,255,0.2);
    background: rgba(255,255,255,0.06);
    color: var(--t-bright);
  }
  .cc-dropdown-value {
    flex: 1;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .cc-dropdown-arrow {
    width: 10px;
    height: 10px;
    fill: none;
    stroke: var(--t-muted);
    stroke-width: 2.5;
    stroke-linecap: round;
    stroke-linejoin: round;
    flex-shrink: 0;
    transition: transform 0.15s;
  }
  .cc-dropdown.open .cc-dropdown-arrow { transform: rotate(180deg); }
  .cc-dropdown-menu {
    display: none;
    position: absolute;
    top: calc(100% + 4px);
    left: 0;
    right: 0;
    min-width: 150px;
    background: #1a1a1a;
    border: 1px solid rgba(255,255,255,0.06);
    border-radius: 6px;
    padding: 3px;
    z-index: 100;
    box-shadow: 0 6px 20px rgba(0,0,0,0.4);
  }
  .cc-dropdown.open .cc-dropdown-menu { display: block; }
  .cc-dropdown-item {
    padding: 6px 10px;
    font-size: 11px;
    color: var(--t-secondary);
    border-radius: 4px;
    cursor: pointer;
    transition: background 0.1s, color 0.1s;
  }
  .cc-dropdown-item:hover {
    background: rgba(255,255,255,0.06);
    color: var(--t-bright);
  }
  .cc-dropdown-item.active {
    background: rgba(255,255,255,0.08);
    color: var(--t-bright);
  }

  /* Provider badges */
  .cc-provider-badges {
    display: flex;
    align-items: center;
    gap: 4px;
  }
  .cc-provider-badge {
    position: relative;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 5px;
    cursor: pointer;
    transition: background 0.15s;
  }
  .cc-provider-badge:hover { background: rgba(255,255,255,0.06); }
  .cc-provider-icon {
    width: 14px;
    height: 14px;
    color: var(--t-muted);
    transition: color 0.15s;
    flex-shrink: 0;
  }
  .cc-provider-badge:hover .cc-provider-icon { color: var(--t-bright); }

  /* Compatibility popup */
  .cc-compat-popup {
    display: none;
    position: absolute;
    top: calc(100% + 6px);
    right: -4px;
    width: 220px;
    background: #1a1a1a;
    border: 1px solid rgba(255,255,255,0.06);
    border-radius: 10px;
    padding: 0;
    z-index: 200;
    box-shadow: 0 8px 24px rgba(0,0,0,0.5);
    overflow: hidden;
    pointer-events: none;
  }
  .cc-provider-badge:hover .cc-compat-popup,
  .cc-provider-badge:focus .cc-compat-popup { display: block; }
  .cc-compat-header {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 10px 12px 8px;
    border-bottom: 1px solid rgba(255,255,255,0.06);
    font-size: 11px;
    font-weight: 600;
    color: var(--t-primary);
    letter-spacing: 0.2px;
  }
  .cc-compat-header .cc-provider-icon { width: 12px; height: 12px; color: var(--t-secondary); }
  .cc-compat-count {
    margin-left: auto;
    font-size: 10px;
    font-weight: 500;
    color: var(--t-muted);
    background: rgba(255,255,255,0.05);
    padding: 1px 6px;
    border-radius: 8px;
  }
  .cc-compat-grid { padding: 6px 4px 8px; }
  .cc-compat-row {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 5px 10px;
    border-radius: 6px;
    transition: background 0.1s;
  }
  .cc-compat-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  .cc-compat-row.on .cc-compat-dot { background: #4ade80; box-shadow: 0 0 6px rgba(74,222,128,0.3); }
  .cc-compat-row.off .cc-compat-dot { background: rgba(255,255,255,0.1); }
  .cc-compat-name {
    font-size: 11px;
    letter-spacing: 0.1px;
  }
  .cc-compat-row.on .cc-compat-name { color: var(--t-primary); }
  .cc-compat-row.off .cc-compat-name { color: var(--t-faint); }
  .cc-compat-note {
    margin-left: auto;
    font-size: 9px;
    color: var(--t-muted);
    opacity: 0.7;
  }

  .cc-greeting-reminder-list { display: flex; flex-direction: column; gap: 4px; }
  .cc-greeting-reminder-row {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 4px 0;
    border-radius: 4px;
    transition: background 0.1s;
  }
  .cc-greeting-reminder-row:hover { background: rgba(255,255,255,0.02); }
  .cc-greeting-drag-handle {
    cursor: grab;
    color: var(--t-faint);
    font-size: 11px;
    padding: 2px;
    user-select: none;
    opacity: 0.4;
    transition: opacity 0.15s;
  }
  .cc-greeting-reminder-row:hover .cc-greeting-drag-handle { opacity: 0.8; }
  .cc-greeting-reminder-input {
    flex: 1;
    background: transparent;
    border: 1px solid transparent;
    border-radius: 4px;
    padding: 4px 6px;
    font-family: inherit;
    font-size: 12px;
    color: var(--t-primary);
    transition: border-color 0.15s, background 0.15s;
  }
  .cc-greeting-reminder-input:hover { border-color: var(--b-subtle); }
  .cc-greeting-reminder-input:focus {
    outline: none;
    border-color: rgba(255,255,255,0.12);
    background: rgba(255,255,255,0.03);
  }
  .cc-greeting-reminder-input::placeholder { color: var(--t-faint); }
  .cc-greeting-reminder-input.cmd {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
  }
  .cc-greeting-reminder-remove {
    background: none;
    border: none;
    color: var(--t-faint);
    cursor: pointer;
    padding: 2px 4px;
    font-size: 14px;
    line-height: 1;
    opacity: 0;
    transition: opacity 0.15s, color 0.15s;
  }
  .cc-greeting-reminder-row:hover .cc-greeting-reminder-remove { opacity: 0.6; }
  .cc-greeting-reminder-remove:hover { opacity: 1 !important; color: var(--accent-red); }
  .cc-greeting-checkboxes {
    display: flex;
    gap: 16px;
    margin-bottom: 10px;
  }
  .cc-greeting-var-hint {
    font-size: 10px;
    color: var(--t-faint);
    margin-top: 3px;
    line-height: 1.4;
  }
  .cc-greeting-cheatsheet-toggle {
    font-size: 10px;
    color: var(--accent-blue);
    margin-top: 4px;
    cursor: pointer;
    user-select: none;
    display: inline-flex;
    align-items: center;
    gap: 4px;
    opacity: 0.7;
    transition: opacity 0.15s;
  }
  .cc-greeting-cheatsheet-toggle:hover { opacity: 1; }
  .cc-greeting-cheatsheet-toggle.open { opacity: 1; }
  .cc-greeting-cheatsheet {
    margin-top: 6px;
    border: 1px solid var(--b-subtle);
    border-radius: 6px;
    background: rgba(255,255,255,0.02);
    overflow: hidden;
  }
  .cc-cheatsheet-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 11px;
  }
  .cc-cheatsheet-table th {
    text-align: left;
    font-weight: 500;
    color: var(--t-muted);
    font-size: 9px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    padding: 5px 8px;
    border-bottom: 1px solid var(--b-subtle);
    background: rgba(255,255,255,0.02);
  }
  .cc-cheatsheet-table td {
    padding: 4px 8px;
    border-bottom: 1px solid rgba(255,255,255,0.03);
    vertical-align: middle;
  }
  .cc-cheatsheet-table tr:last-child td { border-bottom: none; }
  .cc-cheatsheet-table code {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    background: rgba(79,195,247,0.08);
    color: var(--accent-blue);
    padding: 1px 4px;
    border-radius: 3px;
  }
  .cc-cheatsheet-table td:last-child {
    color: var(--t-secondary);
    font-size: 10px;
  }
  .cc-cheatsheet-example {
    border-top: 1px solid var(--b-subtle);
    padding: 6px 8px;
    background: rgba(255,255,255,0.02);
  }
  .cc-cheatsheet-preview {
    font-size: 11px;
    color: var(--t-bright);
    line-height: 1.5;
    font-family: 'JetBrains Mono', monospace;
    word-break: break-word;
  }
  .cc-cheatsheet-preview strong { color: var(--accent-blue); font-weight: 600; }
  .cc-cheatsheet-preview code {
    font-family: 'JetBrains Mono', monospace;
    background: rgba(255,255,255,0.06);
    padding: 1px 3px;
    border-radius: 3px;
    font-size: 10px;
  }
  .cc-copy-btn {
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--b-subtle);
    border-radius: 6px;
    padding: 5px 10px;
    font-family: inherit;
    font-size: 11px;
    color: var(--t-secondary);
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 5px;
    transition: background 0.15s, border-color 0.15s;
    width: 100%;
    justify-content: center;
  }
  .cc-copy-btn:hover { background: rgba(255,255,255,0.06); border-color: rgba(255,255,255,0.12); }
  .cc-copy-btn svg { width: 11px; height: 11px; opacity: 0.5; }
  .cc-ruleset-preview {
    max-height: 140px;
    overflow-y: auto;
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--b-subtle);
    border-radius: 6px;
    padding: 10px 12px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    line-height: 1.5;
    color: var(--t-secondary);
    white-space: pre-wrap;
    word-break: break-word;
  }
  /* Hooks badge in section title */
  .cc-hooks-badge {
    font-size: 10px;
    font-weight: 600;
    padding: 1px 6px;
    border-radius: var(--r-pill);
    margin-left: 6px;
    background: rgba(255,255,255,0.06);
    color: var(--t-muted);
  }
  .cc-hooks-badge.all-on { background: rgba(79,195,247,0.12); color: var(--accent-blue); }

  /* Collapsible iface-sections in Connections tab */
  .iface-section[data-collapsible] .gfx-group-title {
    cursor: pointer;
    user-select: none;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .iface-section[data-collapsible] .cc-section-chevron {
    width: 10px;
    height: 10px;
    flex-shrink: 0;
    fill: none;
    stroke: var(--t-muted);
    stroke-width: 2.5;
    stroke-linecap: round;
    stroke-linejoin: round;
    transition: transform 0.2s;
    transform: rotate(90deg);
  }
  .iface-section[data-collapsible].collapsed .cc-section-chevron {
    transform: rotate(0deg);
  }
  .iface-section[data-collapsible] .cc-section-body {
    transition: opacity 0.15s;
  }
  .iface-section[data-collapsible].collapsed .cc-section-body {
    display: none !important;
  }

  .toolbar-btn svg {
    width: 14px; height: 14px;
    fill: none;
    stroke: currentColor;
    stroke-width: 1.8;
    stroke-linejoin: round;
    flex-shrink: 0;
  }

  /* ── Count badges (shared) ── */
  .count-badge {
    font-size: var(--fs-xs);
    font-weight: 600;
    padding: 1px 6px;
    border-radius: var(--r-pill);
    min-width: 16px;
    text-align: center;
    line-height: 1.5;
  }
  .count-badge:empty { display: none; }
  .count-badge--gold {
    background: var(--accent-gold-bg);
    color: var(--accent-gold);
  }
  .count-badge--blue {
    background: var(--accent-blue-bg);
    color: var(--accent-blue);
  }
  .count-badge--muted {
    background: var(--s-light);
    color: var(--t-secondary);
  }
  .count-badge--red {
    background: var(--accent-red-bg);
    color: var(--accent-red);
  }

  /* ── Dropdown panels (shared) ── */
  .dropdown-panel {
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 16px;
    z-index: 101;
    width: 340px;
    padding: 12px;
    display: none;
    animation: dropdownFadeIn 0.15s ease-out;
  }
  .dropdown-panel.open { display: block; }
  @keyframes dropdownFadeIn {
    from { opacity: 0; transform: translateY(-6px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .dropdown-empty {
    text-align: center;
    color: var(--t-faint);
    font-size: var(--fs-md);
    padding: 20px 10px;
    line-height: 1.7;
  }

  /* ── Dropdown list items (shared) ── */
  .dropdown-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 10px;
    border-radius: var(--r-card);
    cursor: pointer;
    transition: background 0.15s;
  }
  .dropdown-item:hover { background: var(--s-hover); }
  .dropdown-item-dot {
    width: 8px; height: 8px;
    border-radius: var(--r-circle);
    flex-shrink: 0;
  }
  .dropdown-item-text {
    flex: 1;
    min-width: 0;
  }
  .dropdown-item-title {
    font-size: var(--fs-md);
    font-weight: 500;
    color: var(--t-secondary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .dropdown-item:hover .dropdown-item-title { color: var(--t-primary); }
  .dropdown-item-sub {
    font-size: var(--fs-xs);
    color: var(--t-faint);
    text-transform: uppercase;
    letter-spacing: 0.4px;
    margin-top: 1px;
  }

  /* ── Trash window (floating panel like settings) ── */
  .trash-window {
    position: fixed;
    z-index: 300;
    width: 560px;
    max-width: 92vw;
    min-width: 360px;
    min-height: 340px;
    max-height: 80vh;
    animation: tagModalScaleIn 0.15s ease-out;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    border: 1px solid rgba(255,255,255,0.10);
  }
  .trash-window.dragging { transition: none; }
  .trash-window-header {
    display: flex !important;
    align-items: center !important;
    justify-content: flex-start !important;
    padding: 12px 14px !important;
    margin: 0 !important;
    border-bottom: 1px solid var(--b-subtle);
    gap: 10px;
    flex-shrink: 0;
    min-height: 44px;
    box-sizing: border-box;
  }
  .trash-window-header h3 {
    flex: 1;
    font-size: 13px;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    font-weight: 500;
    color: rgba(255,255,255,0.45);
    margin: 0;
    pointer-events: none;
    line-height: 1;
  }
  .trash-window-header h3 .tw-h-count {
    font-size: 10px;
    letter-spacing: 0.05em;
    color: var(--t-muted);
    margin-left: 6px;
    font-weight: 400;
  }
  .trash-window-header .pin-btn {
    position: relative !important;
    top: auto !important;
    right: auto !important;
    opacity: 1 !important;
    flex-shrink: 0;
  }
  .trash-window-close {
    width: 26px; height: 26px;
    display: flex; align-items: center; justify-content: center;
    background: transparent; border: none;
    color: var(--t-muted); cursor: pointer;
    border-radius: var(--r-circle);
    font-size: 18px; line-height: 1;
    transition: all var(--ease);
    padding: 0; flex-shrink: 0;
  }
  .trash-window-close:hover { color: var(--t-bright); background: var(--s-hover); }
  .trash-window.locked .trash-window-header { cursor: default; }
  .trash-window-body {
    display: flex;
    flex: 1;
    overflow: hidden;
    min-height: 0;
  }
  .trash-list-pane {
    width: 220px;
    flex-shrink: 0;
    border-right: 1px solid var(--b-subtle);
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
  .trash-list-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 10px;
    border-bottom: 1px solid var(--b-subtle);
    flex-shrink: 0;
  }
  .trash-list-header span {
    font-size: var(--fs-xs);
    color: var(--t-muted);
    font-weight: 500;
  }
  .trash-purge-btn {
    font-size: 10px;
    padding: 2px 8px;
    border-radius: var(--r-small);
    border: 1px solid rgba(180,70,70,0.25);
    background: rgba(140,50,50,0.18);
    color: rgba(220,130,130,0.85);
    cursor: pointer;
    font-family: inherit;
    font-weight: 500;
    transition: all var(--ease);
  }
  .trash-purge-btn:hover { background: rgba(140,50,50,0.30); color: rgba(230,150,150,0.95); }
  .trash-list-scroll {
    flex: 1;
    overflow-y: auto;
  }
  .trash-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 7px 10px;
    border-bottom: 1px solid var(--b-subtle);
    cursor: pointer;
    transition: background var(--ease);
  }
  .trash-item:hover { background: var(--s-hover); }
  .trash-item:last-child { border-bottom: none; }
  .trash-item.active { background: var(--s-active); }
  .trash-item-content {
    flex: 1;
    min-width: 0;
  }
  .trash-item-preview {
    font-size: var(--fs-xs);
    color: var(--t-secondary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.35;
  }
  .trash-item-meta {
    font-size: 10px;
    color: var(--t-muted);
    margin-top: 1px;
  }
  .trash-detail-pane {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    min-width: 0;
  }
  .trash-detail-header {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 14px;
    border-bottom: 1px solid var(--b-subtle);
    flex-shrink: 0;
  }
  .trash-detail-cat {
    font-size: var(--fs-xs);
    color: var(--t-muted);
    font-weight: 500;
    flex: 1;
  }
  .trash-detail-actions { display: flex; gap: 4px; }
  .trash-detail-actions button {
    font-size: var(--fs-xs);
    font-family: inherit;
    font-weight: 500;
    padding: 4px 10px;
    border-radius: var(--r-small);
    cursor: pointer;
    transition: all var(--ease);
    border: 1px solid var(--b-subtle);
    background: var(--s-subtle);
    color: var(--t-secondary);
  }
  .trash-detail-actions .trash-restore-btn:hover {
    background: rgba(70,140,170,0.15);
    border-color: rgba(70,140,170,0.30);
    color: rgba(160,200,220,0.90);
  }
  .trash-detail-actions .trash-delete-btn:hover {
    background: rgba(140,50,50,0.18);
    border-color: rgba(180,70,70,0.25);
    color: rgba(220,130,130,0.85);
  }
  .trash-detail-body {
    flex: 1;
    overflow-y: auto;
    padding: 16px 18px;
    font-size: 13px;
    color: rgba(255,255,255,0.7);
    line-height: 1.7;
    font-family: 'JetBrains Mono', 'SF Mono', 'Consolas', monospace;
    word-break: break-word;
  }
  .trash-detail-empty {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--t-muted);
    font-size: var(--fs-sm);
  }
  .trash-empty-msg {
    text-align: center;
    padding: 24px 14px;
    color: var(--t-muted);
    font-size: var(--fs-sm);
  }

  /* ── Icon buttons (shared) ── circular action buttons in panels ── */
  .icon-btn {
    width: 30px; height: 30px;
    border-radius: var(--r-circle);
    background: rgba(96, 165, 250, 0.06);
    border: 1px solid rgba(96, 165, 250, 0.12);
    color: rgba(96, 165, 250, 0.55);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.15s cubic-bezier(0.34, 1.56, 0.64, 1);
    flex-shrink: 0;
    font-size: var(--fs-lg);
    line-height: 1;
    padding: 0;
    box-shadow: 0 0 8px rgba(96, 165, 250, 0.03);
  }
  .icon-btn:hover {
    background: rgba(96, 165, 250, 0.12);
    color: rgba(96, 165, 250, 0.85);
    border-color: rgba(96, 165, 250, 0.2);
    box-shadow: 0 0 12px rgba(96, 165, 250, 0.08);
    transform: translateY(-2px);
  }
  .icon-btn svg {
    width: 15px; height: 15px;
    stroke: currentColor;
    stroke-width: 1.5;
    fill: none;
    transition: all 0.15s ease;
  }
  .icon-btn:hover svg { stroke-width: 1.8; }
  .icon-btn--danger {
    border-color: rgba(255, 82, 82, 0.15);
    color: rgba(255, 82, 82, 0.5);
    background: rgba(255, 82, 82, 0.05);
  }
  .icon-btn--danger:hover {
    background: rgba(255, 82, 82, 0.12);
    color: rgba(255, 82, 82, 0.9);
    border-color: rgba(255, 82, 82, 0.25);
    box-shadow: 0 0 12px rgba(255, 82, 82, 0.1);
  }
  .icon-btn--gold {
    border-color: rgba(255, 183, 77, 0.15);
    color: rgba(255, 183, 77, 0.5);
    background: rgba(255, 183, 77, 0.05);
  }
  .icon-btn--gold:hover {
    background: rgba(255, 183, 77, 0.12);
    color: rgba(255, 183, 77, 0.9);
    border-color: rgba(255, 183, 77, 0.25);
    box-shadow: 0 0 12px rgba(255, 183, 77, 0.1);
  }
  .icon-btn--gold.active {
    background: rgba(255, 183, 77, 0.12);
    color: rgba(255, 183, 77, 0.9);
    border-color: rgba(255, 183, 77, 0.3);
  }
  .icon-btn--gold.active svg.filled { fill: currentColor; }

  /* ── Action buttons (shared) ── solid clickable actions ── */
  .action-btn {
    font-size: var(--fs-md);
    font-weight: 500;
    font-family: inherit;
    padding: 6px 14px;
    border-radius: var(--r-small);
    border: 1px solid var(--b-subtle);
    cursor: pointer;
    transition: all var(--ease);
    white-space: nowrap;
  }
  .action-btn--primary {
    background: var(--s-medium);
    color: var(--t-primary);
  }
  .action-btn--primary:hover {
    background: var(--s-active);
    color: var(--t-bright);
  }
  .action-btn--primary:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }
  .action-btn--ghost {
    background: var(--s-transparent);
    color: var(--t-muted);
    border-color: transparent;
  }
  .action-btn--ghost:hover {
    background: var(--s-hover);
    color: var(--t-primary);
  }
  .action-btn--danger {
    background: var(--accent-red-bg);
    color: var(--accent-red);
    border-color: rgba(255,82,82,0.12);
  }
  .action-btn--danger:hover {
    background: var(--accent-red-hover);
  }

  /* ── Pill badges (shared) ── small info pills ── */
  .pill-badge {
    font-size: var(--fs-xs);
    font-weight: 500;
    padding: 2px 8px;
    border-radius: var(--r-pill);
    background: var(--s-subtle);
    color: var(--t-muted);
    line-height: 1.5;
  }
  .pill-badge--blue {
    background: var(--accent-blue-bg);
    color: rgba(100,180,255,0.6);
  }

  /* ═══════════════════════════════════════════
     LAYOUTS PANEL
     ═══════════════════════════════════════════ */
  /* layouts-btn and layouts-panel now use shared .toolbar-btn and .dropdown-panel */

  .preset-save-bar {
    display: flex;
    gap: 6px;
    margin-bottom: 10px;
  }
  .preset-save-bar input {
    flex: 1;
    background: var(--s-subtle);
    border: 1px solid var(--b-subtle);
    border-radius: var(--r-small);
    padding: 6px 10px;
    color: var(--t-bright);
    font-size: var(--fs-md);
    font-family: inherit;
    outline: none;
    transition: border-color var(--ease);
  }
  .preset-save-bar input::placeholder {
    color: var(--t-faint);
  }
  .preset-save-bar input:focus {
    border-color: var(--b-hover);
  }
  .preset-save-bar button {
    background: var(--s-medium);
    border: 1px solid var(--b-subtle);
    color: var(--t-secondary);
    font-size: var(--fs-md);
    font-weight: 500;
    font-family: inherit;
    padding: 6px 12px;
    border-radius: var(--r-small);
    cursor: pointer;
    transition: all var(--ease);
    white-space: nowrap;
  }
  .preset-save-bar button:hover {
    background: var(--s-active);
    color: var(--t-bright);
    border-color: var(--b-hover);
  }

  .preset-list {
    max-height: 240px;
    overflow-y: auto;
  }

  .preset-row {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 7px 10px;
    border-radius: var(--r-card);
    cursor: pointer;
    transition: background 0.15s;
    position: relative;
  }
  .preset-row:hover { background: var(--s-hover); }
  .preset-row.active { background: var(--s-medium); }

  .preset-name {
    flex: 1;
    font-size: var(--fs-md);
    color: var(--t-secondary);
    font-weight: 500;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .preset-row:hover .preset-name { color: var(--t-primary); }
  .preset-row.active .preset-name { color: var(--t-bright); }

  .preset-badge {
    font-size: var(--fs-xs);
    font-weight: 500;
    color: var(--t-muted);
    background: var(--s-subtle);
    padding: 2px 8px;
    border-radius: var(--r-pill);
    flex-shrink: 0;
  }

  .preset-date {
    font-size: var(--fs-xs);
    color: var(--t-faint);
    flex-shrink: 0;
  }

  .preset-delete {
    background: none;
    border: none;
    color: var(--t-faint);
    font-size: var(--fs-lg);
    cursor: pointer;
    padding: 0 2px;
    line-height: 1;
    opacity: 0;
    transition: all 0.15s;
    flex-shrink: 0;
  }
  .preset-row:hover .preset-delete { opacity: 1; }
  .preset-delete:hover { color: var(--accent-red); }

  .preset-empty {
    text-align: center;
    padding: 18px 8px;
    font-size: var(--fs-md);
    color: var(--t-faint);
    letter-spacing: 0.02em;
    line-height: 1.7;
  }

  .preset-divider {
    height: 1px;
    background: rgba(255,255,255,0.06);
    margin: 6px 0;
  }
  .preset-row.builtin .preset-name {
    color: rgba(255,255,255,0.5);
    font-style: italic;
  }
  .preset-row.builtin.active .preset-name {
    color: rgba(255,255,255,0.85);
  }
  .preset-row.builtin .preset-badge {
    background: var(--accent-blue-bg);
    color: rgba(100,180,255,0.6);
    font-size: var(--fs-xs);
  }
  .preset-warning {
    font-size: 12px;
    color: rgba(255, 180, 0, 0.6);
    padding: 4px 0 2px;
    text-align: center;
    display: none;
  }
  .preset-warning.visible { display: block; }


  /* ═══════════════════════════════════════════
     WORKSPACES OVERLAY
     ═══════════════════════════════════════════ */

  /* ── Top-right controls group (trash + workspace) ── */
  #topright-controls {
    position: fixed;
    top: 64px;
    right: 12px;
    z-index: 400;
    display: flex;
    align-items: center;
    gap: 6px;
    font-family: inherit;
    user-select: none;
  }

  #topright-controls.viz-hidden {
    opacity: 0.4;
  }

  .topright-icon-btn {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(20, 20, 24, 0.7);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255,255,255,0.06);
    border-radius: 8px;
    color: var(--t-muted);
    cursor: pointer;
    transition: background 0.15s, border-color 0.15s, color 0.15s;
    position: relative;
    padding: 0;
    flex-shrink: 0;
  }

  .topright-icon-btn:hover {
    background: rgba(30, 30, 36, 0.85);
    border-color: rgba(255,255,255,0.1);
    color: var(--t-primary);
  }

  .topright-icon-btn.active {
    background: rgba(110,181,255,0.12);
    border-color: rgba(110,181,255,0.2);
    color: var(--accent-blue);
  }

  .topright-icon-btn svg {
    width: 14px;
    height: 14px;
    stroke: currentColor;
    stroke-width: 2;
    fill: none;
  }

  .topright-icon-btn .count-badge {
    position: absolute;
    top: -4px;
    right: -4px;
    font-size: 8px;
    min-width: 14px;
    height: 14px;
    padding: 0 3px;
    line-height: 14px;
    border-radius: 7px;
    text-align: center;
    font-weight: 600;
  }

  #workspace-overlay {
    position: relative;
    font-family: inherit;
    user-select: none;
  }

  #ws-indicator {
    display: flex;
    align-items: center;
    gap: 6px;
    height: 32px;
    padding: 0 10px;
    border-radius: 8px;
    background: rgba(20, 20, 24, 0.7);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255,255,255,0.06);
    cursor: pointer;
    transition: background 0.15s, border-color 0.15s;
    white-space: nowrap;
  }

  #ws-indicator:hover {
    background: rgba(30, 30, 36, 0.85);
    border-color: rgba(255,255,255,0.1);
  }

  #ws-indicator.open {
    background: rgba(30, 30, 36, 0.9);
    border-color: rgba(110,181,255,0.2);
  }

  .ws-icon {
    width: 13px; height: 13px;
    stroke: var(--t-muted);
    stroke-width: 2;
    fill: none;
    flex-shrink: 0;
  }

  #ws-indicator.has-workspace .ws-icon {
    stroke: var(--accent-blue);
  }

  #ws-active-name {
    font-size: 11.5px;
    color: var(--t-secondary);
    max-width: 140px;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  #ws-indicator.has-workspace #ws-active-name {
    color: var(--t-primary);
  }

  .ws-chevron {
    width: 11px; height: 11px;
    stroke: var(--t-dimmed);
    stroke-width: 2;
    fill: none;
    transition: transform 0.15s;
  }

  #ws-indicator.open .ws-chevron {
    transform: rotate(180deg);
  }

  /* ── Quick-save button (visible only when workspace active) ── */
  .ws-quick-save {
    display: none;
    width: 20px;
    height: 20px;
    align-items: center;
    justify-content: center;
    background: transparent;
    border: none;
    color: var(--t-dimmed);
    cursor: pointer;
    border-radius: 4px;
    padding: 0;
    transition: color 0.12s, background 0.12s;
    flex-shrink: 0;
    margin-left: -2px;
    margin-right: -2px;
  }

  .ws-quick-save svg {
    width: 11px;
    height: 11px;
    stroke: currentColor;
    stroke-width: 2;
    fill: none;
  }

  .ws-quick-save:hover {
    color: var(--accent-blue);
    background: rgba(110,181,255,0.12);
  }

  .ws-quick-save.saved {
    color: #64FFDA;
  }

  #ws-indicator.has-workspace .ws-quick-save {
    display: flex;
  }

  /* ── Dropdown ── */
  #ws-dropdown {
    position: absolute;
    top: calc(100% + 4px);
    right: 0;
    width: 260px;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.06);
    box-shadow: 0 8px 32px rgba(0,0,0,0.5);
    overflow: hidden;
    animation: menuDropIn 0.12s ease-out;
  }

  /* ── Save bar ── */
  .ws-save-bar {
    display: flex;
    gap: 6px;
    padding: 10px 0 8px 10px;
  }

  .ws-save-bar input {
    flex: 1;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.08);
    color: var(--t-primary);
    font-size: 12px;
    padding: 5px 8px;
    border-radius: 6px;
    font-family: inherit;
    outline: none;
    transition: border-color 0.15s;
  }

  .ws-save-bar input:focus {
    border-color: rgba(110,181,255,0.3);
  }

  .ws-save-bar input::placeholder {
    color: var(--t-dimmed);
  }

  #ws-save-btn {
    width: 32px;
    height: 32px;
    background: rgba(110,181,255,0.12);
    border: 1px solid rgba(110,181,255,0.15);
    border-radius: 6px;
    color: var(--accent-blue);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.12s;
    flex-shrink: 0;
  }

  #ws-save-btn:hover {
    background: rgba(110,181,255,0.22);
  }

  #ws-save-btn svg {
    width: 16px;
    height: 16px;
    stroke: currentColor;
    stroke-width: 2;
    fill: none;
  }

  .ws-divider {
    height: 1px;
    background: rgba(255,255,255,0.05);
    margin: 0 8px;
  }

  /* ── Workspace list ── */
  .ws-list {
    max-height: 240px;
    overflow-y: auto;
    padding: 4px 6px;
  }

  .ws-row {
    display: flex;
    align-items: center;
    padding: 6px 8px;
    border-radius: 6px;
    cursor: pointer;
    gap: 8px;
    transition: background 0.1s;
    margin: 1px 0;
  }

  .ws-row:hover {
    background: rgba(255,255,255,0.05);
  }

  .ws-row.active {
    background: rgba(110,181,255,0.08);
  }

  .ws-row-name {
    flex: 1;
    font-size: 12px;
    color: var(--t-secondary);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .ws-row.active .ws-row-name {
    color: var(--accent-blue);
  }

  .ws-row-meta {
    font-size: 10px;
    color: var(--t-dimmed);
    white-space: nowrap;
  }

  .ws-row-delete {
    opacity: 0;
    background: none;
    border: none;
    color: var(--t-muted);
    cursor: pointer;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 4px;
    transition: opacity 0.15s, color 0.1s, background 0.1s;
    flex-shrink: 0;
  }

  .ws-row:hover .ws-row-delete {
    opacity: 0.5;
  }

  .ws-row-delete:hover {
    opacity: 1 !important;
    color: var(--accent-red);
    background: rgba(255,82,82,0.1);
  }

  .ws-empty {
    padding: 20px 12px;
    text-align: center;
    color: var(--t-dimmed);
    font-size: 12px;
    font-style: italic;
  }

  /* ── Footer ── */
  .ws-footer {
    display: flex;
    gap: 4px;
    padding: 6px 8px;
  }

  .ws-footer-btn {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 5px;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.06);
    color: var(--t-muted);
    font-size: 11px;
    padding: 5px 8px;
    border-radius: 6px;
    cursor: pointer;
    font-family: inherit;
    transition: background 0.12s, color 0.12s;
  }

  .ws-footer-btn:hover {
    background: rgba(255,255,255,0.08);
    color: var(--t-secondary);
  }

  .ws-footer-btn svg {
    width: 12px;
    height: 12px;
    stroke: currentColor;
    stroke-width: 2;
    fill: none;
  }

  /* ── Grid overlay (CSS-only) ── */
  body.grid-active::after {
    content: '';
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    pointer-events: none;
    z-index: 1;
    background-image:
      linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
    background-size: 20px 20px;
  }


  .status-dot {
    width: 10px; height: 10px;
    border-radius: 50%;
    background: #555;
    transition: background 0.5s;
  }
  .status-dot.connected { background: #64FFDA; box-shadow: 0 0 8px #64FFDA; }
  .status-dot.error { background: #FF5252; box-shadow: 0 0 8px #FF5252; }

  /* ═══════════════════════════════════════════
     SEARCH BAR (inline in top bar)
     ═══════════════════════════════════════════ */
  #search-container {
    display: contents;
  }

  #search-wrapper {
    position: relative;
    width: 340px;
    max-width: 40vw;
    border-radius: 8px;
    padding: 1px;
    background: rgba(255,255,255,0.06);
    overflow: hidden;
    opacity: 1;
    transition: width 0.35s cubic-bezier(0.4, 0, 0.2, 1),
                max-width 0.35s cubic-bezier(0.4, 0, 0.2, 1),
                padding 0.35s cubic-bezier(0.4, 0, 0.2, 1),
                opacity 0.25s ease,
                background 0.3s,
                box-shadow 0.3s;
  }

  #search-wrapper.viz-hidden {
    width: 0;
    max-width: 0;
    padding: 0;
    opacity: 0;
    pointer-events: none;
  }

  #search-wrapper.focused {
    background: rgba(255, 255, 255, 0.12);
    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.1), 0 0 12px rgba(255, 255, 255, 0.04);
    animation: searchGlow 2.5s ease-in-out infinite;
  }

  @keyframes searchGlow {
    0%, 100% { box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.1), 0 0 12px rgba(255, 255, 255, 0.04); }
    50% { box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.18), 0 0 16px rgba(255, 255, 255, 0.07); }
  }

  #search-input {
    width: 100%;
    padding: 6px 36px 6px 12px;
    background: rgba(28, 28, 30, 0.7);
    border: none;
    border-radius: 7px;
    color: rgba(255, 255, 255, 0.9);
    font-size: 12px;
    font-weight: 400;
    outline: none;
    letter-spacing: 0.01em;
  }

  #search-input::placeholder {
    color: rgba(255,255,255,0.2);
    letter-spacing: 0.04em;
    font-weight: 400;
  }

  #search-badge {
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    background: var(--s-medium);
    color: var(--t-primary);
    font-size: 9px;
    font-weight: 600;
    padding: 1px 6px;
    border-radius: var(--r-pill);
    opacity: 0;
    transition: opacity 0.3s;
  }
  #search-badge.visible { opacity: 1; }

  #search-clear {
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: var(--t-muted);
    cursor: pointer;
    font-size: 14px;
    display: none;
    padding: 2px 6px;
    transition: color 0.15s;
  }
  #search-clear:hover { color: var(--t-bright); }

  /* ═══════════════════════════════════════════
     RESIZE HANDLES
     ═══════════════════════════════════════════ */
  .resize-handle {
    position: absolute;
    z-index: 10;
    opacity: 0;
    transition: opacity 0.2s;
  }
  .resizable:hover .resize-handle,
  .resize-handle.active { opacity: 1; }

  .resize-handle-r   { right: 0; top: 0; width: 6px; height: 100%; cursor: ew-resize; }
  .resize-handle-l   { left: 0; top: 0; width: 6px; height: 100%; cursor: ew-resize; }
  .resize-handle-b   { bottom: 0; left: 0; height: 6px; width: 100%; cursor: ns-resize; }
  .resize-handle-t   { top: 0; left: 0; height: 6px; width: 100%; cursor: ns-resize; }
  .resize-handle-br  { right: 0; bottom: 0; width: 14px; height: 14px; cursor: nwse-resize; }
  .resize-handle-bl  { left: 0; bottom: 0; width: 14px; height: 14px; cursor: nesw-resize; }
  .resize-handle-tr  { right: 0; top: 0; width: 14px; height: 14px; cursor: nesw-resize; }
  .resize-handle-tl  { left: 0; top: 0; width: 14px; height: 14px; cursor: nwse-resize; }

  /* Drag handle (top bar of panels) */
  .drag-handle {
    position: relative;
    z-index: 20;
    cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' viewBox='0 0 22 22'%3E%3Cpath d='M11 2l3 3.5h-2v4.5h4.5V8L20 11l-3.5 3v-2H12v4.5h2L11 20l-3-3.5h2v-4.5H5.5V14L2 11l3.5-3v2H10V5.5H8z' fill='rgba(255,255,255,0.65)' stroke='rgba(0,0,0,0.35)' stroke-width='0.6'/%3E%3C/svg%3E") 11 11, move;
    padding: 6px 0 4px 0;
    margin: -4px 0 6px 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .locked > .drag-handle .drag-grip { pointer-events: none; }
  .locked .drag-handle { cursor: default; }
  .locked .resize-handle { display: none; }
  .drag-handle:active {
    cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' viewBox='0 0 22 22'%3E%3Cpath d='M11 2l3 3.5h-2v4.5h4.5V8L20 11l-3.5 3v-2H12v4.5h2L11 20l-3-3.5h2v-4.5H5.5V14L2 11l3.5-3v2H10V5.5H8z' fill='%234FC3F7' stroke='rgba(0,0,0,0.35)' stroke-width='0.6'/%3E%3C/svg%3E") 11 11, move;
  }
  .drag-handle .drag-grip {
    width: 32px;
    height: 4px;
    border-radius: 2px;
    background: rgba(255,255,255,0.08);
    transition: background 0.2s;
  }
  .resizable:hover .drag-grip { background: rgba(255,255,255,0.14); }

  .dragging { transition: none !important; }

  /* Offset top resize handles below the drag handle area per panel */
  #category-sidebar > .resize-handle-t,
  #category-sidebar > .resize-handle-tl,
  #category-sidebar > .resize-handle-tr  { top: 56px; }
  .detail-card > .resize-handle-t,
  .detail-card > .resize-handle-tl,
  .detail-card > .resize-handle-tr       { top: 0; z-index: 25; }
  .trash-window > .resize-handle-t,
  .trash-window > .resize-handle-tl,
  .trash-window > .resize-handle-tr      { top: 44px; }
  .settings-panel > .resize-handle-t,
  .settings-panel > .resize-handle-tl,
  .settings-panel > .resize-handle-tr    { top: 40px; }

  /* ═══════════════════════════════════════════
     CATEGORY SIDEBAR (left)
     ═══════════════════════════════════════════ */
  #category-sidebar {
    position: fixed;
    top: 52px;
    left: calc(var(--explorer-width, 0px) + 20px);
    transition: left 0.3s cubic-bezier(0.22, 1, 0.36, 1);
    z-index: 100;
    padding: 0;
    max-height: calc(100vh - 80px);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    width: 220px;
    min-width: 160px;
    min-height: 100px;
  }
  #category-sidebar-body {
    flex: 1;
    overflow-y: auto;
    padding: 0 14px 14px;
    min-height: 0;
  }

  /* ── Sidebar header (single-row: title left, actions right) ── */
  .sidebar-header {
    display: flex;
    flex-direction: row;
    align-items: center;
    flex-shrink: 0;
    padding: 6px 6px 6px 12px;
    border-bottom: 1px solid var(--b-subtle);
    margin-bottom: 6px;
  }
  .sidebar-header-actions {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 2px;
    padding: 0;
    flex-shrink: 0;
  }
  .sidebar-header-title {
    order: -1;
    flex: 1;
    font-size: 11px;
    font-weight: 500;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    color: rgba(255,255,255,0.45);
    padding: 0;
    border-bottom: none;
    margin-bottom: 0;
    pointer-events: none;
  }
  .sidebar-header .pin-btn {
    position: relative !important;
    top: auto !important;
    right: auto !important;
    opacity: 1 !important;
    width: 22px;
    height: 22px;
  }
  #sidebar-label-controls {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 0 4px;
    margin-bottom: 10px;
  }

  .category-chip {
    display: flex;
    align-items: center;
    gap: 11px;
    padding: 8px 10px;
    border-radius: 8px;
    cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='22' viewBox='0 0 80 22'%3E%3Cpath d='M11 2l3 3.5h-2v4.5h4.5V8L20 11l-3.5 3v-2H12v4.5h2L11 20l-3-3.5h2v-4.5H5.5V14L2 11l3.5-3v2H10V5.5H8z' fill='rgba(255,255,255,0.65)' stroke='rgba(0,0,0,0.35)' stroke-width='0.6'/%3E%3Ctext x='23' y='15' font-size='11' font-family='system-ui,sans-serif' font-weight='500' fill='rgba(255,255,255,0.55)' stroke='rgba(0,0,0,0.4)' stroke-width='0.3' paint-order='stroke'%3Edrag me%3C/text%3E%3C/svg%3E") 11 11, move;
    transition: all 0.2s ease;
    margin-bottom: 2px;
    user-select: none;
  }
  .category-chip * { cursor: inherit; }
  .category-chip .category-dot,
  .category-chip .category-delete,
  .category-chip .cat-edit-icon { cursor: pointer; }

  .category-chip:hover { background: rgba(255,255,255,0.05); }
  .category-chip.inactive { opacity: 0.25; }
  .category-chip.drag-source {
    opacity: 0 !important;
    pointer-events: none;
    transition: opacity 0.1s ease !important;
  }

  /* ── Drag & Drop: Floating clone ── */
  .cat-drag-clone {
    position: fixed;
    z-index: 99999;
    pointer-events: none;
    border-radius: 8px;
    opacity: 0.97;
    will-change: transform;
    background: rgba(30, 30, 34, 0.98);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    box-shadow:
      0 20px 40px rgba(0,0,0,0.4),
      0 8px 16px rgba(0,0,0,0.25),
      0 0 0 1px rgba(255,255,255,0.06),
      0 0 32px rgba(79, 195, 247, 0.05);
  }

  /* ── Drag & Drop: Animated gap ── */
  #category-list.cat-dragging .category-chip,
  #category-list.cat-dragging .category-cluster-header,
  #category-list.cat-dragging .cluster-empty-hint {
    transition: margin 0.25s cubic-bezier(0.2, 0, 0, 1),
                opacity 0.15s ease;
  }
  #category-list.cat-dragging .drag-source {
    transition: opacity 0.1s ease !important;
  }
  .drag-gap-before {
    margin-top: var(--drag-gap, 36px) !important;
  }
  .drag-gap-after {
    margin-bottom: var(--drag-gap, 36px) !important;
  }

  /* ── Drag & Drop: Settle animation ── */
  @keyframes cat-drop-settle {
    0% { transform: scale(0.96); opacity: 0.5; }
    60% { transform: scale(1.02); }
    100% { transform: scale(1); opacity: 1; }
  }
  .category-chip.just-dropped,
  .category-cluster-header.just-dropped {
    animation: cat-drop-settle 0.25s cubic-bezier(0.22, 1, 0.36, 1);
  }

  .category-dot {
    width: 12px; height: 12px;
    border-radius: 50%;
    flex-shrink: 0;
    box-shadow: 0 0 4px currentColor;
    transition: transform 0.15s, box-shadow 0.15s;
  }
  .category-dot:hover {
    transform: scale(1.4);
    box-shadow: 0 0 8px currentColor;
  }

  /* Cluster headers */
  .category-cluster-header {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 10px 6px 10px;
    margin-top: 16px;
    margin-bottom: 4px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: rgba(255,255,255,0.5);
    border-left-width: 3px;
    border-left-style: solid;
    padding-left: 12px;
  }
  .category-cluster-header:first-child {
    margin-top: 0;
  }
  .category-cluster-header.inactive {
    opacity: 0.25;
  }
  .category-cluster-header {
    cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='22' viewBox='0 0 80 22'%3E%3Cpath d='M11 2l3 3.5h-2v4.5h4.5V8L20 11l-3.5 3v-2H12v4.5h2L11 20l-3-3.5h2v-4.5H5.5V14L2 11l3.5-3v2H10V5.5H8z' fill='rgba(255,255,255,0.65)' stroke='rgba(0,0,0,0.35)' stroke-width='0.6'/%3E%3Ctext x='23' y='15' font-size='11' font-family='system-ui,sans-serif' font-weight='500' fill='rgba(255,255,255,0.55)' stroke='rgba(0,0,0,0.4)' stroke-width='0.3' paint-order='stroke'%3Edrag me%3C/text%3E%3C/svg%3E") 11 11, move;
  }
  .category-cluster-header * { cursor: inherit; }
  .category-cluster-header .cluster-dot,
  .category-cluster-header .cluster-edit-btn,
  .category-cluster-header .cluster-delete-btn { cursor: pointer; }
  .category-cluster-header.drag-source {
    opacity: 0 !important;
    pointer-events: none;
    transition: opacity 0.1s ease !important;
  }
  .category-cluster-header.drag-over-cluster {
    background: rgba(79, 195, 247, 0.08) !important;
    box-shadow: inset 0 0 0 1.5px rgba(79, 195, 247, 0.25);
    border-radius: 6px;
    transition: all 0.2s cubic-bezier(0.2, 0, 0, 1);
  }
  .cluster-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
    cursor: pointer;
    transition: transform 0.15s;
  }
  .cluster-dot:hover {
    transform: scale(1.3);
  }
  .cluster-name {
    flex: 1;
  }
  .cluster-actions {
    display: flex;
    gap: 4px;
    opacity: 0;
    transition: opacity 0.2s;
  }
  .category-cluster-header:hover .cluster-actions {
    opacity: 1;
  }
  .cluster-edit-btn,
  .cluster-delete-btn {
    background: rgba(255,255,255,0.1);
    border: none;
    color: rgba(255,255,255,0.6);
    width: 20px;
    height: 20px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.15s;
  }
  .cluster-edit-btn:hover {
    background: rgba(255,255,255,0.2);
    color: rgba(255,255,255,0.9);
  }
  .cluster-delete-btn:hover {
    background: rgba(220,38,38,0.2);
    color: rgb(239,68,68);
  }
  .cluster-empty-hint {
    margin-left: 20px;
    padding: 6px 12px;
    font-size: 10px;
    color: rgba(255,255,255,0.25);
    font-style: italic;
    border: 1px dashed rgba(255,255,255,0.1);
    border-radius: 4px;
    text-align: center;
    margin-bottom: 4px;
  }
  .drag-over-cluster {
    background: rgba(79, 195, 247, 0.08) !important;
    box-shadow: inset 0 0 0 1.5px rgba(79, 195, 247, 0.25);
    border-radius: 6px;
    transition: all 0.2s cubic-bezier(0.2, 0, 0, 1);
  }

  /* Child categories (indented) */
  .category-chip-child {
    margin-left: 20px;
    opacity: 0.95;
  }

  .color-edit-picker {
    padding: 8px 10px;
    margin: 2px 0 4px;
    background: rgba(30, 30, 34, 0.95);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 10px;
    animation: colorPickerIn 0.12s ease-out;
  }
  @keyframes colorPickerIn {
    from { opacity: 0; transform: translateY(-4px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .color-edit-picker .color-swatch-row {
    margin-bottom: 0;
  }
  .color-edit-picker .color-swatch {
    width: 22px; height: 22px;
  }
  .color-edit-reset {
    background: none;
    border: none;
    color: rgba(255,255,255,0.3);
    font-size: 12px;
    cursor: pointer;
    padding: 4px 0 0;
    transition: color 0.15s;
    width: 100%;
    text-align: center;
  }
  .color-edit-reset:hover { color: rgba(255,255,255,0.7); }

  .category-label {
    font-size: 15px;
    font-weight: 500;
    color: rgba(255,255,255,0.7);
    flex: 1;
  }

  .category-count {
    font-size: 14px;
    font-weight: 500;
    color: rgba(255,255,255,0.3);
    min-width: 18px;
    text-align: right;
  }

  .category-chip .category-delete {
    display: none;
    background: none;
    border: none;
    color: var(--t-muted);
    font-size: 15px;
    cursor: pointer;
    padding: 0;
    width: 20px;
    height: 20px;
    line-height: 20px;
    text-align: center;
    flex-shrink: 0;
    margin-left: auto;
    transition: color 0.15s;
  }
  .category-chip:hover .category-delete { display: block; }
  .category-chip .category-delete:hover { color: var(--accent-red); }

  .category-desc-editor {
    padding: 6px 10px 8px;
    margin: 2px 0 4px;
    background: rgba(30, 30, 34, 0.95);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 10px;
    animation: colorPickerIn 0.12s ease-out;
  }
  .category-desc-editor label {
    font-size: 12px;
    color: rgba(255,255,255,0.3);
    display: block;
    margin-bottom: 4px;
  }
  .category-desc-editor textarea {
    width: 100%;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 6px;
    color: rgba(255,255,255,0.8);
    font-size: 15px;
    font-family: inherit;
    padding: 6px 8px;
    resize: vertical;
    min-height: 36px;
    max-height: 80px;
    outline: none;
    transition: border-color 0.15s;
  }
  .category-desc-editor textarea:focus {
    border-color: rgba(255,255,255,0.2);
  }
  .category-desc-actions {
    display: flex;
    gap: 6px;
    margin-top: 6px;
    justify-content: flex-end;
  }
  .category-desc-actions button {
    font-size: var(--fs-sm);
    font-family: inherit;
    font-weight: 500;
    padding: 4px 12px;
    border-radius: var(--r-small);
    border: 1px solid var(--b-subtle);
    cursor: pointer;
    transition: all var(--ease);
  }
  .desc-save-btn {
    background: var(--s-medium);
    color: var(--t-primary);
  }
  .desc-save-btn:hover { background: var(--s-active); color: var(--t-bright); }
  .desc-cancel-btn {
    background: none;
    color: var(--t-muted);
    border-color: transparent;
  }
  .desc-cancel-btn:hover { color: var(--t-secondary); background: var(--s-hover); }

  .category-label {
    cursor: default;
  }
  .category-label .cat-edit-icon {
    display: none;
    font-size: 13px;
    margin-left: 5px;
    opacity: 0.45;
    vertical-align: middle;
    cursor: pointer;
    transition: opacity 0.15s;
  }
  .category-chip:hover .category-label .cat-edit-icon {
    display: inline;
  }
  .category-label .cat-edit-icon:hover {
    opacity: 0.8;
  }

  #category-add-btn,
  #category-add-parent-btn {
    border-radius: var(--r-card);
    border: 1px dashed var(--b-light);
    background: var(--s-subtle);
    color: var(--t-muted);
    font-size: var(--fs-sm);
    font-weight: 500;
    font-family: inherit;
    letter-spacing: 0.3px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    transition: all var(--ease);
    padding: 7px 0;
  }
  #category-add-btn:hover,
  #category-add-parent-btn:hover {
    background: var(--s-hover);
    border-color: var(--b-visible);
    color: var(--t-primary);
    border-style: solid;
  }
  #category-add-btn svg,
  #category-add-parent-btn svg {
    width: 13px; height: 13px;
    stroke: currentColor;
    stroke-width: 2;
    fill: none;
  }

  #category-create-form {
    display: none;
    padding: 10px;
    margin-top: 8px;
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.06);
    border-radius: 10px;
  }
  #category-create-form[data-mode="parent"] #cat-parent-select,
  #category-create-form[data-mode="parent"] .styled-select {
    display: none;
  }
  #category-create-form.open { display: block; }

  .category-create-input {
    width: 100%;
    background: var(--s-subtle);
    border: 1px solid var(--b-subtle);
    border-radius: var(--r-small);
    padding: 7px 10px;
    color: var(--t-bright);
    font-size: var(--fs-base);
    outline: none;
    margin-bottom: 6px;
    transition: border-color var(--ease);
    font-family: inherit;
  }
  .category-create-input::placeholder { color: var(--t-faint); }
  .category-create-input:focus { border-color: var(--b-hover); }
  .category-create-input.invalid { border-color: rgba(255,82,82,0.5); }

  .color-swatch-row {
    display: flex;
    gap: 5px;
    flex-wrap: wrap;
    margin-bottom: 8px;
  }

  .color-swatch {
    width: 24px; height: 24px;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid transparent;
    transition: all 0.15s;
    padding: 0;
  }
  .color-swatch:hover { transform: scale(1.15); }
  .color-swatch.selected { border-color: rgba(255,255,255,0.8); transform: scale(1.15); }

  .category-form-actions {
    display: flex;
    gap: 6px;
  }
  .category-form-actions button {
    flex: 1;
    padding: 6px 0;
    border-radius: var(--r-small);
    font-size: var(--fs-md);
    font-weight: 500;
    font-family: inherit;
    cursor: pointer;
    transition: all var(--ease);
    border: 1px solid var(--b-subtle);
  }
  .category-form-btn-create {
    background: var(--s-medium);
    color: var(--t-primary);
  }
  .category-form-btn-create:hover {
    background: var(--s-active);
    color: var(--t-bright);
  }
  .category-form-btn-create:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }
  .category-form-btn-cancel {
    background: var(--s-transparent);
    color: var(--t-muted);
    border-color: transparent;
  }
  .category-form-btn-cancel:hover {
    background: var(--s-hover);
    color: var(--t-primary);
  }

  .category-form-error {
    font-size: 12px;
    color: #FF5252;
    margin-bottom: 6px;
    min-height: 14px;
  }

  .category-reassign-bar {
    padding: 8px;
    margin-top: 4px;
    background: rgba(255,82,82,0.08);
    border: 1px solid rgba(255,82,82,0.15);
    border-radius: 8px;
    font-size: 12px;
    color: rgba(255,255,255,0.6);
  }
  .category-reassign-bar select {
    width: 100%;
    margin: 6px 0;
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 6px;
    padding: 5px 8px;
    color: rgba(255,255,255,0.8);
    font-size: 13px;
    outline: none;
  }
  .category-reassign-bar select option {
    background: #1c1c1e;
    color: #e0e0e0;
  }
  .category-reassign-actions {
    display: flex;
    gap: 6px;
    margin-top: 6px;
  }
  .category-reassign-actions button {
    flex: 1;
    padding: 5px 0;
    border-radius: var(--r-small);
    font-size: var(--fs-md);
    font-weight: 500;
    font-family: inherit;
    cursor: pointer;
    border: 1px solid var(--b-subtle);
    transition: all var(--ease);
  }
  .reassign-confirm {
    background: var(--accent-red-bg);
    color: var(--accent-red);
    border-color: rgba(255,82,82,0.12);
  }
  .reassign-confirm:hover {
    background: var(--accent-red-hover);
  }
  .reassign-cancel-btn {
    background: var(--s-transparent);
    color: var(--t-muted);
    border-color: transparent;
  }
  .reassign-cancel-btn:hover {
    background: var(--s-hover);
    color: var(--t-primary);
  }

  /* ── Category delete flow ── */
  .cat-delete-options {
    display: flex;
    flex-direction: column;
    gap: 6px;
    margin: 16px 0 12px;
    text-align: left;
  }
  .cat-delete-option {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 14px;
    border-radius: var(--r-card);
    border: 1px solid var(--b-subtle);
    background: rgba(255,255,255,0.02);
    cursor: pointer;
    transition: all var(--ease);
  }
  .cat-delete-option:hover {
    background: rgba(255,255,255,0.04);
    border-color: rgba(255,255,255,0.10);
  }
  .cat-delete-option-icon {
    flex-shrink: 0;
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .cat-delete-option-icon svg {
    width: 18px;
    height: 18px;
    stroke-width: 1.6;
    fill: none;
    opacity: 0.75;
    transition: opacity var(--ease);
  }
  .cat-delete-option:hover .cat-delete-option-icon svg,
  .cat-delete-option.selected .cat-delete-option-icon svg { opacity: 1; }
  .cat-delete-option--delete .cat-delete-option-icon svg { stroke: #E8886F; }
  .cat-delete-option--export .cat-delete-option-icon svg { stroke: var(--accent-blue); }
  .cat-delete-option--migrate .cat-delete-option-icon svg { stroke: var(--accent-gold); }
  .cat-delete-option--delete.selected {
    border-color: rgba(232,136,111,0.35);
    background: rgba(232,136,111,0.06);
  }
  .cat-delete-option--export.selected {
    border-color: rgba(79,195,247,0.3);
    background: rgba(79,195,247,0.05);
  }
  .cat-delete-option--migrate.selected {
    border-color: rgba(255,215,0,0.3);
    background: rgba(255,215,0,0.04);
  }
  .cat-delete-option-text {
    flex: 1;
    min-width: 0;
  }
  .cat-delete-option-label {
    font-size: var(--fs-md);
    font-weight: 600;
    color: var(--t-bright);
    margin-bottom: 2px;
  }
  .cat-delete-option-desc {
    font-size: var(--fs-xs);
    color: var(--t-muted);
    line-height: 1.35;
  }
  .cat-delete-step {
    animation: tagModalFadeIn 0.15s ease-out;
  }
  .cat-delete-step .modal-select {
    margin-top: 8px;
  }
  .cat-delete-progress {
    font-size: var(--fs-xs);
    color: var(--t-muted);
    margin-top: 8px;
    text-align: center;
  }

  /* ═══════════════════════════════════════════
     DETAIL CARD (multi-instance, fade+scale)
     ═══════════════════════════════════════════ */
  .detail-card {
    position: fixed;
    z-index: 220;
    width: 480px;
    min-width: 320px;
    min-height: 200px;
    max-height: calc(100vh - 80px);
    overflow-y: auto;
    padding: 0;
    opacity: 0;
    transform: scale(0.95);
    pointer-events: none;
    transition: opacity 0.2s ease, transform 0.2s ease,
                width 0.35s cubic-bezier(0.4, 0, 0.2, 1),
                min-width 0.35s cubic-bezier(0.4, 0, 0.2, 1),
                max-height 0.35s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    flex-direction: column;
  }

  .detail-card.open { opacity: 1; transform: scale(1); pointer-events: auto; }
  .detail-card.resizing { transition: none; }

  /* ── Panel header — single-row: category left, actions right ── */
  .detail-header {
    display: flex;
    flex-direction: row;
    align-items: center;
    flex-shrink: 0;
    padding: 6px 6px 6px 12px;
    border-bottom: 1px solid var(--b-subtle);
    cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' viewBox='0 0 22 22'%3E%3Cpath d='M11 2l3 3.5h-2v4.5h4.5V8L20 11l-3.5 3v-2H12v4.5h2L11 20l-3-3.5h2v-4.5H5.5V14L2 11l3.5-3v2H10V5.5H8z' fill='rgba(255,255,255,0.65)' stroke='rgba(0,0,0,0.35)' stroke-width='0.6'/%3E%3C/svg%3E") 11 11, move;
  }
  .detail-header:active {
    cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' viewBox='0 0 22 22'%3E%3Cpath d='M11 2l3 3.5h-2v4.5h4.5V8L20 11l-3.5 3v-2H12v4.5h2L11 20l-3-3.5h2v-4.5H5.5V14L2 11l3.5-3v2H10V5.5H8z' fill='%234FC3F7' stroke='rgba(0,0,0,0.35)' stroke-width='0.6'/%3E%3C/svg%3E") 11 11, move;
  }
  .detail-header-actions {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 2px;
    padding: 0;
    flex-shrink: 0;
  }
  .detail-header-category {
    order: -1;
    flex: 1;
    min-width: 0;
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 0;
    border-bottom: none;
  }
  .detail-header-dot {
    width: 7px;
    height: 7px;
    border-radius: 50%;
    flex-shrink: 0;
    box-shadow: 0 0 6px currentColor;
  }
  .detail-header-name {
    font-size: 11px;
    font-weight: 500;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    color: rgba(255,255,255,0.45);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  /* Small icon buttons used in header */
  .detail-action-btn {
    width: 24px; height: 24px;
    border-radius: var(--r-circle);
    background: transparent;
    border: 1px solid transparent;
    color: var(--t-muted);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all var(--ease);
    padding: 0;
    flex-shrink: 0;
    position: relative;
  }
  .detail-action-btn svg {
    width: 13px; height: 13px;
    stroke: currentColor;
    stroke-width: 1.8;
    fill: none;
  }
  .detail-action-btn:hover {
    background: var(--s-hover);
    color: var(--t-primary);
    border-color: var(--b-light);
  }
  .detail-action-btn--gold:hover {
    color: var(--accent-gold);
    border-color: var(--accent-gold-border);
  }
  .detail-action-btn--gold.active {
    color: var(--accent-gold);
  }
  .detail-action-btn--gold.active svg,
  .detail-action-btn--gold.active svg.filled { fill: currentColor; }
  .detail-action-btn--danger:hover {
    color: var(--accent-red);
    border-color: rgba(255,82,82,0.25);
    background: var(--accent-red-bg);
  }
  .detail-action-btn--close {
    font-size: 15px;
    font-weight: 400;
    line-height: 1;
  }
  .detail-action-btn--close:hover {
    color: var(--t-bright);
  }
  /* Custom tooltip (JS-positioned, appended to body) */
  .ui-tooltip {
    display: none;
    position: fixed;
    pointer-events: none;
    z-index: 99999;
    padding: 5px 10px;
    border-radius: 6px;
    background: rgba(10, 12, 18, 0.92);
    border: 1px solid rgba(255,255,255,0.08);
    backdrop-filter: blur(12px);
    color: rgba(255,255,255,0.85);
    font-size: 11px;
    font-family: inherit;
    font-weight: 500;
    letter-spacing: 0.02em;
    white-space: nowrap;
    box-shadow: 0 4px 16px rgba(0,0,0,0.4), 0 0 0 1px rgba(255,255,255,0.04);
    opacity: 0;
    transform: translateY(4px);
    transition: opacity 0.15s ease, transform 0.15s ease;
  }
  .ui-tooltip.visible {
    opacity: 1;
    transform: translateY(0);
  }
  .ui-tooltip-arrow {
    position: absolute;
    width: 10px; height: 10px;
    pointer-events: none;
  }
  .ui-tooltip-arrow::after {
    content: '';
    position: absolute;
    border: 5px solid transparent;
  }
  .ui-tooltip.above .ui-tooltip-arrow {
    bottom: -10px; left: 50%; transform: translateX(-50%);
  }
  .ui-tooltip.above .ui-tooltip-arrow::after {
    border-top-color: rgba(10, 12, 18, 0.92);
  }
  .ui-tooltip.below .ui-tooltip-arrow {
    top: -10px; left: 50%; transform: translateX(-50%);
  }
  .ui-tooltip.below .ui-tooltip-arrow::after {
    border-bottom-color: rgba(10, 12, 18, 0.92);
  }
  .ui-tooltip.right .ui-tooltip-arrow {
    left: -10px;
  }
  .ui-tooltip.right .ui-tooltip-arrow::after {
    border-right-color: rgba(10, 12, 18, 0.92);
  }
  /* Separator dot between action groups */
  .detail-action-sep {
    width: 3px; height: 3px;
    border-radius: 50%;
    background: var(--b-light);
    flex-shrink: 0;
  }
  /* Drag-to-terminal grip */
  .detail-drag-to-term {
    cursor: grab;
    color: var(--accent-blue);
    opacity: 0.5;
    transition: opacity 0.15s;
  }
  .detail-drag-to-term:hover { opacity: 1; }
  .detail-drag-to-term:active { cursor: grabbing; }
  .detail-card.detail-dragging-to-term { opacity: 0.45; }

  /* ── Compact mode ── */
  .detail-card.compact {
    width: 240px !important;
    min-width: 0 !important;
    min-height: 0 !important;
    max-height: none !important;
    overflow: hidden;
  }
  .detail-card.compact .resize-handle {
    display: none;
  }

  /* Header: tighter */
  .detail-card.compact .detail-header {
    padding: 5px 4px 5px 10px;
  }
  .detail-card.compact [data-role="edit-btn"],
  .detail-card.compact [data-role="bookmark-btn"],
  .detail-card.compact [data-role="move-cat-btn"],
  .detail-card.compact [data-role="export-btn"],
  .detail-card.compact [data-role="delete-btn"],
  .detail-card.compact .detail-action-sep {
    width: 0;
    overflow: hidden;
    opacity: 0;
    padding: 0;
    border: none;
    margin: 0;
    pointer-events: none;
  }

  /* Body: nuclear hide everything, then whitelist */
  .detail-card.compact .detail-body {
    padding: 8px 12px 10px;
    overflow: hidden;
    text-align: center;
    display: flex !important;
    flex-direction: column;
    align-items: center;
    cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' viewBox='0 0 22 22'%3E%3Cpath d='M11 2l3 3.5h-2v4.5h4.5V8L20 11l-3.5 3v-2H12v4.5h2L11 20l-3-3.5h2v-4.5H5.5V14L2 11l3.5-3v2H10V5.5H8z' fill='rgba(255,255,255,0.65)' stroke='rgba(0,0,0,0.35)' stroke-width='0.6'/%3E%3C/svg%3E") 11 11, move;
  }
  /* Hide ALL children first */
  .detail-card.compact .detail-body > * {
    display: none !important;
  }
  /* Show: content wrapper (text) at top, subheader (importance) at bottom */
  .detail-card.compact .detail-body > .content-edit-wrap {
    display: block !important;
    order: 0;
    width: 100%;
  }
  .detail-card.compact .detail-body > .detail-subheader {
    display: flex !important;
    justify-content: center;
    order: 1;
    margin: 6px 0 0;
  }
  /* Inside content-wrap: hide everything except [data-role="content"] */
  .detail-card.compact .content-edit-wrap > *:not([data-role="content"]) {
    display: none !important;
  }

  /* Content: 2-line text excerpt, centered */
  .detail-card.compact [data-role="content"] {
    display: -webkit-box !important;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    margin-bottom: 0;
    font-size: 12px;
    text-align: center;
    line-height: 1.5;
  }

  /* Subheader as footer: only importance dots, hide linked chip */
  .detail-card.compact .detail-chip {
    display: none !important;
  }
  .detail-card.compact [data-role="importance"] {
    justify-content: center;
  }

  /* ── Panel body ── */
  .detail-body {
    padding: 14px 16px 16px;
    overflow-y: auto;
    flex: 1;
    transition: padding 0.3s ease;
  }

  /* ── Subheader — importance + chips ── */
  .detail-subheader {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 14px;
    flex-wrap: wrap;
  }
  [data-role="importance"] {
    display: flex;
    align-items: center;
    gap: 3px;
  }
  .detail-chip {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 3px 10px;
    border: 1px solid var(--b-subtle);
    border-radius: var(--r-pill);
    background: var(--s-subtle);
    color: var(--t-muted);
    font-size: var(--fs-xs);
    font-weight: 500;
    font-family: inherit;
    cursor: pointer;
    transition: all var(--ease);
    white-space: nowrap;
    letter-spacing: 0.02em;
  }
  .detail-chip:hover {
    color: var(--t-primary);
    background: var(--s-hover);
    border-color: var(--b-hover);
  }
  .detail-chip.active {
    color: var(--accent-blue);
    background: var(--accent-blue-bg);
    border-color: var(--accent-blue-border);
  }
  .detail-chip.active:hover {
    background: rgba(79,195,247,0.18);
  }
  .detail-chip svg {
    width: 10px; height: 10px;
    fill: none;
    stroke: currentColor;
    stroke-width: 2;
    stroke-linecap: round;
  }
  /* ── Category change modal ── */
  .cat-change-modal {
    min-width: 340px;
    max-width: 420px;
    max-height: 520px;
    display: flex;
    flex-direction: column;
    padding: 0;
    text-align: left;
  }
  .cat-change-modal-header {
    padding: 16px 20px 14px;
    border-bottom: 1px solid rgba(255,255,255,0.06);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    flex-shrink: 0;
  }
  .cat-change-modal-title {
    font-size: var(--fs-md);
    font-weight: 600;
    color: var(--t-bright);
    letter-spacing: 0.01em;
  }
  .cat-change-modal-from {
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .cat-change-from-label {
    font-size: 10px;
    color: var(--t-muted);
    text-transform: uppercase;
    letter-spacing: 0.06em;
  }
  .cat-change-from-badge {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 3px 10px 3px 7px;
    border-radius: 20px;
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.08);
    font-size: var(--fs-xs);
    color: var(--t-primary);
    font-weight: 500;
  }
  .cat-change-from-badge .cat-dot {
    width: 7px; height: 7px;
    border-radius: 50%;
    flex-shrink: 0;
    box-shadow: 0 0 4px currentColor;
  }
  .cat-change-modal-list {
    overflow-y: auto;
    max-height: 380px;
    padding: 8px 10px 10px;
  }
  .cat-modal-group-label {
    font-size: 10px;
    font-weight: 600;
    color: var(--t-muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    padding: 12px 10px 5px;
    user-select: none;
  }
  .cat-modal-group-label:first-child {
    padding-top: 4px;
  }
  .cat-modal-option {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 10px;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.12s, border-color 0.12s;
    font-size: var(--fs-base);
    color: var(--t-primary);
    text-transform: none;
    letter-spacing: normal;
    border: 1px solid transparent;
    position: relative;
  }
  .cat-modal-option:hover {
    background: rgba(255,255,255,0.05);
    color: var(--t-bright);
  }
  .cat-modal-option.active {
    background: var(--accent-blue-bg);
    border-color: var(--accent-blue-border);
    color: var(--t-bright);
  }
  .cat-modal-option.active:hover {
    background: var(--accent-blue-bg);
  }
  .cat-modal-child {
    padding-left: 22px;
  }
  .cat-modal-option .cat-opt-dot {
    width: 9px; height: 9px;
    border-radius: 50%;
    flex-shrink: 0;
    box-shadow: 0 0 5px currentColor;
  }
  .cat-opt-info {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 1px;
  }
  .cat-modal-option .cat-opt-name {
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .cat-modal-option .cat-opt-desc {
    font-size: 11px;
    color: var(--t-muted);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    line-height: 1.3;
  }
  .cat-modal-option:hover .cat-opt-desc {
    color: var(--t-secondary);
  }
  .cat-opt-check {
    width: 16px; height: 16px;
    flex-shrink: 0;
    fill: none;
    stroke: var(--accent-blue);
    stroke-width: 2.5;
    stroke-linecap: round;
    stroke-linejoin: round;
  }

  [data-role="content"] {
    font-family: 'JetBrains Mono', 'SF Mono', 'Consolas', monospace;
    font-size: 13px;
    line-height: 1.7;
    color: rgba(255,255,255,0.7);
    margin-bottom: 20px;
    word-break: break-word;
    position: relative;
  }

  /* Paragraphs */
  [data-role="content"] p, .trash-detail-body p {
    margin: 0 0 10px 0;
  }
  [data-role="content"] p:last-child, .trash-detail-body p:last-child { margin-bottom: 0; }

  /* H2 — main section */
  [data-role="content"] .mc-h2, .trash-detail-body .mc-h2 {
    font-size: 16px;
    font-weight: 600;
    color: rgba(255,255,255,0.92);
    margin: 0 0 12px 0;
    padding-bottom: 8px;
    border-bottom: 1px solid rgba(255,255,255,0.06);
    letter-spacing: -0.01em;
  }
  [data-role="content"] .mc-h2:first-child, .trash-detail-body .mc-h2:first-child { margin-top: 0; }

  /* H3 — subsection */
  [data-role="content"] .mc-h3, .trash-detail-body .mc-h3 {
    font-size: 14px;
    font-weight: 600;
    color: rgba(255,255,255,0.75);
    margin: 16px 0 6px 0;
    letter-spacing: 0.01em;
  }
  [data-role="content"] .mc-h3:first-child, .trash-detail-body .mc-h3:first-child { margin-top: 0; }

  /* H4+ / plain heading */
  [data-role="content"] .mc-h4, .trash-detail-body .mc-h4 {
    font-size: 13px;
    font-weight: 600;
    color: rgba(255,255,255,0.6);
    margin: 12px 0 4px 0;
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }

  /* Inline code */
  [data-role="content"] code, .trash-detail-body code {
    font-family: inherit;
    font-size: inherit;
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.04);
    border-radius: 5px;
    padding: 2px 7px;
    color: rgba(255,255,255,0.75);
    word-break: break-all;
  }

  /* Code block */
  [data-role="content"] .mc-codeblock, .trash-detail-body .mc-codeblock {
    font-family: inherit;
    font-size: inherit;
    line-height: 1.6;
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.04);
    border-radius: 10px;
    padding: 12px 14px;
    margin: 8px 0 12px 0;
    color: rgba(255,255,255,0.6);
    overflow-x: auto;
    white-space: pre;
  }

  /* Bold */
  [data-role="content"] strong, .trash-detail-body strong {
    font-weight: 600;
    color: rgba(255,255,255,0.88);
  }

  /* Lists */
  [data-role="content"] ul, .trash-detail-body ul {
    margin: 4px 0 12px 0;
    padding: 0;
    list-style: none;
  }

  [data-role="content"] li, .trash-detail-body li {
    position: relative;
    padding-left: 16px;
    margin-bottom: 5px;
    color: rgba(255,255,255,0.65);
    font-size: inherit;
    line-height: 1.65;
  }

  [data-role="content"] li::before, .trash-detail-body li::before {
    content: '';
    position: absolute;
    left: 2px;
    top: 8px;
    width: 5px;
    height: 5px;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
  }

  /* Key-value description after em dash or colon in list */
  [data-role="content"] li .kv-desc, .trash-detail-body li .kv-desc {
    color: rgba(255,255,255,0.4);
    font-weight: 400;
  }

  /* Divider */
  [data-role="content"] .mc-divider, .trash-detail-body .mc-divider {
    height: 1px;
    background: rgba(255,255,255,0.05);
    margin: 14px 0;
  }

  /* Key: Value standalone */
  [data-role="content"] .mc-kv, .trash-detail-body .mc-kv {
    margin-bottom: 4px;
    font-size: inherit;
    line-height: 1.65;
  }
  [data-role="content"] .mc-kv-key, .trash-detail-body .mc-kv-key {
    color: rgba(255,255,255,0.4);
    font-weight: 500;
  }
  [data-role="content"] .mc-kv-val, .trash-detail-body .mc-kv-val {
    color: rgba(255,255,255,0.75);
  }

  /* ── Content Edit Button ── */
  .content-edit-wrap {
    position: relative;
  }

  /* ── Markdown Editor ── */
  .md-editor-wrap {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 20px;
  }
  .md-toolbar {
    display: flex;
    gap: 4px;
    padding: 4px;
    background: var(--s-subtle);
    border: 1px solid var(--b-subtle);
    border-radius: var(--r-card);
  }
  .md-toolbar button {
    padding: 5px 10px;
    border: 1px solid transparent;
    border-radius: var(--r-small);
    background: transparent;
    color: var(--t-secondary);
    font-size: var(--fs-md);
    font-weight: 600;
    font-family: inherit;
    cursor: pointer;
    transition: all var(--ease);
    line-height: 1;
  }
  .md-toolbar button:hover {
    background: var(--s-medium);
    color: var(--t-bright);
    border-color: var(--b-light);
  }
  .md-toolbar button.active {
    background: var(--accent-blue-bg);
    color: var(--accent-blue);
    border-color: var(--accent-blue-border);
  }
  .md-textarea {
    width: 100%;
    min-height: 120px;
    max-height: 360px;
    overflow-y: auto;
    padding: 12px 14px;
    background: rgba(0,0,0,0.3);
    border: 1px solid var(--b-light);
    border-radius: var(--r-card);
    color: var(--t-primary);
    font-family: 'JetBrains Mono', 'SF Mono', 'Consolas', monospace;
    font-size: 13px;
    line-height: 1.6;
    resize: vertical;
    outline: none;
    transition: border-color var(--ease);
  }
  .md-textarea:focus {
    border-color: var(--accent-blue-border);
  }
  .md-editor-actions {
    display: flex;
    gap: 8px;
    justify-content: flex-end;
  }
  .md-editor-actions button {
    padding: 6px 16px;
    border-radius: var(--r-small);
    font-size: var(--fs-md);
    font-weight: 500;
    cursor: pointer;
    transition: all var(--ease);
    border: 1px solid;
  }
  .md-btn-cancel {
    background: transparent;
    border-color: var(--b-light) !important;
    color: var(--t-secondary);
  }
  .md-btn-cancel:hover {
    background: var(--s-hover);
    color: var(--t-primary);
  }
  .md-btn-save {
    background: var(--accent-blue-bg);
    border-color: var(--accent-blue-border) !important;
    color: var(--accent-blue);
  }
  .md-btn-save:hover {
    background: rgba(79,195,247,0.2);
  }

  .detail-section {
    margin-bottom: 16px;
  }

  .detail-label {
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: rgba(255,255,255,0.3);
    margin-bottom: 8px;
  }

  .tag-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }

  .tag-chip {
    font-size: var(--fs-sm);
    font-weight: 500;
    padding: 4px 10px;
    border-radius: var(--r-pill);
    background: var(--s-light);
    color: var(--t-secondary);
    border: 1px solid var(--b-subtle);
    display: inline-flex;
    align-items: center;
    gap: 0;
    cursor: default;
    transition: all 0.2s;
    position: relative;
  }
  .tag-chip:hover {
    border-color: var(--b-light);
  }
  .tag-chip .tag-remove {
    display: none;
    margin-left: 6px;
    color: var(--t-muted);
    font-size: 13px;
    line-height: 1;
    cursor: pointer;
    transition: color 0.15s;
  }
  .tag-chip:hover .tag-remove { display: inline; }
  .tag-chip .tag-remove:hover { color: var(--accent-red); }

  /* Confirmation modal overlay + panel */
  .tag-delete-overlay {
    position: fixed;
    inset: 0;
    z-index: 300;
    background: rgba(0,0,0,0.55);
    backdrop-filter: blur(18px) saturate(0.8);
    -webkit-backdrop-filter: blur(18px) saturate(0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    animation: tagModalFadeIn 0.15s ease-out;
  }
  @keyframes tagModalFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  .tag-delete-modal {
    background: rgba(28, 28, 30, 0.72);
    backdrop-filter: blur(40px) saturate(1.4);
    -webkit-backdrop-filter: blur(40px) saturate(1.4);
    border: 1px solid rgba(255, 255, 255, 0.06);
    border-radius: 14px;
    box-shadow: 0 2px 20px rgba(0, 0, 0, 0.4), inset 0 0.5px 0 rgba(255, 255, 255, 0.05);
    padding: 22px 28px;
    text-align: center;
    min-width: 260px;
    animation: tagModalScaleIn 0.15s ease-out;
  }
  @keyframes tagModalScaleIn {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
  }
  .tag-delete-modal-title {
    font-size: var(--fs-md);
    color: var(--t-secondary);
    margin-bottom: 6px;
  }
  .tag-delete-modal-tag {
    font-size: var(--fs-base);
    font-weight: 600;
    color: var(--t-bright);
    margin-bottom: 18px;
  }
  .tag-delete-modal-actions {
    display: flex;
    gap: 8px;
    justify-content: center;
  }
  .tag-delete-modal-actions button {
    font-size: var(--fs-sm);
    font-weight: 500;
    font-family: inherit;
    padding: 7px 22px;
    border-radius: var(--r-card);
    border: 1px solid var(--b-subtle);
    cursor: pointer;
    transition: all var(--ease);
  }
  .modal-select {
    width: 100%;
    margin-bottom: 16px;
    background: #111114;
    border: 1px solid var(--b-light);
    border-radius: var(--r-button);
    padding: 9px 12px;
    color: var(--t-bright);
    font-size: var(--fs-md);
    font-family: inherit;
    outline: none;
    appearance: none;
    -webkit-appearance: none;
    cursor: pointer;
    transition: all var(--ease);
  }
  select.modal-select {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 24 24' fill='none' stroke='rgba(255,255,255,0.35)' stroke-width='2.5' stroke-linecap='round'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 10px center;
    background-color: #111114;
    padding-right: 30px;
  }
  .modal-select:focus {
    border-color: var(--b-hover);
    background-color: #151518;
  }
  .modal-select option {
    background: #111114;
    color: #ccc;
    padding: 8px 12px;
  }

  /* ── Edit Category Modal (ecm) ── */
  .ecm {
    width: 380px;
    text-align: left;
    padding: 0;
    overflow: visible;
    background: rgba(18, 18, 22, 0.88);
    backdrop-filter: blur(48px) saturate(1.6);
    -webkit-backdrop-filter: blur(48px) saturate(1.6);
    border: 1px solid rgba(255,255,255,0.07);
    border-radius: 16px;
    box-shadow:
      0 0 0 0.5px rgba(0,0,0,0.5),
      0 24px 80px rgba(0,0,0,0.55),
      0 2px 12px rgba(0,0,0,0.3),
      inset 0 0.5px 0 rgba(255,255,255,0.06);
    animation: tagModalScaleIn 0.18s cubic-bezier(0.16, 1, 0.3, 1);
  }

  /* Header */
  .ecm-header {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 16px;
    border-bottom: 1px solid rgba(255,255,255,0.06);
  }
  .ecm-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
    box-shadow: 0 0 6px currentColor;
  }
  .ecm-title {
    font-size: 13px;
    font-weight: 600;
    color: var(--t-bright);
    flex: 1;
  }
  .ecm-close {
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
    background: transparent;
    color: var(--t-muted);
    font-size: 16px;
    cursor: pointer;
    border-radius: 6px;
    transition: all 0.12s;
    line-height: 1;
  }
  .ecm-close:hover {
    background: var(--s-hover);
    color: var(--t-primary);
  }

  /* Body */
  .ecm-body {
    padding: 14px 16px 10px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .ecm-divider {
    height: 1px;
    background: rgba(255,255,255,0.05);
    margin: 2px 0;
  }

  /* Fields */
  .ecm-field {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }
  .ecm-field label {
    font-size: 10px;
    font-weight: 600;
    color: var(--t-muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }
  .ecm-input {
    width: 100%;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 8px;
    padding: 7px 10px;
    color: var(--t-bright);
    font-size: 13px;
    font-family: inherit;
    outline: none;
    transition: border-color 0.15s, background 0.15s;
  }
  .ecm-input:focus {
    border-color: rgba(255,255,255,0.18);
    background: rgba(255,255,255,0.06);
  }
  .ecm-input::placeholder { color: var(--t-muted); }
  .ecm-textarea {
    resize: vertical;
    min-height: 48px;
    line-height: 1.4;
  }
  .ecm-select {
    appearance: none;
    -webkit-appearance: none;
    cursor: pointer;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 24 24' fill='none' stroke='rgba(255,255,255,0.3)' stroke-width='2.5' stroke-linecap='round'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 10px center;
    padding-right: 28px;
  }
  .ecm-select option {
    background: #111114;
    color: #ccc;
  }

  /* Name + color row */
  .ecm-name-row {
    display: flex;
    align-items: flex-end;
    gap: 8px;
  }
  .ecm-field--name { flex: 1; }
  .ecm-color-btn {
    width: 34px;
    height: 34px;
    padding: 3px;
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 8px;
    background: rgba(255,255,255,0.04);
    cursor: pointer;
    transition: border-color 0.15s;
    flex-shrink: 0;
  }
  .ecm-color-btn:hover {
    border-color: rgba(255,255,255,0.2);
  }
  .ecm-color-swatch {
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 5px;
  }
  .ecm-color-hidden {
    position: absolute;
    opacity: 0;
    pointer-events: none;
    width: 0;
    height: 0;
  }

  /* Grid for parent + toggle */
  .ecm-grid {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  /* Toggle switch */
  .ecm-toggle {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    font-size: 12px;
  }
  .ecm-toggle input { display: none; }
  .ecm-toggle-track {
    width: 30px;
    height: 16px;
    background: rgba(255,255,255,0.1);
    border-radius: 8px;
    position: relative;
    transition: background 0.2s;
    flex-shrink: 0;
  }
  .ecm-toggle input:checked + .ecm-toggle-track {
    background: var(--accent-blue);
  }
  .ecm-toggle-thumb {
    position: absolute;
    top: 2px;
    left: 2px;
    width: 12px;
    height: 12px;
    background: #fff;
    border-radius: 50%;
    transition: transform 0.2s cubic-bezier(0.16, 1, 0.3, 1);
    box-shadow: 0 1px 3px rgba(0,0,0,0.3);
  }
  .ecm-toggle input:checked + .ecm-toggle-track .ecm-toggle-thumb {
    transform: translateX(14px);
  }
  .ecm-toggle-label {
    color: var(--t-secondary);
  }

  /* Logo section */
  .ecm-logo-wrap {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    background: rgba(255,255,255,0.02);
    border: 1px solid rgba(255,255,255,0.05);
    border-radius: 10px;
  }
  .ecm-logo-img {
    height: 32px;
    max-width: 120px;
    object-fit: contain;
    border-radius: 4px;
  }
  .ecm-logo-empty {
    font-size: 11px;
    color: var(--t-muted);
  }
  .ecm-logo-actions {
    display: flex;
    gap: 6px;
    margin-left: auto;
  }
  .ecm-link-btn {
    font-size: 11px;
    font-family: inherit;
    color: var(--t-secondary);
    background: none;
    border: none;
    cursor: pointer;
    padding: 4px 8px;
    border-radius: 6px;
    transition: all 0.12s;
  }
  .ecm-link-btn:hover {
    background: var(--s-hover);
    color: var(--t-bright);
  }
  .ecm-link-btn--danger { color: var(--accent-red); }
  .ecm-link-btn--danger:hover {
    background: var(--accent-red-bg);
    color: var(--accent-red);
  }

  /* Footer */
  .ecm-footer {
    display: flex;
    gap: 6px;
    justify-content: flex-end;
    padding: 10px 16px 14px;
    border-top: 1px solid rgba(255,255,255,0.05);
  }
  .ecm-btn {
    font-size: 12px;
    font-weight: 500;
    font-family: inherit;
    padding: 6px 16px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    transition: all 0.12s;
  }
  .ecm-btn--ghost {
    background: transparent;
    color: var(--t-muted);
  }
  .ecm-btn--ghost:hover {
    background: var(--s-hover);
    color: var(--t-primary);
  }
  .ecm-btn--save {
    background: var(--accent-blue);
    color: #fff;
  }
  .ecm-btn--save:hover {
    filter: brightness(1.15);
  }
  .ecm-btn--save:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }
  .ecm .styled-select { margin-bottom: 0; }
  .ecm .styled-select-trigger {
    background: rgba(255,255,255,0.04);
    border-color: rgba(255,255,255,0.08);
    border-radius: 8px;
    padding: 7px 32px 7px 10px;
    font-size: 13px;
  }
  .ecm .styled-select-trigger:hover,
  .ecm .styled-select.open .styled-select-trigger {
    border-color: rgba(255,255,255,0.18);
    background: rgba(255,255,255,0.06);
  }

  /* ── Custom styled dropdown (replaces native <select>) ── */
  .styled-select {
    position: relative;
    width: 100%;
    margin-bottom: 16px;
  }
  .styled-select-trigger {
    width: 100%;
    display: flex;
    align-items: center;
    gap: 8px;
    background: #111114;
    border: 1px solid var(--b-light);
    border-radius: var(--r-button);
    padding: 9px 32px 9px 12px;
    color: var(--t-bright);
    font-size: var(--fs-md);
    font-family: inherit;
    cursor: pointer;
    transition: all var(--ease);
    position: relative;
    text-align: left;
    outline: none;
  }
  .styled-select-trigger::after {
    content: '';
    position: absolute;
    right: 11px;
    top: 50%;
    transform: translateY(-50%) rotate(0deg);
    width: 0;
    height: 0;
    border-left: 4px solid transparent;
    border-right: 4px solid transparent;
    border-top: 5px solid rgba(255,255,255,0.35);
    transition: transform 0.2s ease;
  }
  .styled-select.open .styled-select-trigger::after {
    transform: translateY(-50%) rotate(180deg);
  }
  .styled-select-trigger:hover,
  .styled-select.open .styled-select-trigger {
    border-color: var(--b-hover);
    background: #151518;
  }
  .styled-select-label {
    flex: 1;
    min-width: 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .styled-select-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  .styled-select-menu {
    position: absolute;
    top: calc(100% + 4px);
    left: 0;
    right: 0;
    z-index: 310;
    max-height: 220px;
    overflow-y: auto;
    background: rgba(20, 20, 22, 0.92);
    backdrop-filter: blur(24px) saturate(1.3);
    -webkit-backdrop-filter: blur(24px) saturate(1.3);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 10px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.5), inset 0 0.5px 0 rgba(255,255,255,0.04);
    padding: 4px;
    display: none;
    animation: styledSelectIn 0.12s ease-out;
  }
  .styled-select.open .styled-select-menu { display: block; }
  @keyframes styledSelectIn {
    from { opacity: 0; transform: translateY(-4px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .styled-select-menu::-webkit-scrollbar { width: 5px; }
  .styled-select-menu::-webkit-scrollbar-track { background: transparent; }
  .styled-select-menu::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); border-radius: 4px; }
  .styled-select-option {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 7px 10px;
    border-radius: 7px;
    cursor: pointer;
    color: var(--t-secondary);
    font-size: var(--fs-md);
    font-family: inherit;
    transition: all 0.1s ease;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .styled-select-option:hover {
    background: rgba(255,255,255,0.06);
    color: var(--t-bright);
  }
  .styled-select-option.active {
    background: rgba(99,102,241,0.12);
    color: var(--t-bright);
  }
  .styled-select-option .styled-select-dot { flex-shrink: 0; }

  /* ── Settings Panel (draggable/pinnable) ── */
  .settings-panel {
    position: fixed;
    z-index: 300;
    width: 620px;
    max-width: 92vw;
    min-width: 380px;
    min-height: 400px;
    animation: tagModalScaleIn 0.15s ease-out;
    display: flex;
    flex-direction: column;
    max-height: 80vh;
    overflow: hidden;
  }
  .settings-panel.dragging { transition: none; }
  .settings-panel-header {
    display: flex;
    align-items: center;
    padding: 10px 16px;
    border-bottom: 1px solid var(--b-subtle);
    gap: 8px;
  }
  .settings-panel-header h3 {
    flex: 1;
    font-size: 13px;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    font-weight: 500;
    color: rgba(255,255,255,0.45);
    margin: 0;
    pointer-events: none;
  }
  .settings-panel-header .pin-btn {
    position: relative;
    top: auto;
    right: auto;
    opacity: 1;
  }
  .settings-panel-close {
    width: 26px; height: 26px;
    display: flex; align-items: center; justify-content: center;
    background: transparent; border: none;
    color: var(--t-muted); cursor: pointer;
    border-radius: var(--r-circle);
    font-size: 18px; line-height: 1;
    transition: all var(--ease);
    padding: 0; flex-shrink: 0;
  }
  .settings-panel-close:hover { color: var(--t-bright); background: var(--s-hover); }
  .settings-panel-body {
    display: flex;
    flex: 1;
    overflow: hidden;
    min-height: 0;
  }
  .settings-nav {
    width: 154px;
    flex-shrink: 0;
    padding: 14px 10px;
    border-right: 1px solid var(--b-subtle);
    display: flex;
    flex-direction: column;
    gap: 2px;
    overflow-y: auto;
  }
  .settings-nav-item {
    position: relative;
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 9px 12px;
    font-size: 12.5px;
    font-weight: 500;
    font-family: inherit;
    color: var(--t-muted);
    background: transparent;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: color 0.15s ease, background 0.15s ease;
    text-align: left;
    white-space: nowrap;
    letter-spacing: 0.01em;
  }
  .settings-nav-item svg {
    width: 15px;
    height: 15px;
    flex-shrink: 0;
    stroke: currentColor;
    stroke-width: 1.8;
    fill: none;
    stroke-linecap: round;
    stroke-linejoin: round;
    opacity: 0.6;
    transition: opacity 0.15s ease;
  }
  .settings-nav-item:hover {
    color: var(--t-primary);
    background: var(--s-hover);
  }
  .settings-nav-item:hover svg { opacity: 0.85; }
  .settings-nav-item.active {
    color: var(--t-bright);
    background: rgba(255,255,255,0.06);
  }
  .settings-nav-item.active svg {
    opacity: 1;
    stroke: var(--accent-blue);
  }
  .settings-nav-item.active::before {
    content: '';
    position: absolute;
    left: 0;
    top: 6px;
    bottom: 6px;
    width: 3px;
    border-radius: 0 3px 3px 0;
    background: var(--accent-blue);
  }
  /* Visual separator between config tabs and view tabs */
  .settings-nav-sep {
    height: 1px;
    background: var(--b-subtle);
    margin: 6px 12px;
    flex-shrink: 0;
  }
  .settings-content {
    flex: 1;
    padding: 16px;
    overflow-y: auto;
    min-width: 0;
  }
  .settings-panel.locked .settings-panel-header {
    cursor: default;
  }
  .settings-panel-backdrop {
    position: fixed;
    inset: 0;
    z-index: 299;
    pointer-events: none;
  }
  .settings-field {
    margin-bottom: 16px;
  }
  .settings-field label {
    display: block;
    font-size: var(--fs-sm);
    font-weight: 500;
    color: var(--t-primary);
    margin-bottom: 5px;
  }
  .settings-hint {
    font-size: var(--fs-xs);
    color: var(--t-muted);
    line-height: 1.4;
  }
  .settings-field .settings-hint {
    margin-top: 3px;
  }
  .settings-field input[type="text"],
  .settings-field input[type="password"] {
    width: 100%;
    box-sizing: border-box;
    font-size: var(--fs-md);
    font-family: 'JetBrains Mono', 'SF Mono', 'Consolas', monospace;
    padding: 7px 10px;
    border-radius: var(--r-small);
    background: var(--s-subtle);
    color: var(--t-bright);
    border: 1px solid var(--b-light);
    outline: none;
    transition: border-color var(--ease);
  }
  .settings-field input[type="text"]:focus,
  .settings-field input[type="password"]:focus {
    border-color: var(--accent-blue-border);
  }
  .settings-field input::placeholder {
    color: var(--t-muted);
  }
  .settings-key-row {
    display: flex;
    gap: 6px;
    align-items: center;
  }
  .settings-key-row input {
    flex: 1;
    font-size: var(--fs-md);
    font-family: 'JetBrains Mono', 'SF Mono', 'Consolas', monospace;
    padding: 7px 10px;
    border-radius: var(--r-small);
    background: var(--s-subtle);
    color: var(--t-bright);
    border: 1px solid var(--b-light);
    outline: none;
    transition: border-color var(--ease);
  }
  .settings-key-row input:focus {
    border-color: var(--accent-blue-border);
  }
  .settings-key-row input::placeholder {
    color: var(--t-muted);
    font-family: 'JetBrains Mono', 'SF Mono', 'Consolas', monospace;
  }
  .settings-toggle-vis {
    width: 32px;
    height: 32px;
    border-radius: var(--r-small);
    background: var(--s-subtle);
    border: 1px solid var(--b-light);
    color: var(--t-muted);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: all var(--ease);
  }
  .settings-toggle-vis:hover {
    background: var(--s-hover);
    color: var(--t-primary);
    border-color: var(--b-hover);
  }
  .settings-toggle-vis svg {
    width: 14px;
    height: 14px;
    stroke: currentColor;
    stroke-width: 2;
    fill: none;
  }
  .settings-status {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: var(--fs-sm);
    color: var(--t-secondary);
    margin-bottom: 16px;
    padding: 8px 10px;
    background: var(--s-subtle);
    border-radius: var(--r-small);
    border: 1px solid var(--b-subtle);
  }
  .settings-status-dot {
    width: 8px;
    height: 8px;
    border-radius: var(--r-circle);
    flex-shrink: 0;
  }
  .settings-status-dot.connected { background: #4caf50; box-shadow: 0 0 6px rgba(76,175,80,0.5); }
  .settings-status-dot.disconnected { background: var(--accent-red); box-shadow: 0 0 6px rgba(255,82,82,0.4); }
  /* ── Settings tabs ── */
  .settings-tab-body { display: none; }
  .settings-tab-body.active { display: block; }
  /* ── Range sliders ── */
  .gfx-group-title {
    font-size: var(--fs-xs);
    font-weight: 600;
    color: var(--t-muted);
    text-transform: uppercase;
    letter-spacing: 0.6px;
    margin: 14px 0 6px;
    padding-bottom: 4px;
    border-bottom: 1px solid var(--b-subtle);
  }
  .gfx-group-title:first-child { margin-top: 0; }
  .gfx-row {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 6px;
  }
  .gfx-label {
    font-size: var(--fs-sm);
    color: var(--t-secondary);
    min-width: 110px;
    flex-shrink: 0;
  }
  .gfx-row input[type="range"] {
    flex: 1;
    height: 4px;
    -webkit-appearance: none;
    appearance: none;
    background: var(--b-light);
    border-radius: 2px;
    outline: none;
    cursor: pointer;
  }
  .gfx-row input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: var(--accent-blue);
    border: 2px solid rgba(0,0,0,0.4);
    cursor: pointer;
  }
  .gfx-val {
    font-size: var(--fs-xs);
    color: var(--t-muted);
    min-width: 36px;
    text-align: right;
    font-family: 'JetBrains Mono', 'SF Mono', 'Consolas', monospace;
  }
  .gfx-val-input {
    background: transparent;
    border: 1px solid transparent;
    border-radius: 4px;
    padding: 1px 2px;
    width: 38px;
    -moz-appearance: textfield;
    appearance: textfield;
  }
  .gfx-val-input:hover { border-color: var(--b-subtle); }
  .gfx-val-input:focus { border-color: var(--b-light); outline: none; background: rgba(255,255,255,0.04); }
  .gfx-val-input::-webkit-inner-spin-button,
  .gfx-val-input::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
  .gfx-reset-btn {
    margin-top: 12px;
    width: 100%;
    padding: 6px;
    font-size: var(--fs-sm);
    font-weight: 500;
    font-family: inherit;
    background: var(--accent-red-bg);
    border: 1px solid rgba(255,82,82,0.2);
    color: var(--accent-red);
    border-radius: var(--r-card);
    cursor: pointer;
    transition: all var(--ease);
  }
  .gfx-reset-btn:hover { background: var(--accent-red-hover); }

  /* Graphics presets */
  .gfx-presets {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
    margin-bottom: 16px;
  }
  .gfx-preset-card {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 3px;
    padding: 8px 6px;
    border-radius: 10px;
    border: 1px solid var(--b-subtle);
    background: var(--s-medium);
    cursor: pointer;
    transition: all 0.2s ease;
    overflow: hidden;
  }
  .gfx-preset-card::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 10px;
    opacity: 0;
    transition: opacity 0.3s;
    pointer-events: none;
  }
  .gfx-preset-card:hover {
    border-color: rgba(255,255,255,0.15);
    background: var(--s-hover);
  }
  .gfx-preset-card:hover::before { opacity: 0.5; }
  .gfx-preset-card.active {
    border-color: var(--accent-blue);
    box-shadow: 0 0 12px rgba(79,195,247,0.15);
  }
  .gfx-preset-card.active::before { opacity: 1; }
  .gfx-preset-name {
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--t-secondary);
  }
  .gfx-preset-card.active .gfx-preset-name { color: var(--t-bright); }
  .gfx-preset-desc {
    font-size: 9px;
    color: var(--t-muted);
    text-align: center;
    line-height: 1.3;
  }
  /* Per-preset gradient accents */
  .gfx-preset-card[data-preset="low"]::before {
    background: radial-gradient(ellipse at bottom, rgba(100,180,100,0.08) 0%, transparent 70%);
  }
  .gfx-preset-card[data-preset="medium"]::before {
    background: radial-gradient(ellipse at bottom, rgba(79,195,247,0.08) 0%, transparent 70%);
  }
  .gfx-preset-card[data-preset="high"]::before {
    background: radial-gradient(ellipse at bottom, rgba(171,71,188,0.1) 0%, transparent 70%);
  }
  .gfx-preset-card[data-preset="insane"]::before {
    background: radial-gradient(ellipse at bottom, rgba(255,145,0,0.12) 0%, transparent 70%);
  }
  .gfx-preset-card[data-preset="insane"].active {
    border-color: #ff9100;
    box-shadow: 0 0 16px rgba(255,145,0,0.2), 0 0 40px rgba(255,145,0,0.06);
    animation: insane-glow 2s ease-in-out infinite alternate;
  }
  @keyframes insane-glow {
    0% { box-shadow: 0 0 12px rgba(255,145,0,0.2), 0 0 30px rgba(255,145,0,0.05); }
    100% { box-shadow: 0 0 20px rgba(255,145,0,0.3), 0 0 50px rgba(255,145,0,0.1); }
  }

  /* ── Recall presets (Memory tab) ── */
  #recall-presets {
    grid-template-columns: repeat(3, 1fr);
  }
  #recall-presets .gfx-preset-card {
    padding: 10px 8px;
    gap: 2px;
  }
  .gfx-preset-card[data-recall-preset="150"]::before {
    background: radial-gradient(ellipse at bottom, rgba(76,175,80,0.1) 0%, transparent 70%);
  }
  .gfx-preset-card[data-recall-preset="150"].active {
    border-color: rgba(76,175,80,0.6);
    box-shadow: 0 0 12px rgba(76,175,80,0.15);
  }
  .gfx-preset-card[data-recall-preset="500"]::before {
    background: radial-gradient(ellipse at bottom, rgba(79,195,247,0.1) 0%, transparent 70%);
  }
  .gfx-preset-card[data-recall-preset="500"].active {
    border-color: rgba(79,195,247,0.6);
    box-shadow: 0 0 12px rgba(79,195,247,0.15);
  }
  .gfx-preset-card[data-recall-preset="0"]::before {
    background: radial-gradient(ellipse at bottom, rgba(171,71,188,0.1) 0%, transparent 70%);
  }
  .gfx-preset-card[data-recall-preset="0"].active {
    border-color: rgba(171,71,188,0.6);
    box-shadow: 0 0 12px rgba(171,71,188,0.15);
  }
  .recall-preview-box {
    margin-top: 14px;
    padding: 10px 12px;
    background: rgba(0,0,0,0.25);
    border: 1px solid var(--b-subtle);
    border-radius: 6px;
    font-family: 'SF Mono', 'Cascadia Code', 'JetBrains Mono', monospace;
    font-size: 10px;
    line-height: 1.5;
    color: var(--t-muted);
    max-height: 72px;
    overflow-y: auto;
    white-space: pre-wrap;
    word-break: break-word;
  }

  /* ── Interface Settings Layout ── */
  .iface-section {
    background: rgba(255,255,255,0.02);
    border: 1px solid rgba(255,255,255,0.04);
    border-radius: 10px;
    padding: 14px 16px 10px;
    margin-bottom: 12px;
  }
  .iface-section .gfx-group-title {
    margin-top: 0;
    border-bottom: none;
    padding-bottom: 0;
    margin-bottom: 10px;
    font-size: 11px;
    letter-spacing: 0.8px;
  }
  .iface-section .gfx-row { margin-bottom: 8px; }
  .iface-section .gfx-row:last-child { margin-bottom: 2px; }
  .iface-section .gfx-label { min-width: 130px; }

  /* Two-col layout for compact groups */
  .iface-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 12px;
  }
  .iface-grid .iface-section { margin-bottom: 0; }

  /* Theme presets */
  #iface-preset-cards {
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
  }
  #iface-preset-cards .gfx-preset-card {
    padding: 10px 8px;
    gap: 2px;
  }
  .gfx-preset-card[data-iface-preset="default"]::before {
    background: radial-gradient(ellipse at bottom, rgba(79,195,247,0.08) 0%, transparent 70%);
  }
  .gfx-preset-card[data-iface-preset="default"].active {
    border-color: rgba(79,195,247,0.6);
    box-shadow: 0 0 12px rgba(79,195,247,0.15);
  }
  .gfx-preset-card[data-iface-preset="frosted"]::before {
    background: radial-gradient(ellipse at bottom, rgba(150,200,255,0.1) 0%, transparent 70%);
  }
  .gfx-preset-card[data-iface-preset="frosted"].active {
    border-color: rgba(150,200,255,0.6);
    box-shadow: 0 0 12px rgba(150,200,255,0.15);
  }
  .gfx-preset-card[data-iface-preset="solid"]::before {
    background: radial-gradient(ellipse at bottom, rgba(200,200,200,0.08) 0%, transparent 70%);
  }
  .gfx-preset-card[data-iface-preset="solid"].active {
    border-color: rgba(200,200,200,0.5);
    box-shadow: 0 0 12px rgba(200,200,200,0.1);
  }
  .gfx-preset-card[data-iface-preset="minimal"]::before {
    background: radial-gradient(ellipse at bottom, rgba(100,220,180,0.08) 0%, transparent 70%);
  }
  .gfx-preset-card[data-iface-preset="minimal"].active {
    border-color: rgba(100,220,180,0.5);
    box-shadow: 0 0 12px rgba(100,220,180,0.1);
  }

  /* Accent color area */
  .iface-accent-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 12px;
  }
  .iface-accent-swatch {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    border: 2px solid rgba(255,255,255,0.1);
    flex-shrink: 0;
    transition: background var(--ease), border-color var(--ease), box-shadow var(--ease);
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  }
  .iface-accent-info {
    display: flex;
    flex-direction: column;
    gap: 1px;
  }
  .iface-accent-info .label {
    font-size: 11px;
    font-weight: 600;
    color: var(--t-muted);
    text-transform: uppercase;
    letter-spacing: 0.8px;
  }
  .iface-accent-info .value {
    font-size: var(--fs-xs);
    color: var(--t-secondary);
    font-family: 'SF Mono', 'Cascadia Code', monospace;
  }

  /* Reset btn override inside interface tab */
  .iface-reset-wrap {
    display: flex;
    justify-content: center;
    margin-top: 4px;
  }
  .iface-reset-wrap .gfx-reset-btn {
    font-size: 11px;
    padding: 5px 20px;
    opacity: 0.7;
    transition: opacity var(--ease);
  }
  .iface-reset-wrap .gfx-reset-btn:hover { opacity: 1; }

  /* Toggle row (checkbox + label) for interface settings */
  .iface-toggle-row {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    font-size: 12px;
    color: var(--t-primary);
  }
  .iface-toggle-row input[type="checkbox"] {
    -webkit-appearance: none;
    appearance: none;
    width: 14px;
    height: 14px;
    border: 1.5px solid var(--b-strong);
    border-radius: 3px;
    background: rgba(255,255,255,0.03);
    cursor: pointer;
    position: relative;
    flex-shrink: 0;
    transition: background 0.15s, border-color 0.15s;
  }
  .iface-toggle-row input[type="checkbox"]:checked {
    background: #4ade80;
    border-color: #4ade80;
  }
  .iface-toggle-row input[type="checkbox"]:checked::after {
    content: '';
    position: absolute;
    left: 3.5px;
    top: 1px;
    width: 4px;
    height: 7px;
    border: solid #fff;
    border-width: 0 1.5px 1.5px 0;
    transform: rotate(45deg);
  }
  .iface-toggle-row input[type="checkbox"]:hover {
    border-color: rgba(255,255,255,0.3);
  }

  /* ── Floor style grid (3-col inside section) ── */
  .gfx-floor-grid {
    grid-template-columns: repeat(3, 1fr);
    margin-bottom: 0;
  }
  .gfx-floor-grid .gfx-preset-card {
    padding: 8px 6px;
    gap: 1px;
  }
  .gfx-floor-grid .gfx-preset-name { font-size: 11px; }
  .gfx-floor-grid .gfx-preset-desc { font-size: 9.5px; }

  /* ── Memory Sync ── */
  .sync-check-btn {
    background: var(--s-subtle);
    border: 1px solid var(--b-subtle);
    color: var(--t-secondary);
    font-size: var(--fs-sm);
    font-weight: 500;
    font-family: inherit;
    letter-spacing: 0.04em;
    padding: 6px 14px;
    border-radius: var(--r-pill);
    cursor: pointer;
    transition: all var(--ease);
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }
  .sync-check-btn:hover {
    background: var(--s-hover);
    color: var(--t-primary);
    border-color: var(--b-light);
  }
  .sync-check-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }
  .sync-check-btn .spinner {
    width: 12px;
    height: 12px;
    border: 1.5px solid var(--t-muted);
    border-top-color: var(--accent-blue);
    border-radius: 50%;
    animation: syncSpin 0.6s linear infinite;
    display: none;
  }
  .sync-check-btn.loading .spinner { display: inline-block; }
  .sync-check-btn.loading .btn-label { display: none; }

  @keyframes syncSpin {
    to { transform: rotate(360deg); }
  }

  .sync-results {
    margin-top: 12px;
  }
  .sync-summary {
    font-size: var(--fs-sm);
    color: var(--t-secondary);
    margin-bottom: 10px;
  }
  .sync-summary strong {
    color: var(--accent-gold);
    font-weight: 600;
  }
  .sync-summary.clean strong {
    color: #4ade80;
  }
  .sync-card {
    background: rgba(0,0,0,0.2);
    border: 1px solid var(--b-subtle);
    border-radius: var(--r-card);
    padding: 10px 12px;
    margin-bottom: 8px;
    transition: border-color var(--ease), background var(--ease);
    cursor: pointer;
    user-select: none;
  }
  .sync-card:hover {
    border-color: var(--b-hover);
  }
  .sync-card.selected {
    background: rgba(255,255,255,0.05);
    border-color: rgba(255,255,255,0.2);
  }
  .sync-card-check {
    width: 14px;
    height: 14px;
    border-radius: 3px;
    border: 1.5px solid rgba(255,255,255,0.2);
    background: transparent;
    flex-shrink: 0;
    transition: all var(--ease);
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .sync-card.selected .sync-card-check {
    background: rgba(255,255,255,0.15);
    border-color: rgba(255,255,255,0.35);
  }
  .sync-card.selected .sync-card-check::after {
    content: '✓';
    font-size: 9px;
    color: var(--t-bright);
    line-height: 1;
  }
  .sync-select-all {
    font-size: var(--fs-xs);
    color: var(--t-muted);
    cursor: pointer;
    background: none;
    border: none;
    font-family: inherit;
    padding: 0;
    margin-bottom: 8px;
    transition: color var(--ease);
  }
  .sync-select-all:hover {
    color: var(--t-primary);
  }
  .sync-card-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 6px;
  }
  .sync-card-category {
    font-size: 9px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    padding: 2px 7px;
    border-radius: 10px;
    background: var(--accent-blue-bg);
    color: var(--accent-blue);
    border: 1px solid var(--accent-blue-border);
  }
  .sync-card-importance {
    font-size: 9px;
    font-weight: 600;
    padding: 2px 6px;
    border-radius: 10px;
    background: var(--accent-gold-bg);
    color: var(--accent-gold);
    border: 1px solid var(--accent-gold-border);
  }
  .sync-card-content {
    font-size: var(--fs-xs);
    color: var(--t-muted);
    line-height: 1.4;
    margin-bottom: 6px;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }
  .sync-card-files {
    font-size: 9px;
    color: var(--t-faint);
    font-family: 'JetBrains Mono', monospace;
    margin-bottom: 8px;
  }
  .sync-card-files span {
    color: var(--accent-gold);
  }
  .sync-copy-btn {
    background: var(--accent-blue-bg);
    border: 1px solid var(--accent-blue-border);
    color: var(--accent-blue);
    font-size: 10px;
    font-weight: 500;
    font-family: inherit;
    padding: 4px 10px;
    border-radius: var(--r-pill);
    cursor: pointer;
    transition: all var(--ease);
    width: 100%;
  }
  .sync-copy-btn:hover {
    background: rgba(79,195,247,0.2);
    border-color: rgba(79,195,247,0.4);
  }
  .sync-copy-btn.copied {
    background: rgba(74,222,128,0.12);
    border-color: rgba(74,222,128,0.3);
    color: #4ade80;
  }

  /* Advanced section collapsible */
  .gfx-advanced-toggle {
    display: flex;
    align-items: center;
    gap: 6px;
    width: 100%;
    padding: 8px 0;
    margin-top: 8px;
    background: none;
    border: none;
    border-top: 1px solid var(--b-subtle);
    color: var(--t-muted);
    font-size: var(--fs-xs);
    font-weight: 600;
    font-family: inherit;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    cursor: pointer;
    transition: color 0.2s;
  }
  .gfx-advanced-toggle:hover { color: var(--t-secondary); }
  .gfx-advanced-toggle .arrow {
    display: inline-block;
    transition: transform 0.2s;
    font-size: 10px;
  }
  .gfx-advanced-toggle.open .arrow { transform: rotate(90deg); }
  .gfx-advanced-body {
    display: none;
    padding-top: 4px;
  }
  .gfx-advanced-body.open { display: block; }
  .gfx-preset-label {
    font-size: var(--fs-xs);
    color: var(--t-muted);
    margin-bottom: 8px;
  }
  .settings-restart-notice {
    margin-top: 12px;
    padding: 10px 12px;
    background: rgba(255,215,0,0.08);
    border: 1px solid rgba(255,215,0,0.2);
    border-radius: var(--r-small);
    font-size: var(--fs-sm);
    color: var(--accent-gold);
    display: none;
  }
  .settings-actions {
    display: flex;
    justify-content: flex-end;
    gap: 8px;
    margin-top: 20px;
  }
  .settings-actions button {
    font-family: inherit;
    font-size: var(--fs-md);
    font-weight: 500;
    padding: 7px 18px;
    border-radius: var(--r-card);
    cursor: pointer;
    transition: all var(--ease);
  }
  .settings-btn-cancel {
    background: var(--s-subtle);
    border: 1px solid var(--b-light);
    color: var(--t-secondary);
  }
  .settings-btn-cancel:hover {
    background: var(--s-hover);
    color: var(--t-primary);
  }
  .settings-btn-save {
    background: var(--accent-blue-bg);
    border: 1px solid var(--accent-blue-border);
    color: var(--accent-blue);
  }
  .settings-btn-save:hover {
    background: rgba(79,195,247,0.18);
  }
  #settings-btn {
    border-radius: var(--r-card);
    border: 1px dashed var(--b-light);
    background: var(--s-subtle);
    color: var(--t-muted);
    font-size: var(--fs-sm);
    font-weight: 500;
    font-family: inherit;
    letter-spacing: 0.3px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    transition: all var(--ease);
    padding: 7px 0;
  }
  #settings-btn:hover {
    background: var(--s-hover);
    border-color: var(--b-visible);
    color: var(--t-primary);
    border-style: solid;
  }
  #settings-btn svg {
    width: 13px;
    height: 13px;
    stroke: currentColor;
    stroke-width: 2;
    fill: none;
  }

  .tag-add-input {
    font-size: var(--fs-sm);
    font-weight: 500;
    padding: 3px 10px;
    border-radius: var(--r-pill);
    background: var(--s-subtle);
    color: var(--t-secondary);
    border: 1px dashed var(--b-light);
    outline: none;
    width: 90px;
    transition: all var(--ease);
    font-family: inherit;
  }
  .tag-add-input::placeholder {
    color: var(--t-faint);
  }
  .tag-add-input:focus {
    border-color: var(--b-visible);
    background: var(--s-hover);
    width: 120px;
  }

  .detail-meta {
    font-size: 15px;
    color: rgba(255,255,255,0.3);
    line-height: 1.9;
  }

  .detail-meta span { color: rgba(255,255,255,0.55); font-weight: 500; }

  .detail-meta-row {
    display: flex;
    justify-content: space-between;
    padding: 3px 0;
    border-bottom: 1px solid rgba(255,255,255,0.03);
  }

  .detail-meta-row:last-child { border-bottom: none; }

  .meta-copy-btn {
    background: none;
    border: 1px solid transparent;
    color: var(--t-muted);
    cursor: pointer;
    padding: 2px 5px;
    border-radius: var(--r-small);
    font-size: var(--fs-xs);
    margin-left: 6px;
    transition: all var(--ease);
    line-height: 1;
  }
  .meta-copy-btn:hover {
    color: var(--t-primary);
    background: var(--s-hover);
    border-color: var(--b-light);
  }
  .meta-copy-btn.copied {
    color: var(--accent-blue);
  }

  .delete-confirm-no {
    background: var(--s-subtle);
    color: var(--t-muted);
  }
  .delete-confirm-no:hover {
    background: var(--s-hover);
    color: var(--t-primary);
  }

  /* ═══════════════════════════════════════════

  /* ── Memory Explorer (docked sidebar) ── */
  #explorer-panel {
    position: fixed;
    top: 0;
    left: 0;
    width: var(--explorer-width, 300px);
    min-width: 280px;
    height: 100vh;
    z-index: 200;
    display: flex;
    flex-direction: column;
    background: rgb(18, 18, 20);
    border-right: none;
    box-shadow: 2px 0 8px rgba(0,0,0,0.3);
    transform: translateX(-100%);
    transition: transform 0.3s cubic-bezier(0.22, 1, 0.36, 1);
    overflow: hidden;
  }
  #explorer-panel.open {
    transform: translateX(0);
    padding-top: 44px; /* clear the title bar when it spans full width */
  }


  .explorer-toolbar {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 2px;
    padding: 4px 8px 6px;
    border-bottom: 1px solid rgba(255,255,255,0.04);
    white-space: nowrap;
    flex-wrap: nowrap;
    flex-shrink: 0;
  }

  /* Filter bar */
  .explorer-filter {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 10px;
    flex-shrink: 0;
    position: relative;
  }
  .explorer-filter-icon {
    width: 13px;
    height: 13px;
    fill: none;
    stroke: var(--t-dimmed);
    stroke-width: 2;
    stroke-linecap: round;
    flex-shrink: 0;
    opacity: 0.4;
    transition: opacity 0.2s, stroke 0.2s;
    position: absolute;
    left: 18px;
    pointer-events: none;
  }
  .explorer-filter:focus-within .explorer-filter-icon {
    opacity: 0.7;
  }
  .explorer-filter input {
    flex: 1;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.07);
    border-radius: 6px;
    color: var(--t-primary);
    font-size: 11.5px;
    padding: 7px 10px 7px 28px;
    outline: none;
    font-family: var(--ff-mono);
    transition: border-color 0.2s, background 0.2s;
  }
  .explorer-filter input:focus {
    background: rgba(255,255,255,0.06);
    border-color: rgba(255,255,255,0.14);
  }
  .explorer-filter input::placeholder {
    color: var(--t-dimmed);
  }
  #explorer-filter-clear {
    background: none;
    border: none;
    color: var(--t-muted);
    cursor: pointer;
    font-size: 13px;
    padding: 2px 4px;
    line-height: 1;
    opacity: 0;
    transition: opacity 0.15s;
    border-radius: 3px;
  }
  #explorer-filter-clear:hover { opacity: 1; background: rgba(255,255,255,0.05); }
  .explorer-filter input:not(:placeholder-shown) ~ #explorer-filter-clear { opacity: 0.5; }

  /* Label size slider row */
  .explorer-slider-row {
    padding: 6px 12px;
    border-bottom: 1px solid rgba(255,255,255,0.04);
    flex-shrink: 0;
  }
  .explorer-slider-row input[type="range"] {
    width: 100%;
    height: 3px;
    accent-color: var(--accent-blue);
    cursor: pointer;
    opacity: 0.6;
    transition: opacity 0.2s;
  }
  .explorer-slider-row input[type="range"]:hover {
    opacity: 1;
  }

  /* Tree container */
  .explorer-tree {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    padding: 4px 0;
    min-height: 0;
  }

  /* Tree rows */
  .explorer-row {
    position: relative;
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 3px 10px;
    cursor: pointer;
    border-radius: 3px;
    font-size: 12px;
    white-space: nowrap;
    transition: background 0.12s;
    margin: 0 4px;
    min-height: 24px;
  }
  .explorer-row:hover {
    background: rgba(255,255,255,0.04);
  }

  /* Selected memory */
  .explorer-memory.selected > .explorer-row {
    background: rgba(99,102,241,0.15);
  }
  .explorer-memory.selected > .explorer-row:hover {
    background: rgba(99,102,241,0.2);
  }

  /* Chevron */
  .explorer-chevron {
    font-size: 7px;
    width: 12px;
    text-align: center;
    color: var(--t-muted);
    transition: transform 0.15s ease;
    flex-shrink: 0;
    user-select: none;
  }
  .explorer-node[data-expanded="true"] > .explorer-row > .explorer-chevron {
    transform: rotate(90deg);
  }

  /* Collapsed children hidden */
  .explorer-node[data-expanded="false"] > .explorer-children {
    display: none;
  }

  /* Category color dot */
  .explorer-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
    box-shadow: 0 0 4px currentColor;
  }

  /* Memory icon */
  .explorer-memory-icon {
    font-size: 8px;
    width: 12px;
    text-align: center;
    color: var(--t-dimmed);
    flex-shrink: 0;
  }
  .explorer-memory[draggable="true"] { cursor: grab; }
  .explorer-memory.dragging { opacity: 0.4; }

  /* Label — truncated */
  .explorer-label {
    overflow: hidden;
    text-overflow: ellipsis;
    flex: 1;
    min-width: 0;
    color: var(--t-secondary);
    font-family: var(--ff-mono);
    font-size: 11px;
  }
  .explorer-parent > .explorer-row > .explorer-label,
  .explorer-category > .explorer-row > .explorer-label {
    font-weight: 600;
    color: var(--t-primary);
    font-size: 11px;
  }

  /* Count badge */
  .explorer-badge {
    margin-left: auto;
    font-size: 10px;
    color: var(--t-dimmed);
    font-family: var(--ff-mono);
    flex-shrink: 0;
  }

  /* Importance dots */
  .explorer-importance {
    font-size: 5px;
    letter-spacing: -0.5px;
    color: rgba(255,215,0,0.35);
    flex-shrink: 0;
    line-height: 1;
  }
  .explorer-importance--high {
    color: rgba(255,215,0,0.7);
  }

  /* Footer */
  .explorer-footer {
    padding: 6px 12px;
    font-size: 10px;
    color: var(--t-dimmed);
    border-top: 1px solid var(--b-subtle);
    flex-shrink: 0;
    font-family: var(--ff-mono);
  }

  /* Right-edge resize handle */
  .explorer-resize-handle {
    position: absolute;
    top: 0;
    right: 0;
    width: 4px;
    height: 100%;
    cursor: col-resize;
    z-index: 10;
    transition: background 0.15s;
  }
  .explorer-resize-handle:hover,
  .explorer-resize-handle.active {
    background: rgba(99,102,241,0.4);
  }

  /* "..." context menu trigger — absolute, covers badge on hover */
  .explorer-more {
    position: absolute;
    right: 4px;
    top: 50%;
    transform: translateY(-50%);
    background: rgb(18, 18, 20);
    border: none;
    padding: 1px 6px;
    cursor: pointer;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.12s ease;
    font-size: 14px;
    color: var(--t-muted);
    border-radius: 3px;
    line-height: 1;
    letter-spacing: 1px;
    z-index: 2;
  }
  .explorer-row:hover .explorer-more {
    opacity: 1;
    pointer-events: auto;
  }
  .explorer-more:hover {
    color: var(--t-primary);
  }

  /* Context menu (body-appended, fixed position) */
  .explorer-ctx-menu {
    position: fixed;
    z-index: 100000;
    min-width: 170px;
    padding: 4px;
    background: rgba(18, 18, 22, 0.96);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 8px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.55), 0 1px 3px rgba(0,0,0,0.3);
    animation: explorerCtxIn 0.12s ease-out;
  }
  @keyframes explorerCtxIn {
    from { opacity: 0; transform: scale(0.95) translateY(-4px); }
    to   { opacity: 1; transform: scale(1) translateY(0); }
  }
  .explorer-ctx-item {
    display: flex;
    align-items: center;
    gap: 8px;
    width: 100%;
    padding: 6px 10px;
    background: none;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 12px;
    font-family: var(--ff-mono);
    color: var(--t-secondary);
    text-align: left;
    transition: background 0.1s, color 0.1s;
  }
  .explorer-ctx-item:hover {
    background: rgba(255,255,255,0.07);
    color: var(--t-primary);
  }
  .explorer-ctx-item--danger {
    color: var(--accent-red, #ef4444);
  }
  .explorer-ctx-item--danger:hover {
    background: rgba(239, 68, 68, 0.12);
    color: #f87171;
  }
  .explorer-ctx-icon {
    width: 15px;
    height: 15px;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .explorer-ctx-icon svg {
    width: 14px;
    height: 14px;
    fill: none;
    stroke: currentColor;
    stroke-width: 1.5;
  }
  .explorer-ctx-sep {
    height: 1px;
    margin: 3px 6px;
    background: rgba(255,255,255,0.06);
  }

  /* Dimmed category row when hidden from graph */
  .explorer-hidden-cat > .explorer-row .explorer-label,
  .explorer-hidden-cat > .explorer-row .explorer-dot,
  .explorer-hidden-cat > .explorer-row .explorer-badge,
  .explorer-hidden-cat > .explorer-row .explorer-chevron {
    opacity: 0.35;
  }

  /* ── Explorer drag-and-drop ── */

  .explorer-grip {
    width: 10px;
    font-size: 11px;
    text-align: center;
    color: rgba(255,255,255,0.15);
    cursor: grab;
    opacity: 0;
    transition: opacity 0.15s;
    flex-shrink: 0;
    user-select: none;
    line-height: 1;
  }
  .explorer-row:hover .explorer-grip { opacity: 1; }
  .explorer-grip:hover { color: rgba(255,255,255,0.4); }

  .explorer-drag-source {
    opacity: 0.15 !important;
    pointer-events: none;
  }
  .explorer-drag-source > .explorer-children { opacity: 0; }

  .explorer-drag-clone {
    position: fixed;
    z-index: 99999;
    pointer-events: none;
    background: rgba(20, 20, 24, 0.92);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 6px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.5);
    padding: 3px 10px;
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
    color: var(--t-primary);
    white-space: nowrap;
  }

  #explorer-tree.explorer-dragging .explorer-node {
    transition: margin 0.18s cubic-bezier(0.2, 0, 0, 1);
  }

  .explorer-node.explorer-drop-before,
  .explorer-node.explorer-drop-after {
    position: relative;
  }
  .explorer-drop-before { margin-top: var(--explorer-drag-gap, 30px) !important; }
  .explorer-drop-after { margin-bottom: var(--explorer-drag-gap, 30px) !important; }

  .explorer-drop-before::before,
  .explorer-drop-after::after {
    content: '';
    position: absolute;
    left: 12px;
    right: 12px;
    height: 2px;
    background: rgba(79, 195, 247, 0.5);
    border-radius: 1px;
  }
  .explorer-drop-before::before { top: -2px; }
  .explorer-drop-after::after { bottom: -2px; }

  .explorer-drop-reparent > .explorer-row {
    background: rgba(79, 195, 247, 0.08) !important;
    box-shadow: inset 0 0 0 1.5px rgba(79, 195, 247, 0.25);
    border-radius: 6px;
  }

  .explorer-just-dropped {
    animation: explorer-drop-settle 0.25s cubic-bezier(0.22, 1, 0.36, 1);
  }
  @keyframes explorer-drop-settle {
    0%   { transform: scale(0.96); opacity: 0.7; }
    60%  { transform: scale(1.02); }
    100% { transform: scale(1); opacity: 1; }
  }

  /* ── Multi-select bar (shared) ── */
  #multi-select-bar {
    position: fixed;
    top: 62px;
    left: calc(var(--explorer-width, 0px) + (100vw - var(--explorer-width, 0px)) / 2);
    transform: translateX(-50%);
    transition: left 0.3s cubic-bezier(0.22, 1, 0.36, 1);
    z-index: 95;
    padding: 8px 18px;
    display: none;
    gap: 12px;
    align-items: center;
    font-size: 13px;
    color: var(--t-primary);
  }
  #multi-select-bar.open { display: flex; }
  #multi-select-bar button {
    font-size: 12px;
    font-weight: 500;
    font-family: inherit;
    padding: 4px 12px;
    border-radius: var(--r-small);
    border: 1px solid var(--b-subtle);
    background: var(--s-subtle);
    color: var(--t-secondary);
    cursor: pointer;
    transition: all var(--ease);
  }
  #multi-select-bar button:hover {
    background: var(--s-hover);
    color: var(--t-bright);
    border-color: var(--b-hover);
  }

  /* ═══════════════════════════════════════════
     STATS BAR (bottom)
     ═══════════════════════════════════════════ */
  #stats-bar {
    position: fixed;
    bottom: calc(20px + var(--terminal-height, 0px));
    left: calc(var(--explorer-width, 0px) + (100vw - var(--explorer-width, 0px)) / 2);
    transform: translateX(-50%);
    transition: left 0.3s cubic-bezier(0.22, 1, 0.36, 1),
                bottom 0.3s cubic-bezier(0.22, 1, 0.36, 1);
    z-index: 100;
    padding: 8px 22px;
    display: flex;
    align-items: center;
    gap: 20px;
    font-size: 13px;
    font-weight: 500;
    color: rgba(255,255,255,0.35);
    letter-spacing: 0.03em;
  }

  .stat-value { color: rgba(255,255,255,0.6); font-weight: 600; }

  .stat-divider {
    width: 1px;
    height: 14px;
    background: rgba(255,255,255,0.08);
  }

  /* ═══════════════════════════════════════════
     LOADING STATE
     ═══════════════════════════════════════════ */
  #loading-overlay {
    position: fixed;
    inset: 0;
    z-index: 1000;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: #000000;
    transition: opacity 0.8s;
  }

  #loading-overlay.hidden {
    opacity: 0;
    pointer-events: none;
  }

  .loading-logo {
    height: 28px;
    width: auto;
    opacity: 0.5;
    margin-bottom: 12px;
  }

  #loading-text {
    font-size: 15px;
    font-weight: 500;
    letter-spacing: 0.4em;
    text-transform: uppercase;
    color: rgba(255, 255, 255, 0.45);
    animation: pulse 2.5s ease-in-out infinite;
  }

  #loading-sub {
    font-size: 15px;
    font-weight: 400;
    color: rgba(255,255,255,0.15);
    margin-top: 12px;
    letter-spacing: 0.1em;
  }

  @keyframes pulse {
    0%, 100% { opacity: 0.4; }
    50% { opacity: 1; }
  }

  #loading-overlay.error #loading-text { animation: none; opacity: 0.7; }
  #loading-overlay.error #loading-sub { color: rgba(255,255,255,0.3); }
  #loading-action {
    display: none;
    margin-top: 24px;
    text-align: center;
  }
  #loading-overlay.error #loading-action { display: block; }
  #loading-action-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 24px;
    background: rgba(255,255,255,0.08);
    border: 1px solid rgba(255,255,255,0.15);
    color: rgba(255,255,255,0.7);
    border-radius: 8px;
    font-size: 13px;
    font-family: inherit;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    letter-spacing: 0.05em;
  }
  #loading-action-btn:hover {
    background: rgba(255,255,255,0.12);
    border-color: rgba(255,255,255,0.25);
    color: rgba(255,255,255,0.9);
  }
  #loading-action-btn:disabled {
    opacity: 0.4;
    cursor: wait;
  }
  #loading-action-btn svg { width: 16px; height: 16px; fill: none; stroke: currentColor; stroke-width: 2; }
  #loading-action-status {
    margin-top: 10px;
    font-size: 11px;
    color: rgba(255,255,255,0.25);
    letter-spacing: 0.05em;
  }

  /* Server offline — mascot + start command */
  #loading-mascot {
    display: none;
    margin-bottom: 28px;
    position: relative;
    animation: mascot-sleep 4s ease-in-out infinite;
  }
  #loading-overlay.server-offline #loading-mascot { display: block; }
  @keyframes mascot-sleep {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-4px); }
  }
  #loading-zzz {
    position: absolute;
    top: -2px;
    right: -18px;
    font-size: 16px;
    opacity: 0;
    animation: zzz-float 3s ease-in-out infinite;
  }
  @keyframes zzz-float {
    0% { opacity: 0; transform: translate(0, 0) scale(0.7); }
    15% { opacity: 0.35; }
    60% { opacity: 0.2; transform: translate(8px, -18px) scale(1); }
    100% { opacity: 0; transform: translate(14px, -30px) scale(1.1); }
  }
  #loading-server-cmd {
    display: none;
    margin-top: 28px;
    text-align: center;
  }
  #loading-overlay.server-offline #loading-server-cmd { display: block; }
  #loading-server-cmd-hint {
    font-size: 12px;
    color: rgba(255,255,255,0.25);
    letter-spacing: 0.08em;
    margin-bottom: 12px;
  }
  #loading-server-cmd-box {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 10px 16px;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.10);
    border-radius: 8px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    color: rgba(255,255,255,0.6);
    user-select: all;
  }
  #loading-cmd-copy {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 6px;
    cursor: pointer;
    color: rgba(255,255,255,0.4);
    transition: all 0.2s;
    flex-shrink: 0;
  }
  #loading-cmd-copy:hover {
    background: rgba(255,255,255,0.12);
    color: rgba(255,255,255,0.8);
    border-color: rgba(255,255,255,0.22);
  }
  #loading-cmd-copy svg { width: 14px; height: 14px; fill: none; stroke: currentColor; stroke-width: 2; }
  #loading-retry-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    margin-top: 18px;
    padding: 8px 20px;
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.12);
    color: rgba(255,255,255,0.45);
    border-radius: 8px;
    font-size: 12px;
    font-family: inherit;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    letter-spacing: 0.06em;
  }
  #loading-retry-btn:hover {
    background: rgba(255,255,255,0.10);
    border-color: rgba(255,255,255,0.22);
    color: rgba(255,255,255,0.7);
  }
  #loading-retry-btn svg { width: 14px; height: 14px; fill: none; stroke: currentColor; stroke-width: 2; }
  #loading-retry-status {
    margin-top: 8px;
    font-size: 11px;
    color: rgba(255,255,255,0.2);
    letter-spacing: 0.05em;
    min-height: 16px;
  }

  /* ═══════════════════════════════════════════
     TOOLTIP
     ═══════════════════════════════════════════ */
  #tooltip {
    position: fixed;
    z-index: 200;
    padding: 10px 18px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.15s;
    font-size: 15px;
    max-width: 320px;
  }

  #tooltip.visible { opacity: 1; }
  #tooltip-category { font-size: 13px; letter-spacing: 0.15em; text-transform: uppercase; }
  #tooltip-preview { color: rgba(255,255,255,0.6); margin-top: 5px; font-size: 14px; line-height: 1.45; }
  #tooltip-importance { color: #FFD700; font-size: 14px; margin-top: 4px; }

/* ══════════════════════════════════════════════
   SKILLS STUDIO PANEL
   ══════════════════════════════════════════════ */

  /* Disable native tooltips in Skills Studio — use custom tooltips */
  .skills-studio-panel [data-tooltip] {
    position: relative;
  }
  /* Hide title attribute tooltips on any element within Skills Studio */
  .skills-studio-panel [title] {
    position: relative;
  }

  .ss-backdrop {
    position: fixed; inset: 0; z-index: 299;
    background: rgba(0,0,0,0.35);
    backdrop-filter: blur(2px);
    transition: background 0.3s ease, backdrop-filter 0.3s ease;
  }
  .ss-backdrop.focus {
    background: rgba(0,0,0,0.88);
    backdrop-filter: blur(6px);
  }

  .skills-studio-panel {
    position: fixed; z-index: 300;
    width: 980px; max-width: 95vw; min-width: 580px;
    height: 640px; max-height: 88vh; min-height: 360px;
    display: flex; flex-direction: column;
    overflow: hidden;
    opacity: 0; transform: scale(0.97);
    transition: opacity 0.15s ease, transform 0.15s ease;
  }
  .skills-studio-panel.open { opacity: 1; transform: scale(1); }

  /* ── Header ── */
  .ss-header {
    display: flex; align-items: center; gap: 10px;
    padding: 10px 14px;
    border-bottom: 1px solid var(--b-subtle);
    flex-shrink: 0; cursor: grab; user-select: none;
  }
  .ss-header:active { cursor: grabbing; }
  .ss-header-left {
    display: flex; align-items: center; gap: 8px; flex: 1; min-width: 0;
  }
  .ss-header h3 { margin: 0; font-size: var(--fs-base); font-weight: 600; color: var(--t-bright); white-space: nowrap; }
  .ss-count {
    font-size: 10px; color: var(--t-muted);
    background: var(--s-light); padding: 2px 8px; border-radius: var(--r-pill);
    font-weight: 500; letter-spacing: 0.02em;
    border: 1px solid var(--b-subtle);
  }
  .ss-header-actions { display: flex; gap: 6px; flex-shrink: 0; }
  .ss-header-btn {
    padding: 6px 14px; border-radius: var(--r-button);
    font-size: var(--fs-xs); font-weight: 500;
    background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
    color: var(--t-secondary); cursor: pointer;
    transition: all 0.15s ease;
    letter-spacing: 0.01em;
  }
  .ss-header-btn:hover {
    background: rgba(255,255,255,0.08);
    color: var(--t-bright);
    border-color: rgba(255,255,255,0.15);
  }
  .ss-header-btn:active {
    background: rgba(255,255,255,0.12);
  }
  .ss-header-btn:disabled { opacity: 0.3; cursor: default; pointer-events: none; }
  .ss-close {
    width: 28px; height: 28px; display: flex; align-items: center; justify-content: center;
    font-size: 18px; color: var(--t-muted); background: none; border: none;
    cursor: pointer; border-radius: var(--r-small); flex-shrink: 0;
    transition: all 0.15s ease;
  }
  .ss-close:hover { background: var(--s-hover); color: var(--t-bright); }

  .ss-focus-btn {
    width: 28px; height: 28px; display: flex; align-items: center; justify-content: center;
    background: none; border: 1px solid var(--b-subtle); color: var(--t-muted);
    cursor: pointer; border-radius: var(--r-small); flex-shrink: 0;
    transition: all 0.2s ease;
  }
  .ss-focus-btn svg { width: 15px; height: 15px; }
  .ss-focus-btn:hover { color: var(--t-bright); background: var(--s-hover); border-color: var(--b-light); }
  .ss-focus-btn.active {
    color: var(--accent-blue, #60a5fa);
    background: rgba(96, 165, 250, 0.12);
    border-color: rgba(96, 165, 250, 0.3);
  }

  /* ── Body layout ── */
  .ss-body { display: flex; flex: 1; min-height: 0; overflow: hidden; }

  /* ── Sidebar ── */
  .ss-sidebar {
    width: 300px; flex-shrink: 0;
    border-right: 1px solid var(--b-subtle);
    display: flex; flex-direction: column; overflow: hidden;
  }
  .ss-search-wrap { padding: 10px 12px 4px; }
  .ss-search {
    width: 100%; padding: 7px 10px;
    background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08);
    border-radius: var(--r-small); font-size: var(--fs-xs);
    color: var(--t-bright); outline: none;
    transition: all 0.15s ease;
  }
  .ss-search:hover { border-color: rgba(255,255,255,0.12); }
  .ss-search:focus {
    border-color: rgba(96, 165, 250, 0.4);
    background: rgba(96, 165, 250, 0.05);
    box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.08);
  }
  .ss-search::placeholder { color: var(--t-faint); }
  .ss-filters {
    display: flex; gap: 5px; padding: 8px 10px; flex-wrap: wrap;
  }
  .ss-filter {
    display: inline-flex; align-items: center; gap: 5px;
    padding: 4px 10px; border-radius: var(--r-pill);
    font-size: 10px; font-weight: 500;
    background: transparent; border: 1px solid rgba(255,255,255,0.1);
    color: var(--t-muted); cursor: pointer;
    transition: all 0.15s ease;
    letter-spacing: 0.01em;
  }
  .ss-filter:hover {
    border-color: rgba(255,255,255,0.16);
    color: var(--t-secondary);
    background: rgba(255,255,255,0.05);
  }
  .ss-filter.active {
    background: rgba(96, 165, 250, 0.12);
    border-color: rgba(96, 165, 250, 0.3);
    color: rgba(96, 165, 250, 0.9);
  }
  /* ── Filter/type color dots ── */
  .ss-filter-dot {
    display: inline-block; width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0;
  }
  .ss-filter-dot.skill { background: hsla(210, 65%, 62%, 1); box-shadow: 0 0 6px hsla(210, 65%, 62%, 0.35); }
  .ss-filter-dot.command { background: hsla(42, 65%, 58%, 1); box-shadow: 0 0 6px hsla(42, 65%, 58%, 0.35); }
  .ss-filter-dot.agent { background: hsla(20, 65%, 58%, 1); box-shadow: 0 0 6px hsla(20, 65%, 58%, 0.35); }
  .ss-library { flex: 1; overflow-y: auto; overflow-x: hidden; padding-bottom: 8px; }

  /* ── Library groups ── */
  .ss-group { margin-top: 2px; }
  .ss-group-header {
    display: flex; align-items: center; gap: 6px;
    padding: 8px 14px 5px; font-size: 10px; font-weight: 600;
    text-transform: uppercase; letter-spacing: 0.06em;
    color: var(--t-faint); user-select: none;
  }
  .ss-group-count {
    font-size: 9px; background: var(--s-subtle);
    padding: 1px 6px; border-radius: var(--r-pill); color: var(--t-muted);
    font-weight: 500;
  }
  .ss-item {
    display: flex; align-items: center; gap: 10px;
    padding: 7px 14px; cursor: pointer;
    border-left: 2px solid transparent;
    transition: background 0.12s ease;
  }
  .ss-item:hover { background: var(--s-subtle); }
  .ss-item.active {
    background: var(--s-light);
    border-left-color: hsla(var(--accent-hue, 210), 60%, 55%, 0.8);
  }
  .ss-item-icon {
    width: 28px; height: 28px; border-radius: 7px;
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0; line-height: 1;
  }
  .ss-item-icon svg { width: 14px; height: 14px; }
  .ss-item-icon.skill { background: hsla(210, 50%, 55%, 0.15); color: hsla(210, 70%, 72%, 1); }
  .ss-item-icon.command { background: hsla(45, 50%, 50%, 0.15); color: hsla(45, 70%, 68%, 1); }
  .ss-item-icon.agent { background: hsla(25, 50%, 50%, 0.15); color: hsla(25, 70%, 68%, 1); }
  .ss-item-icon.has-custom { background: transparent; padding: 2px; }
  .ss-item-custom-icon { width: 24px; height: 24px; object-fit: contain; border-radius: 4px; }
  .ss-item-info { flex: 1; min-width: 0; }
  .ss-item-name {
    font-size: var(--fs-xs); font-weight: 600; color: var(--t-primary);
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    display: flex; align-items: center; gap: 6px;
  }
  .ss-item-desc {
    font-size: 10px; color: var(--t-faint); margin-top: 2px;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    line-height: 1.3;
  }
  .ss-empty { padding: 24px 16px; text-align: center; color: var(--t-muted); font-size: var(--fs-xs); }
  .ss-item-name .ss-badge { font-size: 8px; padding: 1px 5px; vertical-align: middle; }

  /* ── Badges ── */
  .ss-badge {
    display: inline-flex; align-items: center; gap: 5px;
    font-size: 10px; padding: 2px 8px; border-radius: var(--r-pill);
    font-weight: 500; white-space: nowrap;
    border: 1px solid transparent; letter-spacing: 0.01em;
  }
  .ss-badge--skill { background: hsla(210, 50%, 50%, 0.1); color: hsla(210, 55%, 68%, 1); border-color: hsla(210, 50%, 50%, 0.15); }
  .ss-badge--command { background: hsla(45, 50%, 50%, 0.1); color: hsla(45, 60%, 62%, 1); border-color: hsla(45, 50%, 50%, 0.15); }
  .ss-badge--agent { background: hsla(25, 50%, 50%, 0.1); color: hsla(25, 60%, 62%, 1); border-color: hsla(25, 50%, 50%, 0.15); }
  .ss-badge--scope { background: var(--s-subtle); color: var(--t-muted); border-color: var(--b-subtle); }
  .ss-badge--muted { background: var(--s-subtle); color: var(--t-faint); border-color: var(--b-subtle); }
  .ss-badge--blue { background: hsla(210, 50%, 50%, 0.08); color: hsla(210, 55%, 68%, 0.85); border-color: hsla(210, 50%, 50%, 0.12); }

  /* ── Main area ── */
  .ss-main { flex: 1; min-width: 0; overflow: hidden; display: flex; flex-direction: column; }
  .ss-loading {
    flex: 1; display: flex; align-items: center; justify-content: center;
    color: var(--t-muted); font-size: var(--fs-sm);
  }

  /* ── Welcome / overview ── */
  .ss-welcome {
    flex: 1; display: flex; flex-direction: column;
    align-items: center; justify-content: center; gap: 20px;
    padding: 60px 48px 50px; text-align: center;
    background: linear-gradient(180deg, rgba(60,120,180,0.04) 0%, transparent 60%);
  }
  .ss-welcome-hero {
    display: flex; flex-direction: column;
    align-items: center; gap: 16px; position: relative;
  }
  .ss-welcome-logo {
    width: 140px; height: 140px; object-fit: contain;
    opacity: 0.95;
    filter: drop-shadow(0 8px 32px rgba(96, 165, 250, 0.2)) drop-shadow(0 0 16px rgba(96, 165, 250, 0.1));
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    animation: ss-logo-float 6s ease-in-out infinite;
  }
  @keyframes ss-logo-float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-4px); }
  }
  .ss-welcome h2 {
    margin: 0;
    font-family: 'Disket Mono', 'JetBrains Mono', monospace;
    font-size: clamp(2.0rem, 3.5vw, 2.8rem);
    font-weight: 400;
    color: rgba(255,255,255,0.95);
    letter-spacing: -0.02em;
    line-height: 1.2;
    text-shadow:
      0 2px 4px rgba(0,0,0,0.3),
      0 8px 20px rgba(96, 165, 250, 0.1);
  }
  .ss-welcome-sub {
    font-family: 'JetBrains Mono', monospace;
    color: rgba(255,255,255,0.45); font-size: 0.9rem; margin: 0; max-width: 450px;
    line-height: 1.6; font-weight: 400; letter-spacing: 0.02em;
  }
  .ss-stats-row {
    display: flex; gap: 18px; margin-top: 12px;
    animation: ss-stats-in 0.5s ease 0.2s both;
  }
  @keyframes ss-stats-in {
    from { opacity: 0; transform: translateY(12px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .ss-stat {
    display: flex; flex-direction: column; align-items: center; gap: 8px;
    padding: 22px 32px; border-radius: 12px;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.08);
    min-width: 120px;
    transition: all 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
    position: relative; overflow: hidden;
    backdrop-filter: blur(8px);
  }
  .ss-stat::before {
    content: ''; position: absolute; inset: 0;
    background: linear-gradient(135deg, rgba(96,165,250,0.1), transparent);
    opacity: 0; transition: opacity 0.25s ease;
    pointer-events: none;
  }
  .ss-stat:hover {
    background: rgba(255,255,255,0.07);
    border-color: rgba(255,255,255,0.14);
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(96,165,250,0.15), 0 4px 12px rgba(0,0,0,0.2);
  }
  .ss-stat:hover::before { opacity: 1; }
  .ss-stat-num {
    font-size: 32px; font-weight: 700; color: var(--t-bright);
    letter-spacing: -0.02em; line-height: 1;
  }
  .ss-stat-label {
    display: inline-flex; align-items: center; gap: 7px;
    font-size: 12px; color: rgba(255,255,255,0.55); font-weight: 500;
    text-transform: capitalize; letter-spacing: 0.5px;
  }
  .ss-welcome-hint {
    color: rgba(255,255,255,0.35); font-size: 12px; margin-top: 8px;
    font-weight: 400; letter-spacing: 0.01em;
  }

  /* ── Editor header ── */
  .ss-editor-header {
    display: flex; align-items: center; gap: 8px;
    padding: 8px 14px; border-bottom: 1px solid var(--b-subtle);
    flex-shrink: 0;
  }
  .ss-back-btn {
    padding: 3px 10px; border-radius: var(--r-button);
    font-size: var(--fs-xs); background: none; border: 1px solid var(--b-subtle);
    color: var(--t-muted); cursor: pointer; transition: all 0.15s ease;
  }
  .ss-back-btn:hover { border-color: var(--b-light); color: var(--t-secondary); }
  .ss-editor-name { font-size: var(--fs-sm); font-weight: 600; color: var(--t-bright); }
  .ss-editor-spacer { flex: 1; }
  .ss-save-btn.dirty {
    background: hsla(var(--accent-hue, 210), 50%, 50%, 0.15) !important;
    border-color: hsla(var(--accent-hue, 210), 50%, 55%, 0.35) !important;
    color: hsla(var(--accent-hue, 210), 60%, 72%, 1) !important;
    box-shadow: 0 0 8px hsla(var(--accent-hue, 210), 50%, 50%, 0.1);
  }
  .ss-export-btn:hover { background: hsla(var(--accent-hue, 210), 40%, 45%, 0.12); color: hsla(var(--accent-hue, 210), 55%, 70%, 1); border-color: hsla(var(--accent-hue, 210), 40%, 45%, 0.2); }
  .ss-delete-btn { color: var(--t-faint); }
  .ss-delete-btn:hover { background: hsla(0, 45%, 45%, 0.15) !important; color: hsla(0, 65%, 68%, 1) !important; border-color: hsla(0, 45%, 45%, 0.25) !important; }
  .ss-discard-btn:hover:not(:disabled) { background: hsla(35, 45%, 45%, 0.12); color: hsla(35, 60%, 65%, 1); border-color: hsla(35, 45%, 45%, 0.2); }
  .ss-install-btn { background: hsla(140, 35%, 40%, 0.1); border-color: hsla(140, 35%, 40%, 0.18); color: hsla(140, 45%, 62%, 1); }
  .ss-install-btn:hover { background: hsla(140, 35%, 40%, 0.18); border-color: hsla(140, 35%, 40%, 0.25); }

  /* ── Editor body (2-column) ── */
  .ss-editor-body { display: flex; flex: 1; min-height: 0; overflow: hidden; }
  .ss-editor-meta {
    width: 250px; flex-shrink: 0;
    border-right: 1px solid var(--b-subtle);
    overflow-y: auto; padding: 12px;
    display: flex; flex-direction: column; gap: 2px;
  }
  .ss-editor-content { flex: 1; display: flex; flex-direction: column; min-width: 0; }
  .ss-content-toolbar {
    display: flex; align-items: center; justify-content: space-between;
    padding: 5px 12px; border-bottom: 1px solid var(--b-subtle);
    flex-shrink: 0;
  }
  .ss-content-label { font-size: 10px; color: var(--t-faint); text-transform: uppercase; letter-spacing: 0.5px; }
  .ss-wrap-btn {
    font-size: 10px; padding: 2px 8px; border-radius: var(--r-pill);
    background: none; border: 1px solid var(--b-subtle);
    color: var(--t-muted); cursor: pointer;
    transition: all 0.15s ease;
  }
  .ss-wrap-btn:hover { border-color: var(--b-light); color: var(--t-secondary); }
  .ss-md-editor {
    flex: 1; background: rgba(0,0,0,0.15); border: none; border-radius: 0;
    padding: 12px 14px;
    font-family: 'JetBrains Mono', 'SF Mono', 'Consolas', monospace;
    font-size: 12px; line-height: 1.65; color: var(--t-bright);
    resize: none; outline: none; tab-size: 2;
    white-space: pre; overflow-wrap: normal; overflow-x: auto;
  }
  .ss-md-editor.wrap { white-space: pre-wrap; overflow-wrap: break-word; overflow-x: hidden; }

  /* ── Markdown toolbar ── */
  .ss-md-toolbar {
    display: flex; align-items: center; gap: 1px;
    padding: 3px 6px; border-bottom: 1px solid var(--b-subtle);
    background: rgba(0,0,0,0.08); flex-shrink: 0;
  }
  .ss-md-toolbar-sep {
    width: 1px; height: 16px; background: var(--b-subtle); margin: 0 4px;
  }
  .ss-md-tool {
    width: 26px; height: 24px; display: flex; align-items: center; justify-content: center;
    background: none; border: 1px solid transparent; border-radius: var(--r-small);
    color: var(--t-muted); cursor: pointer; font-size: 13px; padding: 0;
    transition: all 0.12s ease; font-weight: 600;
  }
  .ss-md-tool:hover { background: var(--s-hover); border-color: var(--b-subtle); color: var(--t-bright); }
  .ss-md-tool:active { background: var(--s-light); }
  .ss-md-tool svg { width: 14px; height: 14px; stroke: currentColor; fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
  .ss-md-tool[data-active="true"] { background: var(--s-light); color: var(--t-bright); border-color: var(--b-light); }

  /* ── Preview/Raw toggle in toolbar ── */
  .ss-view-toggle {
    display: flex; margin-left: auto; border: 1px solid var(--b-subtle); border-radius: var(--r-small); overflow: hidden;
  }
  .ss-view-toggle-btn {
    padding: 2px 10px; font-size: 10px; font-weight: 500;
    background: none; border: none; color: var(--t-muted);
    cursor: pointer; transition: all 0.12s ease;
    text-transform: uppercase; letter-spacing: 0.3px;
  }
  .ss-view-toggle-btn:hover { color: var(--t-secondary); }
  .ss-view-toggle-btn.active {
    background: var(--s-light); color: var(--t-bright);
  }

  /* ── Markdown preview pane ── */
  .ss-md-preview {
    flex: 1; padding: 16px 18px; overflow-y: auto;
    font-family: inherit; font-size: 13px; line-height: 1.7;
    color: var(--t-primary); display: none;
  }
  .ss-md-preview.visible { display: block; }
  .ss-md-preview h1 { font-size: 20px; font-weight: 700; color: var(--t-bright); margin: 0 0 12px; padding-bottom: 8px; border-bottom: 1px solid var(--b-subtle); }
  .ss-md-preview h2 { font-size: 16px; font-weight: 600; color: var(--t-bright); margin: 20px 0 8px; padding-bottom: 6px; border-bottom: 1px solid var(--b-subtle); }
  .ss-md-preview h3 { font-size: 14px; font-weight: 600; color: var(--t-bright); margin: 16px 0 6px; }
  .ss-md-preview h4 { font-size: 12px; font-weight: 600; color: var(--t-secondary); margin: 12px 0 4px; text-transform: uppercase; letter-spacing: 0.3px; }
  .ss-md-preview p { margin: 0 0 10px; }
  .ss-md-preview ul, .ss-md-preview ol { margin: 0 0 10px; padding-left: 22px; }
  .ss-md-preview li { margin-bottom: 4px; }
  .ss-md-preview strong { font-weight: 600; color: var(--t-bright); }
  .ss-md-preview em { font-style: italic; color: var(--t-secondary); }
  .ss-md-preview code {
    font-family: 'JetBrains Mono', monospace; font-size: 11.5px;
    background: rgba(0,0,0,0.25); padding: 2px 5px; border-radius: 3px;
    color: hsla(var(--accent-hue, 210), 50%, 72%, 1);
  }
  .ss-md-preview pre {
    background: rgba(0,0,0,0.3); border: 1px solid var(--b-subtle);
    border-radius: var(--r-small); padding: 12px 14px; margin: 8px 0 12px;
    overflow-x: auto;
  }
  .ss-md-preview pre code { background: none; padding: 0; color: var(--t-primary); font-size: 11.5px; }
  .ss-md-preview blockquote {
    border-left: 3px solid hsla(var(--accent-hue, 210), 50%, 55%, 0.4);
    margin: 8px 0; padding: 4px 14px; color: var(--t-muted); font-style: italic;
  }
  .ss-md-preview a { color: hsla(var(--accent-hue, 210), 60%, 65%, 1); text-decoration: none; }
  .ss-md-preview a:hover { text-decoration: underline; }
  .ss-md-preview hr { border: none; border-top: 1px solid var(--b-subtle); margin: 16px 0; }
  .ss-md-preview table { border-collapse: collapse; width: 100%; margin: 8px 0 12px; font-size: 12px; }
  .ss-md-preview th, .ss-md-preview td { padding: 6px 10px; border: 1px solid var(--b-subtle); text-align: left; }
  .ss-md-preview th { background: rgba(0,0,0,0.15); font-weight: 600; color: var(--t-bright); }
  .ss-md-preview img { max-width: 100%; border-radius: var(--r-small); }

  /* ── Mermaid diagrams ── */
  .ss-mermaid {
    margin: 12px 0; padding: 16px;
    background: rgba(0,0,0,0.12); border: 1px solid var(--b-subtle);
    border-radius: var(--r-base); overflow-x: auto; text-align: center;
  }
  .ss-mermaid svg { max-width: 100%; height: auto; }
  .ss-mermaid-loading { font-size: 11px; color: var(--t-muted); font-style: italic; }
  .ss-mermaid-error { font-size: 11px; color: #f87171; margin-bottom: 8px; }
  .ss-mermaid-src {
    text-align: left; font-size: 11px; padding: 8px; margin: 4px 0 0;
    background: rgba(0,0,0,0.2); border-radius: var(--r-small);
    color: var(--t-muted); white-space: pre-wrap; overflow-x: auto;
  }

  /* ── Metadata form ── */
  .ss-meta-section { display: flex; flex-direction: column; gap: 12px; }
  .ss-field { display: flex; flex-direction: column; gap: 3px; }
  .ss-field > label {
    font-size: 10px; font-weight: 600; color: var(--t-muted);
    text-transform: uppercase; letter-spacing: 0.4px;
  }
  .ss-field-hint { font-weight: 400; text-transform: none; letter-spacing: 0; opacity: 0.6; }

  /* ── Icon upload widget ── */
  .ss-icon-field { margin-bottom: 2px; }
  .ss-icon-upload { display: flex; align-items: center; gap: 10px; }
  .ss-icon-preview {
    width: 40px; height: 40px; border-radius: 8px;
    border: 1px dashed var(--b-light);
    display: flex; align-items: center; justify-content: center;
    overflow: hidden; flex-shrink: 0; background: var(--s-subtle);
  }
  .ss-icon-preview-img { width: 100%; height: 100%; object-fit: contain; }
  .ss-icon-placeholder {
    display: flex; align-items: center; justify-content: center;
    width: 100%; height: 100%; opacity: 0.4;
  }
  .ss-icon-placeholder svg { width: 18px; height: 18px; }
  .ss-icon-placeholder.skill { color: hsla(210, 70%, 72%, 1); }
  .ss-icon-placeholder.command { color: hsla(45, 70%, 68%, 1); }
  .ss-icon-placeholder.agent { color: hsla(25, 70%, 68%, 1); }
  .ss-icon-actions { display: flex; flex-direction: column; gap: 4px; }
  .ss-icon-upload-btn {
    font-size: 10px; padding: 3px 10px;
    background: var(--s-subtle); border: 1px solid var(--b-light);
    border-radius: var(--r-small); color: var(--t-secondary);
    cursor: pointer; text-align: center;
    transition: background 0.15s, color 0.15s;
  }
  .ss-icon-upload-btn:hover { background: var(--s-light); color: var(--t-bright); }
  .ss-icon-remove-btn {
    font-size: 10px; padding: 2px 10px;
    background: transparent; border: 1px solid transparent;
    border-radius: var(--r-small); color: var(--t-faint);
    cursor: pointer;
  }
  .ss-icon-remove-btn:hover { color: hsla(0, 65%, 68%, 1); border-color: hsla(0, 45%, 45%, 0.2); }
  .ss-input {
    width: 100%; padding: 6px 10px;
    background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08);
    border-radius: var(--r-small); font-size: var(--fs-xs);
    color: var(--t-bright); outline: none;
    transition: all 0.15s ease;
  }
  .ss-input:hover { border-color: rgba(255,255,255,0.12); }
  .ss-input:focus {
    border-color: rgba(96, 165, 250, 0.4);
    background: rgba(96, 165, 250, 0.05);
    box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.08);
  }
  .ss-textarea {
    width: 100%; padding: 8px 10px;
    background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08);
    border-radius: var(--r-small); font-size: 11px;
    color: var(--t-primary); outline: none;
    resize: vertical; line-height: 1.5;
    font-family: inherit;
    transition: all 0.15s ease;
  }
  .ss-textarea:hover { border-color: rgba(255,255,255,0.12); }
  .ss-textarea:focus {
    border-color: rgba(96, 165, 250, 0.4);
    background: rgba(96, 165, 250, 0.05);
    box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.08);
  }
  .ss-textarea-sm { min-height: 120px; }

  /* ── Custom checkbox toggle ── */
  .ss-checkbox-row { display: flex; align-items: center; gap: 8px; padding: 3px 0; }
  .ss-checkbox-row input[type="checkbox"] {
    -webkit-appearance: none; appearance: none;
    width: 32px; height: 17px; border-radius: 10px;
    background: var(--s-light); border: 1px solid var(--b-light);
    position: relative; cursor: pointer; flex-shrink: 0;
    transition: background 0.2s ease, border-color 0.2s ease;
  }
  .ss-checkbox-row input[type="checkbox"]::after {
    content: ''; position: absolute; top: 2px; left: 2px;
    width: 11px; height: 11px; border-radius: 50%;
    background: var(--t-muted);
    transition: transform 0.2s ease, background 0.2s ease;
  }
  .ss-checkbox-row input[type="checkbox"]:checked {
    background: hsla(var(--accent-hue, 210), 60%, 45%, 0.6);
    border-color: hsla(var(--accent-hue, 210), 60%, 55%, 0.5);
  }
  .ss-checkbox-row input[type="checkbox"]:checked::after {
    transform: translateX(15px);
    background: hsla(var(--accent-hue, 210), 70%, 75%, 1);
  }
  .ss-checkbox-row label { font-size: var(--fs-xs); color: var(--t-secondary); cursor: pointer; text-transform: none; letter-spacing: 0; font-weight: 400; }

  /* ── Custom radio buttons ── */
  .ss-radio-group { display: flex; flex-direction: column; gap: 6px; }
  .ss-radio { display: flex; align-items: center; gap: 8px; font-size: var(--fs-xs); color: var(--t-secondary); cursor: pointer; }
  .ss-radio input[type="radio"] {
    -webkit-appearance: none; appearance: none;
    width: 15px; height: 15px; border-radius: 50%;
    background: var(--s-light); border: 1px solid var(--b-light);
    position: relative; cursor: pointer; flex-shrink: 0;
    transition: all 0.2s ease;
  }
  .ss-radio input[type="radio"]::after {
    content: ''; position: absolute; top: 50%; left: 50%;
    transform: translate(-50%, -50%) scale(0);
    width: 7px; height: 7px; border-radius: 50%;
    background: hsla(var(--accent-hue, 210), 70%, 70%, 1);
    transition: transform 0.15s ease;
  }
  .ss-radio input[type="radio"]:checked {
    border-color: hsla(var(--accent-hue, 210), 60%, 55%, 0.6);
    background: hsla(var(--accent-hue, 210), 60%, 45%, 0.3);
  }
  .ss-radio input[type="radio"]:checked::after { transform: translate(-50%, -50%) scale(1); }

  /* ── Custom select dropdown ── */
  select.ss-input, .ss-input[id*="model"] {
    -webkit-appearance: none; appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%23666'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 8px center;
    padding-right: 24px;
    cursor: pointer;
  }
  select.ss-input option, .ss-tools-add select option {
    background: #1a1a1a; color: var(--t-secondary); padding: 4px 8px;
  }
  select.ss-input option:disabled { color: var(--t-faint); }

  .ss-hidden { display: none !important; }

  /* ── Tool chips ── */
  .ss-tools-list { display: flex; flex-wrap: wrap; gap: 6px; }
  .ss-chip {
    display: inline-flex; align-items: center; gap: 6px;
    padding: 5px 12px; border-radius: var(--r-pill);
    font-size: 11px; font-weight: 500;
    background: rgba(96, 165, 250, 0.12);
    border: 1px solid rgba(96, 165, 250, 0.22);
    color: rgba(96, 165, 250, 0.8);
    letter-spacing: 0.02em;
    transition: all 0.15s ease;
    position: relative;
  }
  .ss-chip:hover {
    background: rgba(96, 165, 250, 0.18);
    border-color: rgba(96, 165, 250, 0.32);
  }
  .ss-chip-x {
    background: none; border: none; color: rgba(96, 165, 250, 0.45);
    cursor: pointer; font-size: 13px; padding: 0; line-height: 1;
    transition: color 0.12s ease;
    display: flex; align-items: center; justify-content: center;
  }
  .ss-chip-x:hover {
    color: rgba(255, 82, 82, 0.7);
  }
  /* ── Custom dropdown (tools picker) ── */
  .ss-dropdown { position: relative; margin-top: 6px; }
  .ss-dropdown-trigger {
    display: flex; align-items: center; justify-content: space-between; gap: 8px;
    width: 100%; padding: 7px 12px;
    background: rgba(96, 165, 250, 0.08);
    border: 1px solid rgba(96, 165, 250, 0.18);
    border-radius: var(--r-small); font-size: 11px; font-weight: 500;
    color: rgba(96, 165, 250, 0.65); cursor: pointer; outline: none;
    transition: all 0.15s ease;
    font-family: inherit;
  }
  .ss-dropdown-trigger svg {
    opacity: 0.45; transition: transform 0.2s ease, opacity 0.15s ease;
    flex-shrink: 0; width: 10px; height: 10px;
  }
  .ss-dropdown-trigger:hover {
    border-color: rgba(96, 165, 250, 0.26);
    color: rgba(96, 165, 250, 0.75);
    background: rgba(96, 165, 250, 0.13);
  }
  .ss-dropdown-trigger:hover svg { opacity: 0.6; }
  .ss-dropdown-trigger.open {
    border-color: rgba(96, 165, 250, 0.3);
    color: rgba(96, 165, 250, 0.85);
    background: rgba(96, 165, 250, 0.14);
  }
  .ss-dropdown-trigger.open svg {
    transform: rotate(180deg);
    opacity: 0.7;
  }

  .ss-dropdown-menu {
    position: absolute; z-index: 400;
    top: calc(100% + 6px); left: 0; right: 0;
    display: none; flex-direction: column;
    background: rgba(18, 20, 28, 0.92);
    border: 1px solid rgba(96, 165, 250, 0.16);
    border-radius: var(--r-button);
    box-shadow: 0 8px 20px rgba(0,0,0,0.5);
    padding: 8px 0;
    backdrop-filter: blur(12px);
    max-height: 240px; overflow-y: auto;
    scrollbar-width: thin; scrollbar-color: rgba(96, 165, 250, 0.12) transparent;
    animation: ss-dropdown-in 0.2s ease;
  }
  .ss-dropdown-menu.open { display: flex; }
  @keyframes ss-dropdown-in {
    from { opacity: 0; transform: translateY(-8px) scale(0.98); }
    to { opacity: 1; transform: translateY(0) scale(1); }
  }

  .ss-dropdown-item {
    padding: 9px 14px; font-size: 11px; font-weight: 500;
    color: rgba(255,255,255,0.6); cursor: pointer;
    transition: all 0.12s ease;
    white-space: nowrap;
  }
  .ss-dropdown-item:hover {
    background: rgba(96, 165, 250, 0.15);
    color: rgba(96, 165, 250, 0.95);
  }
  .ss-dropdown-item.disabled {
    color: rgba(255,255,255,0.25); cursor: default;
    pointer-events: none;
  }

  /* ── Section label ── */
  .ss-section-label {
    font-size: 10px; font-weight: 600; color: var(--t-faint);
    text-transform: uppercase; letter-spacing: 0.5px;
    margin-top: 14px; margin-bottom: 6px;
    padding-bottom: 4px; border-bottom: 1px solid var(--b-subtle);
  }

  /* ── File tree ── */
  .ss-file-tree { display: flex; flex-direction: column; gap: 1px; }
  .ss-file-item {
    display: flex; align-items: center; gap: 6px;
    padding: 6px 8px; font-size: 11px;
    cursor: pointer; border-radius: var(--r-small);
    transition: all 0.1s ease;
    color: var(--t-secondary);
  }
  .ss-file-item:hover {
    background: rgba(255,255,255,0.05);
    color: var(--t-primary);
  }
  .ss-file-dir:hover { background: rgba(60,120,180,0.1); }
  .ss-file-icon {
    display: flex; align-items: center; justify-content: center;
    width: 16px; height: 16px; flex-shrink: 0;
    color: var(--t-muted); transition: color 0.1s ease;
  }
  .ss-file-icon-svg { display: block; }
  .ss-file-item:hover .ss-file-icon {
    color: rgba(96, 165, 250, 0.7);
  }
  .ss-file-dir:hover .ss-file-icon {
    color: rgba(255, 183, 77, 0.7);
  }
  .ss-file-name {
    flex: 1; min-width: 0; overflow: hidden; text-overflow: ellipsis;
    white-space: nowrap; font-weight: 400;
  }
  .ss-file-size {
    font-size: 9px; color: var(--t-faint); flex-shrink: 0;
    font-weight: 400; letter-spacing: 0.3px;
  }
  .ss-file-actions { display: none; gap: 3px; flex-shrink: 0; }
  .ss-file-item:hover .ss-file-actions { display: flex; }
  .ss-file-del-btn {
    width: 18px; height: 18px; border-radius: var(--r-small);
    background: none; border: 1px solid transparent;
    color: var(--t-faint); cursor: pointer; font-size: 11px;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.12s ease;
  }
  .ss-file-del-btn:hover {
    background: hsla(0, 70%, 45%, 0.15);
    border-color: hsla(0, 70%, 45%, 0.25);
    color: hsla(0, 70%, 65%, 1);
  }
  .ss-add-file-btn {
    margin-top: 8px; padding: 6px 10px;
    font-size: var(--fs-xs); color: var(--t-muted);
    background: none; border: 1px solid var(--b-light);
    border-radius: var(--r-small); cursor: pointer;
    transition: all 0.15s ease; width: 100%;
  }
  .ss-add-file-btn:hover {
    border-color: rgba(96, 165, 250, 0.4);
    color: rgba(96, 165, 250, 0.7);
    background: rgba(96, 165, 250, 0.05);
  }

  /* ── File browser dialog ── */
  .ss-file-dialog-overlay {
    position: absolute; inset: 0; z-index: 200;
    display: flex; align-items: center; justify-content: center;
  }
  .ss-fd-backdrop {
    position: absolute; inset: 0;
    background: rgba(0,0,0,0.5); backdrop-filter: blur(2px);
  }
  .ss-file-dialog {
    position: relative; z-index: 1;
    width: 380px; max-height: 420px;
    background: var(--s-glass-bg, rgba(18,18,28,0.95));
    border: 1px solid var(--b-light);
    border-radius: var(--r-medium);
    box-shadow: 0 12px 40px rgba(0,0,0,0.5);
    display: flex; flex-direction: column;
    overflow: hidden;
  }
  .ss-fd-header {
    display: flex; align-items: center; gap: 8px;
    padding: 12px 16px;
    border-bottom: 1px solid var(--b-subtle);
    font-size: var(--fs-sm); font-weight: 600;
    color: var(--t-primary);
  }
  /* ── Unified action layout ── */
  .ss-fd-divider {
    height: 1px; background: var(--b-subtle);
    margin: 12px 0;
  }
  .ss-fd-action-group {
    display: flex; flex-direction: column; gap: 12px;
  }
  .ss-fd-action {
    display: flex; flex-direction: column; gap: 8px;
  }
  .ss-fd-action-label {
    font-size: 11px; font-weight: 500;
    color: var(--t-muted); text-transform: uppercase;
    letter-spacing: 0.05em;
  }
  .ss-fd-body {
    padding: 14px 16px; overflow-y: auto; flex: 1;
  }
  .ss-fd-section-label {
    font-size: 10px; text-transform: uppercase; letter-spacing: 0.06em;
    color: var(--t-muted); margin-bottom: 6px;
  }
  .ss-fd-dirs {
    display: flex; flex-direction: column; gap: 1px;
    max-height: 160px; overflow-y: auto;
    border: 1px solid var(--b-subtle); border-radius: var(--r-small);
    background: rgba(0,0,0,0.15); margin-bottom: 8px;
  }
  .ss-fd-dir {
    display: flex; align-items: center; gap: 6px;
    padding: 6px 8px; cursor: pointer;
    font-size: var(--fs-xs); color: var(--t-secondary);
    transition: background 0.1s;
  }
  .ss-fd-dir:hover { background: rgba(255,255,255,0.04); }
  .ss-fd-dir.selected {
    background: rgba(74,144,217,0.12);
    color: var(--accent-blue, #4a90d9);
  }
  .ss-fd-new-folder-trigger {
    background: none; border: none;
    font-size: 11px; color: var(--t-muted);
    cursor: pointer; padding: 4px 0;
    transition: color 0.15s;
  }
  .ss-fd-new-folder-trigger:hover { color: var(--accent-blue, #4a90d9); }
  /* ── Action buttons ── */
  .ss-fd-create-btn {
    width: 100%;
    display: flex; align-items: center; justify-content: center; gap: 8px;
    padding: 10px 14px;
    background: rgba(96, 165, 250, 0.1);
    border: 1px solid rgba(96, 165, 250, 0.25);
    border-radius: var(--r-small);
    color: rgba(96, 165, 250, 0.8);
    font-size: 12px; font-weight: 500;
    cursor: pointer; transition: all 0.15s ease;
  }
  .ss-fd-create-btn:hover {
    background: rgba(96, 165, 250, 0.15);
    border-color: rgba(96, 165, 250, 0.4);
    color: rgba(96, 165, 250, 1);
  }
  .ss-fd-upload-btn {
    width: 100%;
    display: flex; align-items: center; justify-content: center; gap: 8px;
    padding: 10px 14px;
    background: rgba(96, 165, 250, 0.08);
    border: 2px dashed rgba(96, 165, 250, 0.3);
    border-radius: var(--r-small);
    color: rgba(96, 165, 250, 0.7);
    font-size: 12px; font-weight: 500;
    cursor: pointer; transition: all 0.15s ease;
  }
  .ss-fd-upload-btn:hover {
    border-color: rgba(96, 165, 250, 0.5);
    background: rgba(96, 165, 250, 0.12);
    color: rgba(96, 165, 250, 0.9);
  }
  .ss-fd-upload-btn svg, .ss-fd-create-btn svg { flex-shrink: 0; }
  .ss-fd-new-folder {
    display: flex; align-items: center; gap: 4px;
    margin-bottom: 4px;
  }
  .ss-fd-btn {
    background: none; border: 1px solid var(--b-subtle);
    color: var(--t-secondary); font-size: 11px;
    padding: 3px 8px; border-radius: var(--r-small);
    cursor: pointer;
  }
  .ss-fd-btn--ok { border-color: var(--accent-blue, #4a90d9); color: var(--accent-blue, #4a90d9); }
  .ss-fd-btn--cancel { border: none; color: var(--t-muted); font-size: 14px; }
  .ss-fd-input {
    font-size: var(--fs-xs) !important;
    padding: 5px 8px !important;
    height: auto !important;
  }
  .ss-fd-filename-row {
    display: flex; align-items: center;
    border: 1px solid var(--b-subtle); border-radius: var(--r-small);
    background: rgba(0,0,0,0.15); overflow: hidden;
  }
  .ss-fd-path-prefix {
    font-size: 11px; color: var(--t-muted);
    padding: 5px 0 5px 8px; white-space: nowrap;
    font-family: var(--ff-mono, monospace);
  }
  .ss-fd-filename-input {
    border: none !important; background: none !important;
    border-radius: 0 !important;
    flex: 1; min-width: 0;
    font-family: var(--ff-mono, monospace) !important;
  }
  .ss-fd-footer {
    display: flex; justify-content: flex-end; gap: 8px;
    padding: 10px 16px;
    border-top: 1px solid var(--b-subtle);
  }

  /* ── Tab bar ── */
  .ss-tab-bar {
    display: flex; align-items: stretch; gap: 0;
    padding: 0 4px; background: rgba(0,0,0,0.12);
    border-bottom: 1px solid var(--b-subtle); flex-shrink: 0;
    min-height: 32px; overflow-x: auto; overflow-y: hidden;
    scrollbar-width: none;
  }
  .ss-tab-bar::-webkit-scrollbar { display: none; }

  .ss-tab {
    display: flex; align-items: center; gap: 5px;
    padding: 0 12px; height: 32px;
    font-size: 11px; font-weight: 500; color: var(--t-muted);
    cursor: pointer; white-space: nowrap; flex-shrink: 0;
    border-bottom: 2px solid transparent;
    transition: color 0.15s ease, border-color 0.15s ease, background 0.15s ease;
    position: relative;
  }
  .ss-tab:hover { color: var(--t-secondary); background: rgba(255,255,255,0.03); }
  .ss-tab.active {
    color: var(--t-bright);
    border-bottom-color: var(--accent-blue, #60a5fa);
    background: rgba(255,255,255,0.04);
  }
  .ss-tab.dirty .ss-tab-label { font-style: italic; }

  .ss-tab-label {
    max-width: 140px; overflow: hidden; text-overflow: ellipsis;
  }
  .ss-tab-dot {
    width: 5px; height: 5px; border-radius: 50%;
    background: var(--accent-blue, #60a5fa);
    flex-shrink: 0;
    animation: ss-tab-dot-in 0.2s ease;
  }
  @keyframes ss-tab-dot-in {
    from { transform: scale(0); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }
  .ss-tab-close {
    width: 16px; height: 16px; display: flex; align-items: center; justify-content: center;
    background: none; border: none; color: var(--t-faint); cursor: pointer;
    border-radius: var(--r-small); font-size: 12px; line-height: 1;
    padding: 0; margin-left: 2px; flex-shrink: 0;
    opacity: 0; transition: opacity 0.12s ease, background 0.12s ease, color 0.12s ease;
  }
  .ss-tab:hover .ss-tab-close { opacity: 1; }
  .ss-tab-close:hover { background: rgba(255,80,80,0.2); color: #f87171; }

  /* Tab type dot indicator */
  .ss-tab-type-dot {
    width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0;
  }
  .ss-tab-type-dot.skill { background: hsla(210, 60%, 60%, 0.8); }
  .ss-tab-type-dot.command { background: hsla(45, 60%, 55%, 0.8); }
  .ss-tab-type-dot.agent { background: hsla(25, 60%, 55%, 0.8); }

  /* Tab type styling */
  .ss-tab.type-skill.active { border-bottom-color: hsla(210, 60%, 60%, 0.8); }
  .ss-tab.type-command.active { border-bottom-color: hsla(45, 60%, 55%, 0.8); }
  .ss-tab.type-agent.active { border-bottom-color: hsla(25, 60%, 55%, 0.8); }
  .ss-tab.subfile .ss-tab-label { font-size: 10px; opacity: 0.85; }

  /* ── Wizard ── */
  .ss-wizard {
    flex: 1; display: flex; flex-direction: column;
    padding: 16px 20px; overflow: hidden;
  }
  .ss-wizard-steps {
    display: flex; gap: 0; margin-bottom: 14px; flex-shrink: 0;
  }
  .ss-wizard-step {
    flex: 1; text-align: center; font-size: var(--fs-xs);
    color: var(--t-faint); padding: 6px 4px;
    border-bottom: 2px solid var(--b-subtle);
    transition: all 0.15s ease;
  }
  .ss-wizard-step.active {
    color: hsla(var(--accent-hue, 210), 60%, 70%, 1);
    border-bottom-color: hsla(var(--accent-hue, 210), 60%, 55%, 1);
  }
  .ss-wizard-step.done { color: var(--t-secondary); }
  .ss-wizard-content { flex: 1; overflow-y: auto; overflow-x: hidden; }
  .ss-wizard-content h3 { margin: 0 0 12px; font-size: var(--fs-base); color: var(--t-bright); }
  .ss-wizard-hint { font-size: var(--fs-xs); color: var(--t-muted); margin: 0 0 10px; }
  .ss-wizard-nav {
    display: flex; justify-content: space-between; align-items: center;
    padding-top: 12px; border-top: 1px solid var(--b-subtle);
    flex-shrink: 0; margin-top: 12px;
  }
  .ss-wizard-editor { min-height: 200px; max-height: 60vh; }

  /* ── Type cards (wizard step 1) ── */
  .ss-type-cards { display: flex; gap: 12px; }
  .ss-type-card {
    flex: 1; display: flex; flex-direction: column;
    align-items: center; gap: 8px;
    padding: 20px 14px; border: 1px solid var(--b-light);
    border-radius: var(--r-card); cursor: pointer;
    background: var(--s-subtle);
    transition: all 0.15s ease;
  }
  .ss-type-card:hover { background: var(--s-hover); border-color: var(--b-hover); }
  .ss-type-card.selected {
    background: hsla(var(--accent-hue, 210), 50%, 50%, 0.1);
    border-color: hsla(var(--accent-hue, 210), 50%, 55%, 0.35);
  }
  .ss-type-card-icon {
    width: 48px; height: 48px; border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    line-height: 1;
  }
  .ss-type-card-icon.skill { background: hsla(210, 50%, 50%, 0.1); color: hsla(210, 55%, 68%, 1); }
  .ss-type-card-icon.command { background: hsla(45, 50%, 50%, 0.1); color: hsla(45, 60%, 62%, 1); }
  .ss-type-card-icon.agent { background: hsla(25, 50%, 50%, 0.1); color: hsla(25, 60%, 62%, 1); }
  .ss-type-card-name { font-size: var(--fs-sm); font-weight: 600; color: var(--t-bright); }
  .ss-type-card-desc { font-size: 11px; color: var(--t-muted); text-align: center; line-height: 1.4; }

  /* ── Template list (wizard step 2) ── */
  .ss-template-list { display: flex; flex-direction: column; gap: 6px; }
  .ss-template-item {
    padding: 10px 14px; border: 1px solid var(--b-light);
    border-radius: var(--r-card); cursor: pointer;
    background: var(--s-subtle);
    transition: all 0.15s ease;
  }
  .ss-template-item:hover { background: var(--s-hover); }
  .ss-template-item.selected {
    background: hsla(var(--accent-hue, 210), 50%, 50%, 0.1);
    border-color: hsla(var(--accent-hue, 210), 50%, 55%, 0.35);
  }
  .ss-template-name { font-size: var(--fs-sm); font-weight: 600; color: var(--t-bright); }
  .ss-template-desc { font-size: 11px; color: var(--t-muted); margin-top: 2px; }

  /* ── Wizard name preview ── */
  .ss-wiz-name-preview {
    font-size: var(--fs-xs); color: var(--t-faint);
    font-family: 'JetBrains Mono', monospace; margin-top: 2px;
  }

  /* ── Toast notifications ── */
  .ss-toast {
    position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%) translateY(10px);
    padding: 8px 18px; border-radius: var(--r-button);
    font-size: var(--fs-xs); z-index: 400;
    background: var(--s-panel); border: 1px solid var(--b-light);
    color: var(--t-bright);
    opacity: 0; transition: all 0.25s ease;
    pointer-events: none; backdrop-filter: blur(12px);
  }
  .ss-toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
  .ss-toast--error { border-color: hsla(0, 50%, 45%, 0.4); color: hsla(0, 70%, 70%, 1); }
  .ss-toast--info { border-color: hsla(var(--accent-hue, 210), 50%, 55%, 0.3); }

  /* ═══════════════════════════════════════════
     TERMINAL PANEL — docked bottom
     ═══════════════════════════════════════════ */

  #terminal-panel {
    position: fixed;
    bottom: 0;
    left: var(--explorer-width, 0px);
    right: 0;
    height: var(--terminal-height, 0px);
    z-index: 150;
    display: flex;
    flex-direction: column;
    background: rgba(10, 10, 12, 0.96);
    border-top: 1px solid rgba(255,255,255,0.08);
    transition: left 0.3s cubic-bezier(0.22, 1, 0.36, 1);
    overflow: hidden;
  }
  #terminal-panel.hidden { display: none; }

  /* Panel pinned state */
  #terminal-panel.panel-pinned {
    border-top: 2px solid rgba(110, 181, 255, 0.5);
    box-shadow: 0 -2px 20px rgba(110, 181, 255, 0.08), 0 0 0 1px rgba(110, 181, 255, 0.1);
  }

  /* ── Detached / floating mode ── */
  #terminal-panel.detached {
    bottom: auto;
    right: auto;
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 10px;
    box-shadow: 0 12px 48px rgba(0,0,0,0.5), 0 0 0 1px rgba(255,255,255,0.04);
    transition: none;
    resize: none;
  }
  #terminal-panel.detached #terminal-resize-handle {
    display: none;
  }
  #terminal-panel.detached .term-header {
    cursor: grab;
    border-radius: 10px 10px 0 0;
  }
  #terminal-panel.detached.float-dragging .term-header {
    cursor: grabbing;
  }

  /* Resize handle — top edge */
  #terminal-resize-handle {
    position: absolute;
    top: -2px;
    left: 0;
    right: 0;
    height: 5px;
    cursor: ns-resize;
    z-index: 5;
    background: transparent;
    transition: background 0.2s;
  }
  #terminal-resize-handle:hover,
  #terminal-resize-handle.active {
    background: rgba(110, 181, 255, 0.3);
  }

  /* Header bar */
  .term-header {
    display: flex;
    align-items: center;
    padding: 0 8px;
    height: 34px;
    min-height: 34px;
    background: rgba(18, 18, 20, 0.85);
    border-bottom: 1px solid rgba(255,255,255,0.06);
    flex-shrink: 0;
    gap: 4px;
  }

  /* Tab bar */
  .term-tab-bar {
    display: flex;
    align-items: center;
    gap: 2px;
    flex: 1;
    overflow-x: auto;
    overflow-y: hidden;
    scrollbar-width: none;
    padding: 3px 0;
  }
  .term-tab-bar::-webkit-scrollbar { display: none; }

  .term-tab {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 4px 10px;
    border-radius: 6px;
    border: 1px solid transparent;
    background: transparent;
    color: var(--t-muted, rgba(255,255,255,0.4));
    font-size: 12px;
    font-family: inherit;
    cursor: pointer;
    white-space: nowrap;
    transition: all 0.15s ease;
    position: relative;
  }
  .term-tab:hover { background: var(--s-hover, rgba(255,255,255,0.06)); color: var(--t-primary, rgba(255,255,255,0.7)); }
  .term-tab.active {
    background: rgba(255,255,255,0.06);
    color: var(--t-bright, rgba(255,255,255,0.9));
    border-color: rgba(255,255,255,0.08);
  }
  .term-tab-icon { display: flex; align-items: center; color: rgba(255,255,255,0.5); }
  .term-tab.active .term-tab-icon { color: rgba(255,255,255,0.85); }
  .term-tab-icon svg { width: 12px; height: 12px; flex-shrink: 0; }
  .term-tab-close {
    background: none; border: none;
    color: rgba(255,255,255,0.15); cursor: pointer;
    padding: 0 2px; font-size: 14px; line-height: 1;
    transition: color 0.15s; border-radius: 3px;
  }
  .term-tab-close:hover { color: var(--t-primary, rgba(255,255,255,0.7)); background: rgba(255,255,255,0.06); }
  .term-tab.dead .term-tab-icon { color: var(--accent-red, #ff5252); }
  .term-tab-rename {
    background: rgba(255,255,255,0.08); border: 1px solid rgba(110,181,255,0.4);
    color: rgba(255,255,255,0.9); font: inherit; font-size: 11px;
    padding: 1px 4px; border-radius: 3px; outline: none;
    min-width: 40px; max-width: 120px;
  }

  /* Tab detach / dock buttons */
  .term-tab-detach,
  .term-tab-dock {
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; padding: 0 1px; opacity: 0;
    transition: opacity 0.15s, color 0.15s;
    color: rgba(255,255,255,0.25);
  }
  .term-tab-detach svg,
  .term-tab-dock svg {
    width: 10px; height: 10px; fill: none;
    stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round;
  }
  .term-tab:hover .term-tab-detach,
  .term-tab:hover .term-tab-dock { opacity: 1; }
  .term-tab-detach:hover { color: rgba(110,181,255,0.9); }
  .term-tab-dock:hover { color: rgba(109,213,140,0.9); }

  /* Detached tab indicator in main tab bar */
  .term-tab.detached {
    opacity: 0.45;
    border-style: dashed;
  }
  .term-tab.detached .term-tab-dock { opacity: 0.7; }
  .term-tab.detached:hover { opacity: 0.7; }

  /* ── Floating tab windows ── */
  .term-float-tab {
    position: fixed;
    z-index: 10000;
    display: flex;
    flex-direction: column;
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 10px;
    box-shadow: 0 12px 48px rgba(0,0,0,0.5), 0 0 0 1px rgba(255,255,255,0.04);
    overflow: hidden;
    min-width: 280px;
    min-height: 160px;
  }

  .term-float-tab-header {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 0 8px;
    height: 32px;
    min-height: 32px;
    background: rgba(255,255,255,0.03);
    border-bottom: 1px solid rgba(255,255,255,0.06);
    cursor: grab;
    user-select: none;
  }
  .term-float-tab.float-dragging .term-float-tab-header {
    cursor: grabbing;
  }

  .term-float-tab-icon {
    display: flex; align-items: center;
    color: rgba(255,255,255,0.5);
  }
  .term-float-tab-icon svg {
    width: 14px; height: 14px;
    fill: currentColor;
  }

  .term-float-tab-title {
    flex: 1;
    font-size: 11px;
    color: rgba(255,255,255,0.65);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .term-float-tab-actions {
    display: flex;
    gap: 2px;
    flex-shrink: 0;
  }

  .term-float-tab-btn {
    background: none; border: none;
    color: rgba(255,255,255,0.35);
    cursor: pointer; padding: 3px;
    border-radius: 4px;
    display: flex; align-items: center; justify-content: center;
    transition: color 0.15s, background 0.15s;
    font-size: 16px; line-height: 1;
  }
  .term-float-tab-btn svg {
    width: 12px; height: 12px;
    fill: none; stroke: currentColor;
    stroke-width: 2; stroke-linecap: round; stroke-linejoin: round;
  }
  .term-float-tab-btn.rename-btn:hover {
    color: rgba(255,255,255,0.7);
    background: rgba(255,255,255,0.06);
  }
  .term-float-tab-btn.pin-btn:hover {
    color: rgba(110,181,255,0.9);
    background: rgba(110,181,255,0.1);
  }
  .term-float-tab.pinned .pin-btn {
    color: rgba(110,181,255,0.8);
    background: rgba(110,181,255,0.1);
  }
  .term-float-tab-btn.dock-btn:hover {
    color: rgba(109,213,140,0.9);
    background: rgba(109,213,140,0.1);
  }
  .term-float-tab-btn.close-btn:hover {
    color: rgba(255,82,82,0.9);
    background: rgba(255,82,82,0.1);
  }

  /* Pinned floating tab */
  .term-float-tab.pinned {
    border-color: rgba(110,181,255,0.2);
    box-shadow: 0 12px 48px rgba(0,0,0,0.5), 0 0 0 1px rgba(110,181,255,0.1);
  }
  .term-float-tab.pinned .term-float-tab-header {
    border-bottom-color: rgba(110,181,255,0.1);
  }

  /* Inline title editing */
  .term-float-tab-title.editing {
    background: rgba(255,255,255,0.06);
    border-radius: 3px;
    padding: 1px 4px;
    outline: 1px solid rgba(110,181,255,0.4);
    color: rgba(255,255,255,0.9);
    cursor: text;
  }

  .term-float-tab-body {
    flex: 1;
    position: relative;
    overflow: hidden;
    background: #0a0a0c;
    border-radius: 0 0 10px 10px;
  }
  .term-float-tab-body .term-viewport {
    position: absolute;
    inset: 0;
  }
  /* Scrollbar always visible in floating tabs (no auto-fade) */
  .term-float-tab-body .xterm-viewport {
    scrollbar-color: rgba(255,255,255,0.12) transparent !important;
  }
  .term-float-tab-body .xterm-viewport::-webkit-scrollbar {
    width: 8px !important;
  }
  .term-float-tab-body .xterm-viewport::-webkit-scrollbar-track {
    background: transparent;
    border-radius: 4px;
  }
  .term-float-tab-body .xterm-viewport::-webkit-scrollbar-thumb {
    background: rgba(255,255,255,0.1) !important;
    background-clip: padding-box !important;
    border-radius: 4px;
    border: 2px solid transparent;
  }
  .term-float-tab-body .xterm-viewport::-webkit-scrollbar-thumb:hover {
    background: rgba(255,255,255,0.22) !important;
    background-clip: padding-box !important;
  }
  .term-float-tab-body .xterm-viewport::-webkit-scrollbar-corner {
    background: transparent;
  }

  /* Tab actions */
  .term-actions {
    display: flex;
    align-items: center;
    gap: 2px;
    flex-shrink: 0;
    padding-left: 4px;
  }
  .term-action-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 26px; height: 26px;
    border-radius: 5px;
    border: none;
    background: transparent;
    color: rgba(255,255,255,0.35);
    cursor: pointer;
    font-size: 16px;
    transition: all 0.15s ease;
    position: relative;
  }
  .term-action-btn:hover { background: rgba(255,255,255,0.06); color: rgba(255,255,255,0.7); }
  .term-action-btn svg { width: 14px; height: 14px; stroke: currentColor; fill: none; stroke-width: 1.8; }

  /* Pin button active state */
  #term-pin-btn.active {
    color: rgba(110, 181, 255, 0.9);
    background: rgba(110, 181, 255, 0.12);
    border-color: rgba(110, 181, 255, 0.3);
  }

  /* Profile picker flyout */
  .term-profile-flyout {
    position: absolute;
    bottom: calc(100% + 4px);
    right: 0;
    background: rgba(18,18,20,0.95);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 8px;
    padding: 4px;
    min-width: 170px;
    display: none;
    z-index: 200;
    backdrop-filter: blur(20px);
  }
  .term-profile-flyout.open { display: block; }
  .term-profile-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 7px 10px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 13px;
    color: rgba(255,255,255,0.6);
    transition: all 0.1s ease;
  }
  .term-profile-item:hover { background: rgba(255,255,255,0.06); color: rgba(255,255,255,0.9); }
  .term-profile-icon { display: flex; align-items: center; justify-content: center; width: 18px; }
  .term-profile-icon svg { width: 14px; height: 14px; flex-shrink: 0; }

  /* Terminal viewport container */
  .term-container {
    flex: 1;
    overflow: hidden;
    position: relative;
  }

  .term-viewport {
    position: absolute;
    inset: 0;
    padding: 8px 12px;
    overflow: hidden !important;
  }
  .term-viewport.term-drop-active {
    outline: 2px solid rgba(110,181,255,0.5);
    outline-offset: -2px;
    background: rgba(110,181,255,0.04);
  }
  .term-viewport .xterm {
    height: 100%;
    overflow: visible !important;
  }
  .term-viewport .xterm-screen {
    overflow-y: auto !important;
    scrollbar-width: thin !important;
    scrollbar-color: rgba(255,255,255,0.35) transparent !important;
  }
  .term-viewport .xterm-viewport {
    overflow-y: auto !important;
    overflow-x: hidden !important;
    scroll-behavior: smooth;
    overscroll-behavior: contain;

    /* Firefox scrollbar — force visible with !important */
    scrollbar-width: thin !important;
    scrollbar-color: rgba(255,255,255,0.35) transparent !important;
  }
  .term-viewport:hover .xterm-viewport {
    scrollbar-color: rgba(255,255,255,0.15) transparent;
  }

  /* Webkit scrollbar — auto-fade, smooth transitions */
  .term-viewport .xterm-viewport::-webkit-scrollbar {
    width: 10px !important;
  }
  .term-viewport .xterm-viewport::-webkit-scrollbar-track {
    background: transparent !important;
    border-radius: 4px;
  }
  .term-viewport .xterm-viewport::-webkit-scrollbar-thumb {
    background: rgba(255,255,255,0.35) !important;
    border-radius: 4px;
    border: 2px solid transparent;
    background-clip: padding-box;
    transition: background 0.15s ease;
  }
  .term-viewport:hover .xterm-viewport::-webkit-scrollbar-thumb {
    background: rgba(255,255,255,0.35);
    background-clip: padding-box;
  }
  .term-viewport .xterm-viewport::-webkit-scrollbar-thumb:hover {
    background: rgba(255,255,255,0.45);
    background-clip: padding-box;
  }
  .term-viewport .xterm-viewport::-webkit-scrollbar-thumb:active {
    background: rgba(255,255,255,0.5);
    background-clip: padding-box;
  }
  .term-viewport .xterm-viewport::-webkit-scrollbar-corner {
    background: transparent;
  }

  /* ── Terminal Search Bar ── */

  .term-search-bar {
    display: none;
    align-items: center;
    gap: 6px;
    padding: 4px 8px;
    background: rgba(28,28,30,0.92);
    border-bottom: 1px solid rgba(255,255,255,0.06);
    backdrop-filter: blur(20px);
    z-index: 10;
  }
  .term-search-bar.open { display: flex; }

  .term-search-input {
    flex: 1;
    max-width: 260px;
    padding: 4px 8px;
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 4px;
    color: var(--t-primary);
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    outline: none;
    transition: border-color 0.15s;
  }
  .term-search-input:focus {
    border-color: rgba(110,181,255,0.5);
  }
  .term-search-input::placeholder {
    color: rgba(255,255,255,0.25);
  }

  .term-search-count {
    font-size: 11px;
    color: var(--t-muted);
    min-width: 40px;
    text-align: center;
  }

  .term-search-nav {
    background: none;
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 4px;
    color: var(--t-secondary);
    cursor: pointer;
    padding: 3px 7px;
    font-size: 10px;
    transition: background 0.12s, color 0.12s;
  }
  .term-search-nav:hover {
    background: rgba(255,255,255,0.08);
    color: var(--t-bright);
  }

  /* ── Terminal Context Menu ── */

  #term-context-menu {
    position: fixed;
    z-index: 600;
    min-width: 160px;
    padding: 4px;
    display: none;
    animation: dropdownFadeIn 0.1s ease-out;
  }
  #term-context-menu.open { display: block; }

  .term-ctx-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 7px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 13px;
    color: var(--t-secondary);
    transition: background 0.1s;
  }
  .term-ctx-item:hover {
    background: var(--s-hover);
    color: var(--t-bright);
  }

  .term-ctx-sep {
    height: 1px;
    background: var(--b-subtle);
    margin: 3px 4px;
  }

  /* ── Terminal Toast ── */

  .term-toast {
    position: absolute;
    top: 8px;
    right: 12px;
    z-index: 20;
    padding: 6px 14px;
    background: rgba(28,28,30,0.92);
    border: 1px solid rgba(110,181,255,0.25);
    border-radius: 6px;
    color: rgba(110,181,255,0.9);
    font-size: 12px;
    font-weight: 500;
    backdrop-filter: blur(12px);
    opacity: 0;
    transform: translateY(-4px);
    transition: opacity 0.2s, transform 0.2s;
    pointer-events: none;
  }
  .term-toast.visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* ── Terminal Project Picker ── */

  .term-picker-overlay {
    position: fixed;
    inset: 0;
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.55);
    backdrop-filter: blur(4px);
    animation: dropdownFadeIn 0.12s ease-out;
  }
  .term-picker-modal {
    width: 380px;
    max-height: 420px;
    border-radius: 12px;
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    animation: dropdownFadeIn 0.15s ease-out;
  }
  .term-picker-title {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 15px;
    font-weight: 600;
    color: var(--t-bright);
  }
  .term-picker-title svg { width: 18px; height: 18px; }
  .term-picker-icon { display: flex; align-items: center; }
  .term-picker-icon svg { width: 18px; height: 18px; }
  .term-picker-list {
    display: flex;
    flex-direction: column;
    gap: 2px;
    overflow-y: auto;
    max-height: 340px;
  }
  .term-picker-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    border-radius: 8px;
    border: 1px solid transparent;
    background: none;
    cursor: pointer;
    text-align: left;
    color: var(--t-secondary);
    font-family: inherit;
    font-size: 13px;
    transition: background 0.12s, border-color 0.12s;
  }
  .term-picker-item:hover {
    background: var(--s-hover);
    border-color: rgba(110,181,255,0.2);
    color: var(--t-bright);
  }
  .term-picker-item-icon {
    flex-shrink: 0;
    width: 20px; height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--t-muted);
  }
  .term-picker-item-icon svg {
    width: 16px; height: 16px;
    stroke: currentColor; stroke-width: 2; fill: none;
  }
  .term-picker-item:hover .term-picker-item-icon { color: var(--accent-blue); }
  .term-picker-item-label {
    flex: 1;
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .term-picker-item-path {
    font-size: 11px;
    color: var(--t-muted);
    font-family: 'JetBrains Mono', monospace;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 160px;
    direction: rtl;
    text-align: right;
  }
